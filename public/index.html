<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker - Personal Finance Management</title>
    <!-- Modular CSS -->
    <link rel="stylesheet" href="styles/variables-and-base.css">
    <link rel="stylesheet" href="styles/layout-and-components.css">
    <link rel="stylesheet" href="styles/pages-part1.css">
    <link rel="stylesheet" href="styles/pages-part2.css">
    <link rel="stylesheet" href="styles/pages-part3.css">
    <link rel="stylesheet" href="styles/pages-part4.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Login Page -->
    <div id="login-page" class="login-page">
        <div class="login-container">
            <div class="login-header">
                <h1><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#6366f1" stroke-width="2"
                        style="vertical-align: middle; margin-right: 8px;">
                        <line x1="12" y1="1" x2="12" y2="23"></line>
                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                    </svg>ExpenseTracker</h1>
                <p>Personal Finance Management</p>
            </div>

            <form id="login-form" class="login-form">
                <div class="form-group">
                    <label>Username or Email</label>
                    <input type="text" id="login-username" required placeholder="Enter username or email">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="login-password" required placeholder="Enter password">
                        <button type="button" class="password-toggle"
                            onclick="togglePasswordVisibility('login-password', this)">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
                                </path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="login-error" id="login-error"></div>
                <button type="submit" class="btn btn-primary btn-block">Sign In</button>
            </form>

            <div class="login-footer">
                <p>Don't have an account? <a href="#" onclick="showRegisterForm()">Register</a></p>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div class="modal-overlay" id="register-modal">
        <div class="modal">
            <div class="modal-header">
                <h3>Create Account</h3>
                <button class="modal-close" onclick="closeRegisterModal()">&times;</button>
            </div>
            <form id="register-form" onsubmit="handleRegister(event)">
                <div class="modal-body">
                    <div class="form-group">
                        <label>Username *</label>
                        <input type="text" id="register-username" required minlength="3"
                            placeholder="Choose a username">
                    </div>
                    <div class="form-group">
                        <label>Email *</label>
                        <input type="email" id="register-email" required placeholder="your@email.com">
                    </div>
                    <div class="form-group">
                        <label>Display Name</label>
                        <input type="text" id="register-display-name" placeholder="Your name">
                    </div>
                    <div class="form-group">
                        <label>Password *</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="register-password" required minlength="6"
                                placeholder="At least 6 characters">
                            <button type="button" class="password-toggle"
                                onclick="togglePasswordVisibility('register-password', this)">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
                                    </path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Confirm Password *</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="register-password-confirm" required
                                placeholder="Confirm password">
                            <button type="button" class="password-toggle"
                                onclick="togglePasswordVisibility('register-password-confirm', this)">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
                                    </path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeRegisterModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Account</button>
                </div>
            </form>
        </div>
    </div>

    <div id="app" style="display: none;">
        <!-- Mobile Header -->
        <header class="mobile-header">
            <button class="hamburger-btn" onclick="toggleMobileSidebar()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </button>
            <span class="mobile-header-title">ExpenseTracker</span>
            <div class="mobile-header-user" id="mobile-user-avatar"></div>
        </header>

        <!-- Mobile Overlay -->
        <div class="mobile-overlay" id="mobile-overlay" onclick="closeMobileSidebar()"></div>

        <!-- Sidebar Navigation -->
        <aside class="sidebar" id="sidebar">
            <!-- Logo -->
            <div class="sidebar-logo">ExpenseTracker</div>

            <!-- Account Type Selector -->
            <div class="account-type-selector">
                <select id="account-type-select" onchange="switchAccountType(this.value)">
                    <option value="iolta" selected>‚öñÔ∏è IOLTA Account</option>
                    <option value="general">üè¢ General Account</option>
                    <option value="cost">üíµ Cost Account</option>
                </select>
            </div>

            <!-- Dynamic menu will be rendered here by account-switcher.js -->

            <!-- Section: MONEY (always expanded) -->
            <div class="nav-section">
                <div class="section-label">Money</div>
                <nav class="section-menu">
                    <div class="menu-item" data-page="transactions">
                        <span class="menu-icon">üí≥</span>
                        <span class="menu-label">Transactions</span>
                    </div>
                    <div class="menu-item" data-page="accounts">
                        <span class="menu-icon">üèõ</span>
                        <span class="menu-label">Accounts</span>
                    </div>
                    <div class="menu-item" data-page="categories">
                        <span class="menu-icon">üìä</span>
                        <span class="menu-label">Chart of Accounts</span>
                    </div>
                </nav>
            </div>

            <!-- Section: TOOLS (collapsible, default expanded) -->
            <div class="collapsible-section" data-section="tools">
                <div class="collapsible-header">
                    <div class="collapsible-title">
                        <svg class="collapsible-toggle" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                        <span>Tools</span>
                    </div>
                    <span class="collapsible-count">8</span>
                </div>
                <nav class="collapsible-body">
                    <div class="menu-item" data-page="trust" onclick="window.location.href='trust.html'">
                        <span class="menu-icon">‚öñÔ∏è</span>
                        <span class="menu-label">IOLTA Trust</span>
                    </div>
                    <div class="menu-item" data-page="rules">
                        <span class="menu-icon">‚öôÔ∏è</span>
                        <span class="menu-label">Rules</span>
                    </div>
                    <div class="menu-item" data-page="budgets">
                        <span class="menu-icon">üí∞</span>
                        <span class="menu-label">Budgets</span>
                    </div>
                    <div class="menu-item" data-page="recurring">
                        <span class="menu-icon">üîÑ</span>
                        <span class="menu-label">Recurring</span>
                    </div>
                    <div class="menu-item" data-page="checks">
                        <span class="menu-icon">‚úèÔ∏è</span>
                        <span class="menu-label">Write Checks</span>
                    </div>
                    <div class="menu-item" data-page="receipts">
                        <span class="menu-icon">üßæ</span>
                        <span class="menu-label">Receipts</span>
                    </div>
                    <div class="menu-item" data-page="reconcile">
                        <span class="menu-icon">‚úÖ</span>
                        <span class="menu-label">Reconcile</span>
                    </div>
                    <div class="menu-item" data-page="data-management">
                        <span class="menu-icon">üíæ</span>
                        <span class="menu-label">Data Management</span>
                    </div>
                </nav>
            </div>

            <!-- Section: CONTACTS (collapsible) -->
            <div class="collapsible-section" data-section="contacts">
                <div class="collapsible-header">
                    <div class="collapsible-title">
                        <svg class="collapsible-toggle" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                        <span>Contacts</span>
                    </div>
                    <span class="collapsible-count">3</span>
                </div>
                <nav class="collapsible-body">
                    <div class="menu-item" data-page="vendors">
                        <span class="menu-icon">üè¢</span>
                        <span class="menu-label">Vendors</span>
                    </div>
                    <div class="menu-item" data-page="customers">
                        <span class="menu-icon">üë§</span>
                        <span class="menu-label">Customers</span>
                    </div>
                    <div class="menu-item" data-page="employees">
                        <span class="menu-icon">üëî</span>
                        <span class="menu-label">Employees</span>
                    </div>
                </nav>
            </div>

            <!-- Section: REPORTS (collapsible, default collapsed) -->
            <div class="collapsible-section collapsed" data-section="reports">
                <div class="collapsible-header">
                    <div class="collapsible-title">
                        <svg class="collapsible-toggle" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                        <span>Reports</span>
                    </div>
                    <span class="collapsible-count">2</span>
                </div>
                <nav class="collapsible-body">
                    <div class="menu-item" data-page="reports">
                        <span class="menu-icon">üìà</span>
                        <span class="menu-label">Reports</span>
                    </div>
                    <div class="menu-item" data-page="cpa-portal">
                        <span class="menu-icon">üë§</span>
                        <span class="menu-label">CPA Portal</span>
                    </div>
                </nav>
            </div>

            <!-- Section: ADMIN (collapsible, default expanded) -->
            <div class="collapsible-section admin-only" data-section="admin" id="nav-admin-section"
                style="display: none;">
                <div class="collapsible-header">
                    <div class="collapsible-title">
                        <svg class="collapsible-toggle" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                        <span>Admin</span>
                    </div>
                    <span class="collapsible-count">1</span>
                </div>
                <nav class="collapsible-body">
                    <div class="menu-item" data-page="admin">
                        <span class="menu-icon">‚öôÔ∏è</span>
                        <span class="menu-label">Admin Panel</span>
                    </div>
                </nav>
            </div>

            <!-- User Area -->
            <div class="user-area">
                <div class="user-profile">
                    <div class="user-avatar" id="user-avatar">U</div>
                    <div class="user-info">
                        <div class="user-name" id="current-user-name">User</div>
                        <div class="user-role" id="current-user-role">User</div>
                    </div>
                </div>
                <button class="logout-btn" onclick="handleLogout()">
                    <span class="logout-icon">üö™</span>
                    <span>Logout</span>
                </button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Top Bar -->
            <header class="top-bar">
                <button class="menu-toggle" id="menu-toggle">&#9776;</button>
                <div class="top-bar-actions">
                    <div class="user-display" style="display: flex; align-items: center; gap: 16px; padding: 8px 16px; background: #f8fafc; border-radius: 8px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#64748b" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                <circle cx="12" cy="7" r="4"/>
                            </svg>
                            <span id="topbar-user-name" style="font-weight: 500; color: #1e293b; font-size: 14px;">--</span>
                        </div>
                        <div style="width: 1px; height: 16px; background: #e2e8f0;"></div>
                        <div style="display: flex; align-items: center; gap: 6px;">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#64748b" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                <line x1="16" y1="2" x2="16" y2="6"/>
                                <line x1="8" y1="2" x2="8" y2="6"/>
                                <line x1="3" y1="10" x2="21" y2="10"/>
                            </svg>
                            <span class="current-date" id="current-date" style="color: #475569; font-size: 13px;"></span>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Page Content -->
            <div class="page-content" id="page-content" data-width="100">
                <!-- Dashboard Page -->
                <div class="page active" id="page-dashboard">
                    <!-- IOLTA Dashboard (shown when account type is 'iolta') -->
                    <div id="iolta-dashboard-wrapper" style="display: none;">
                        <div class="page-header">
                            <h2>IOLTA Dashboard</h2>
                        </div>
                        <div id="iolta-dashboard-content">
                            <!-- IOLTA dashboard content loaded dynamically -->
                        </div>
                    </div>

                    <!-- Cost Dashboard (shown when account type is 'cost') -->
                    <div id="cost-dashboard-wrapper" style="display: none;">
                        <div class="page-header">
                            <h2>Cost Account Dashboard</h2>
                        </div>

                        <!-- Summary Cards -->
                        <div class="summary-cards">
                            <div class="card summary-card clickable" onclick="costShowAccountDetails()" style="border-left-color: #059669;">
                                <div class="card-icon">üí∞</div>
                                <div class="card-content">
                                    <span class="card-label">Account Balance</span>
                                    <span class="card-value" id="cost-account-balance">$0.00</span>
                                </div>
                            </div>
                            <div class="card summary-card clickable" onclick="costShowMonthExpenses()" style="border-left-color: #dc2626;">
                                <div class="card-icon">üìâ</div>
                                <div class="card-content">
                                    <span class="card-label">This Month Expenses</span>
                                    <span class="card-value" id="cost-month-expenses">$0.00</span>
                                </div>
                            </div>
                            <div class="card summary-card clickable" onclick="costShowActiveClients()" style="border-left-color: #7c3aed;">
                                <div class="card-icon">üë•</div>
                                <div class="card-content">
                                    <span class="card-label">Active Clients</span>
                                    <span class="card-value" id="cost-active-clients">0</span>
                                </div>
                            </div>
                            <div class="card summary-card clickable" onclick="costShowUnreconciledItems()" style="border-left-color: #f59e0b;">
                                <div class="card-icon">‚ö†Ô∏è</div>
                                <div class="card-content">
                                    <span class="card-label">Unreconciled Items</span>
                                    <span class="card-value" id="cost-unreconciled">0</span>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="card" style="margin-bottom: 1.5rem;">
                            <div class="card-header">
                                <h3>Quick Actions</h3>
                            </div>
                            <div class="quick-actions-grid" style="display: flex; flex-wrap: wrap; gap: 0.75rem; padding: 1rem;">
                                <button class="btn btn-primary" onclick="costOpenNewExpenseModal()">
                                    üí∏ Advanced Cost
                                </button>
                                <button class="btn btn-outline" onclick="costOpenRecordPaymentModal()">
                                    üíµ Reimbursement
                                </button>
                                <button class="btn btn-outline" onclick="openCostSplitModal()">
                                    ‚ÜîÔ∏è Split Cost
                                </button>
                                <button class="btn btn-outline" onclick="costOpenQuickTransferModal()">
                                    üîÑ Quick Transfer
                                </button>
                                <button class="btn btn-outline" onclick="costOpenNewClientModal()">
                                    ‚ûï New Client
                                </button>
                            </div>
                        </div>

                        <!-- Charts and Tables Row -->
                        <div class="dashboard-grid" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1.5rem;">
                            <!-- Expense by Category -->
                            <div class="card">
                                <div class="card-header">
                                    <h3>üìä Expense by Category</h3>
                                </div>
                                <div id="cost-category-chart" style="padding: 1rem; min-height: 300px;">
                                    <canvas id="cost-category-canvas"></canvas>
                                </div>
                            </div>

                            <!-- Cost Pending/Printed Checks (Center Column) -->
                            <div class="card">
                                <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                                    <h3>üìù Pending Checks</h3>
                                    <div class="check-status-tabs" style="display: flex; gap: 0.5rem;">
                                        <button class="btn btn-sm cost-check-tab active" data-tab="pending" onclick="costSwitchCheckTab('pending')">
                                            Pending <span id="cost-pending-count" class="badge">0</span>
                                        </button>
                                        <button class="btn btn-sm btn-outline cost-check-tab" data-tab="printed" onclick="costSwitchCheckTab('printed')">
                                            Printed <span id="cost-printed-count" class="badge">0</span>
                                        </button>
                                    </div>
                                </div>
                                <div id="cost-pending-checks-content" style="padding: 1rem; max-height: 350px; overflow-y: auto;">
                                    <!-- Pending checks list -->
                                    <div id="cost-pending-checks-list"></div>
                                    <div id="cost-printed-checks-list" style="display: none;"></div>
                                </div>
                                <div style="padding: 0.75rem 1rem; border-top: 1px solid var(--border-color); text-align: center;">
                                    <span style="font-size: 0.85rem; color: var(--text-muted);">
                                        Total Outstanding: <strong id="cost-pending-total">$0.00</strong>
                                    </span>
                                </div>
                            </div>

                            <!-- Recent Transactions -->
                            <div class="card">
                                <div class="card-header">
                                    <h3>üìã Recent Transactions</h3>
                                </div>
                                <div id="cost-recent-transactions" style="padding: 1rem; max-height: 350px; overflow-y: auto;">
                                    <!-- Populated dynamically -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Personal Dashboard (default) -->
                    <div id="personal-dashboard-wrapper">
                        <div class="page-header">
                            <h2>Dashboard</h2>
                            <div class="page-actions">
                                <select id="dashboard-month" class="form-select">
                                    <!-- Populated dynamically -->
                                </select>
                            </div>
                        </div>

                        <!-- Summary Cards - Month Comparison -->
                        <div class="summary-cards comparison-cards">
                            <div class="card summary-card comparison income clickable" onclick="showIncomeDetail()">
                                <div class="card-header">
                                    <span class="card-label">Income</span>
                                    <span class="change-badge" id="income-change">-</span>
                                </div>
                                <div class="card-comparison">
                                    <div class="this-month">
                                        <span class="period-label">This Month</span>
                                        <span class="card-value" id="total-income">$0.00</span>
                                    </div>
                                    <div class="last-month">
                                        <span class="period-label">Last Month</span>
                                        <span class="card-value muted" id="last-income">$0.00</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card summary-card comparison expenses clickable" onclick="showExpensesDetail()">
                                <div class="card-header">
                                    <span class="card-label">Expenses</span>
                                    <span class="change-badge" id="expenses-change">-</span>
                                </div>
                                <div class="card-comparison">
                                    <div class="this-month">
                                        <span class="period-label">This Month</span>
                                        <span class="card-value" id="total-expenses">$0.00</span>
                                    </div>
                                    <div class="last-month">
                                        <span class="period-label">Last Month</span>
                                        <span class="card-value muted" id="last-expenses">$0.00</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card summary-card comparison transfer clickable" onclick="showTransferDetail()">
                                <div class="card-header">
                                    <span class="card-label">Transfers</span>
                                    <span class="change-badge" id="transfer-change">-</span>
                                </div>
                                <div class="card-comparison">
                                    <div class="this-month">
                                        <span class="period-label">This Month</span>
                                        <span class="card-value" id="total-transfer">$0.00</span>
                                    </div>
                                    <div class="last-month">
                                        <span class="period-label">Last Month</span>
                                        <span class="card-value muted" id="last-transfer">$0.00</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card summary-card comparison net clickable" onclick="showSavingsDetail()">
                                <div class="card-header">
                                    <span class="card-label">Net</span>
                                    <span class="change-badge" id="net-change">-</span>
                                </div>
                                <div class="card-comparison">
                                    <div class="this-month">
                                        <span class="period-label">This Month</span>
                                        <span class="card-value" id="net-savings">$0.00</span>
                                    </div>
                                    <div class="last-month">
                                        <span class="period-label">Last Month</span>
                                        <span class="card-value muted" id="last-net">$0.00</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    <!-- Pending Checks + Account Balances Row -->
                    <div class="dashboard-row">
                        <!-- Pending Checks (Left) -->
                        <div class="card pending-checks-card" id="pending-checks-card" style="display:none;">
                            <div class="pending-checks-header">
                                <div class="pending-checks-title">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                        <polyline points="14 2 14 8 20 8"/>
                                        <line x1="16" y1="13" x2="8" y2="13"/>
                                        <line x1="16" y1="17" x2="8" y2="17"/>
                                    </svg>
                                    <h3>Pending Checks</h3>
                                    <span class="pending-checks-badge" id="pending-checks-count">0</span>
                                </div>
                                <div class="pending-checks-total">
                                    <span class="label">Total Outstanding</span>
                                    <span class="amount" id="pending-checks-total">$0.00</span>
                                </div>
                            </div>
                            <div class="pending-checks-list" id="dashboard-pending-checks-list">
                                <!-- Pending checks list -->
                            </div>
                            <div class="pending-checks-footer">
                                <button class="btn btn-secondary btn-sm" onclick="navigateTo('checks')">View All Checks</button>
                            </div>
                        </div>

                        <!-- Account Balances (Right) -->
                        <div class="card chart-card">
                            <h3>Account Balances</h3>
                            <div class="accounts-summary" id="accounts-summary">
                                <!-- Account balances -->
                            </div>
                        </div>
                    </div>

                    <!-- Spending by Category (hidden for Cost accounts) -->
                    <div class="dashboard-row" id="category-chart-row">
                        <div class="card chart-card" style="flex: 1;">
                            <h3>Spending by Category</h3>
                            <div class="category-chart" id="category-chart">
                                <!-- Category breakdown -->
                            </div>
                        </div>
                    </div>

                    <!-- Recent Transactions Row (Full Width) -->
                    <div class="dashboard-row">
                        <div class="card recent-transactions-card" style="flex: 1;">
                            <h3>Recent Transactions</h3>
                            <div class="transactions-list" id="recent-transactions">
                                <!-- Recent transactions list -->
                            </div>
                        </div>
                    </div>
                    </div><!-- End Personal Dashboard Wrapper -->
                </div>

                <!-- Transactions Page -->
                <div class="page" id="page-transactions">
                    <div class="page-header">
                        <h2>Transactions</h2>
                        <div class="page-actions">
                            <select id="txn-account-filter" class="form-select">
                                <option value="">All Accounts</option>
                            </select>
                            <select id="txn-category-filter" class="form-select">
                                <option value="">All Categories</option>
                            </select>
                            <select id="txn-date-preset" class="form-select" onchange="applyDatePreset(this.value)">
                                <optgroup label="üìÖ Quick">
                                    <option value="today">Today</option>
                                    <option value="yesterday">Yesterday</option>
                                </optgroup>
                                <optgroup label="üìÜ Week">
                                    <option value="this_week">This Week</option>
                                    <option value="last_week">Last Week</option>
                                </optgroup>
                                <optgroup label="üóìÔ∏è Month">
                                    <option value="this_month" selected>This Month</option>
                                    <option value="last_month">Last Month</option>
                                    <option value="last_30">Last 30 Days</option>
                                    <option value="last_90">Last 90 Days</option>
                                </optgroup>
                                <optgroup label="üìä Year">
                                    <option value="this_year">This Year</option>
                                    <option value="last_year">Last Year</option>
                                    <option value="all">All Time</option>
                                </optgroup>
                                <optgroup label="üîß Custom">
                                    <option value="custom">Select Date Range...</option>
                                </optgroup>
                            </select>
                            <input type="date" id="txn-start-date" class="form-input" style="display:none;">
                            <input type="date" id="txn-end-date" class="form-input" style="display:none;">

                            <!-- Transaction Type Toggle (shown for checking accounts) -->
                            <div id="txn-type-toggle" class="btn-toggle-group" style="display:none;">
                                <button type="button" class="btn-toggle active" data-type="">All</button>
                                <button type="button" class="btn-toggle" data-type="checks">Checks</button>
                                <button type="button" class="btn-toggle" data-type="deposits">Deposits</button>
                            </div>
                        </div>
                    </div>

                    <div class="transactions-container">
                        <div class="card transactions-table-card">
                            <div class="bulk-actions" id="bulk-actions" style="display: none;">
                                <span id="selected-count">0 selected</span>
                                <button class="btn btn-danger btn-sm" onclick="deleteSelectedTransactions()">Delete
                                    Selected</button>
                                <button class="btn btn-secondary btn-sm" onclick="clearSelection()">Clear
                                    Selection</button>
                            </div>
                            <table class="transactions-table" id="transactions-table">
                                <thead>
                                    <tr>
                                        <th style="width: 40px;"><input type="checkbox" id="select-all-transactions"
                                                onchange="toggleSelectAllTransactions(this.checked)"></th>
                                        <th class="sortable" data-sort="transaction_date"
                                            onclick="sortTransactions('transaction_date')">
                                            Date <span class="sort-icon" id="sort-icon-transaction_date">‚Üì</span>
                                        </th>
                                        <th class="sortable" data-sort="description"
                                            onclick="sortTransactions('description')">
                                            Description <span class="sort-icon" id="sort-icon-description"></span>
                                        </th>
                                        <th>Category</th>
                                        <th>Account</th>
                                        <th class="sortable text-right" data-sort="amount"
                                            onclick="sortTransactions('amount')">
                                            Amount <span class="sort-icon" id="sort-icon-amount"></span>
                                        </th>
                                        <th style="width: 60px; text-align: center;" title="Receipt">üìé</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="transactions-tbody">
                                    <!-- Transactions rows -->
                                </tbody>
                            </table>
                            <div class="pagination" id="transactions-pagination">
                                <!-- Pagination -->
                            </div>
                        </div>

                        <!-- Transaction Detail Panel -->
                        <div class="detail-panel" id="transaction-detail-panel">
                            <div class="detail-header">
                                <h3>Transaction Details</h3>
                                <button class="close-btn" id="close-detail">&times;</button>
                            </div>
                            <div class="detail-content" id="transaction-detail-content">
                                <!-- Transaction details -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Accounts Page -->
                <div class="page" id="page-accounts">
                    <div class="page-header">
                        <h2>Accounts</h2>
                        <div class="page-actions">
                            <button class="btn btn-primary" id="add-account-btn">+ Add Account</button>
                        </div>
                    </div>

                    <div class="accounts-grid" id="accounts-grid">
                        <!-- Account cards -->
                    </div>
                </div>

                <!-- Chart of Accounts Page - 2 Panel Layout -->
                <div class="page" id="page-categories">
                    <!-- Page Header -->
                    <div class="coa-page-header">
                        <h2>Chart of Accounts</h2>
                        <button class="btn-coa-primary" id="add-category-btn">
                            <span class="btn-icon">+</span> New
                        </button>
                    </div>

                    <!-- 2 Panel Container -->
                    <div class="coa-2panel-container">
                        <!-- Left Panel: Category List (Sidebar) -->
                        <div class="coa-sidebar">
                            <!-- Sidebar Header with Search -->
                            <div class="coa-sidebar-header">
                                <div class="coa-search-box">
                                    <span class="coa-search-icon">&#128269;</span>
                                    <input type="text" id="coa-search" placeholder="Search..." class="coa-search-input">
                                </div>
                                <select id="coa-type-filter" class="coa-filter-select-mini">
                                    <option value="">All</option>
                                    <option value="expense">Expense</option>
                                    <option value="income">Income</option>
                                    <option value="transfer">Transfer</option>
                                </select>
                            </div>

                            <!-- Expand/Collapse Buttons -->
                            <div class="coa-expand-collapse-bar">
                                <button class="coa-expand-btn" onclick="expandAllCategories()">‚ñº Expand All</button>
                                <button class="coa-collapse-btn" onclick="collapseAllCategories()">‚ñ≤ Collapse
                                    All</button>
                            </div>

                            <!-- Category List -->
                            <div class="coa-sidebar-content" id="coa-content">
                                <!-- Dynamic category list here -->
                            </div>

                            <!-- Sidebar Footer Stats -->
                            <div class="coa-sidebar-footer">
                                <div class="coa-sidebar-stat">
                                    <span class="stat-label">Accounts</span>
                                    <span class="stat-value" id="coa-count">0</span>
                                </div>
                                <div class="coa-sidebar-stat">
                                    <span class="stat-label income">Income</span>
                                    <span class="stat-value income" id="coa-total-income">$0</span>
                                </div>
                                <div class="coa-sidebar-stat">
                                    <span class="stat-label expense">Expense</span>
                                    <span class="stat-value expense" id="coa-total-expense">$0</span>
                                </div>
                            </div>
                        </div>

                        <!-- Right Panel: Detail View -->
                        <div class="coa-detail-panel" id="coa-detail-panel">
                            <!-- Empty State -->
                            <div class="coa-detail-empty" id="coa-detail-empty">
                                <div class="empty-icon">üìÇ</div>
                                <div class="empty-text">Select a category to view details</div>
                            </div>

                            <!-- Detail Content (hidden initially) -->
                            <div class="coa-detail-content" id="coa-detail-content" style="display: none;">
                                <!-- Header -->
                                <div class="coa-detail-header">
                                    <div class="detail-header-left">
                                        <span class="detail-icon" id="detail-icon">üí∞</span>
                                        <div class="detail-title-wrap">
                                            <h3 class="detail-name" id="detail-name">Category Name</h3>
                                            <span class="detail-type-badge" id="detail-type">expense</span>
                                        </div>
                                    </div>
                                    <div class="detail-header-actions">
                                        <button class="btn-icon-sm" id="detail-edit-btn" title="Edit">‚úèÔ∏è</button>
                                        <button class="btn-icon-sm danger" id="detail-delete-btn"
                                            title="Delete">üóëÔ∏è</button>
                                    </div>
                                </div>

                                <!-- Stats Row -->
                                <div class="coa-detail-stats">
                                    <div class="detail-stat">
                                        <div class="detail-stat-label">This Month</div>
                                        <div class="detail-stat-value" id="detail-this-month">$0.00</div>
                                    </div>
                                    <div class="detail-stat">
                                        <div class="detail-stat-label">Last Month</div>
                                        <div class="detail-stat-value" id="detail-last-month">$0.00</div>
                                    </div>
                                    <div class="detail-stat">
                                        <div class="detail-stat-label">All Time</div>
                                        <div class="detail-stat-value" id="detail-all-time">$0.00</div>
                                    </div>
                                    <div class="detail-stat">
                                        <div class="detail-stat-label">Transactions</div>
                                        <div class="detail-stat-value" id="detail-txn-count">0</div>
                                    </div>
                                </div>

                                <!-- Info Section -->
                                <div class="coa-detail-info">
                                    <div class="detail-info-row">
                                        <span class="info-label">Parent Category</span>
                                        <span class="info-value" id="detail-parent">None</span>
                                    </div>
                                    <div class="detail-info-row">
                                        <span class="info-label">System Category</span>
                                        <span class="info-value" id="detail-system">No</span>
                                    </div>
                                </div>

                                <!-- Transactions Section -->
                                <div class="coa-detail-transactions">
                                    <div class="detail-txn-header">
                                        <h4>All Transactions</h4>
                                        <div class="detail-txn-controls">
                                            <input type="text" class="detail-txn-search" id="detail-txn-search"
                                                placeholder="Search..." oninput="handleDetailSearch(this.value)">
                                            <select class="detail-txn-sort" id="detail-txn-sort"
                                                onchange="handleDetailSort(this.value)">
                                                <option value="date">Date</option>
                                                <option value="amount">Amount</option>
                                                <option value="account">Account</option>
                                                <option value="description">Description</option>
                                            </select>
                                            <button class="btn-bulk-categorize" id="btn-bulk-categorize"
                                                onclick="openBulkCategorizeModal()" title="Bulk Categorize"
                                                style="display: none;">
                                                Move
                                            </button>
                                            <button class="btn-bulk-delete" id="btn-bulk-delete"
                                                onclick="deleteSelectedDetailTransactions()" title="Delete Selected"
                                                style="display: none;">
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                    <div class="detail-txn-list" id="detail-txn-list">
                                        <!-- Transaction rows populated by JS -->
                                    </div>
                                    <button class="detail-view-all-btn" id="detail-view-all-btn">
                                        View All Transactions
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reports Page -->
                <div class="page" id="page-reports">
                    <!-- Page Header -->
                    <div class="reports-header">
                        <h2>Financial Reports</h2>
                        <select id="report-period" class="form-select" onchange="changeReportPeriod(this.value)">
                            <option value="month">This Month</option>
                            <option value="last_month">Last Month</option>
                            <option value="quarter">This Quarter</option>
                            <option value="year">This Year</option>
                            <option value="last_year">Last Year</option>
                            <option value="all">All Time</option>
                        </select>
                    </div>

                    <!-- Report Tabs -->
                    <div class="reports-tabs">
                        <button class="reports-tab active" data-tab="overview"
                            onclick="switchReportTab('overview')">Overview</button>
                        <button class="reports-tab" data-tab="pnl" onclick="switchReportTab('pnl')">P&L
                            Statement</button>
                        <button class="reports-tab" data-tab="comparison"
                            onclick="switchReportTab('comparison')">Monthly Comparison</button>
                        <button class="reports-tab" data-tab="categories"
                            onclick="switchReportTab('categories')">Category Analysis</button>
                        <button class="reports-tab" data-tab="custom" onclick="switchReportTab('custom')">Custom
                            Report</button>
                    </div>

                    <!-- Overview Tab -->
                    <div id="report-overview" class="reports-content active">
                        <div class="reports-cards">
                            <div class="reports-card">
                                <span class="reports-card-label">Total Income</span>
                                <span class="reports-card-value income" id="report-total-income">$0.00</span>
                            </div>
                            <div class="reports-card">
                                <span class="reports-card-label">Total Expenses</span>
                                <span class="reports-card-value expense" id="report-total-expenses">$0.00</span>
                            </div>
                            <div class="reports-card">
                                <span class="reports-card-label">Net Income</span>
                                <span class="reports-card-value" id="report-net-income">$0.00</span>
                            </div>
                            <div class="reports-card">
                                <span class="reports-card-label">Savings Rate</span>
                                <span class="reports-card-value" id="report-savings-rate">0%</span>
                            </div>
                        </div>

                        <div class="reports-grid">
                            <div class="reports-panel">
                                <h3>Expense Breakdown</h3>
                                <div class="reports-chart-container">
                                    <canvas id="report-expense-chart"></canvas>
                                </div>
                            </div>
                            <div class="reports-panel">
                                <h3>Daily Spending Trend</h3>
                                <div class="reports-chart-container">
                                    <canvas id="report-trend-chart"></canvas>
                                </div>
                            </div>
                        </div>

                        <div class="reports-grid">
                            <div class="reports-panel">
                                <h3>Top Spending Categories</h3>
                                <div class="reports-list" id="report-category-list"></div>
                            </div>
                            <div class="reports-panel">
                                <h3>Top Merchants</h3>
                                <div class="reports-list" id="report-merchant-list"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Monthly Comparison Tab -->
                    <div id="report-comparison" class="reports-content">
                        <div class="reports-cards">
                            <div class="reports-card">
                                <span class="reports-card-label">Avg Monthly Income</span>
                                <span class="reports-card-value income" id="report-avg-income">$0.00</span>
                            </div>
                            <div class="reports-card">
                                <span class="reports-card-label">Avg Monthly Expenses</span>
                                <span class="reports-card-value expense" id="report-avg-expenses">$0.00</span>
                            </div>
                            <div class="reports-card">
                                <span class="reports-card-label">Month-over-Month</span>
                                <span class="reports-card-value" id="report-mom-change">-</span>
                            </div>
                        </div>

                        <div class="reports-panel reports-panel-full">
                            <h3>Income vs Expenses Over Time</h3>
                            <div class="reports-chart-container reports-chart-tall">
                                <canvas id="report-comparison-chart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Category Analysis Tab -->
                    <div id="report-categories" class="reports-content">
                        <div class="reports-grid">
                            <div class="reports-panel">
                                <h3>Expenses by Category</h3>
                                <div class="reports-chart-container">
                                    <canvas id="report-category-pie"></canvas>
                                </div>
                            </div>
                            <div class="reports-panel">
                                <h3>Income by Category</h3>
                                <div class="reports-chart-container">
                                    <canvas id="report-income-pie"></canvas>
                                </div>
                            </div>
                        </div>

                        <div class="reports-panel reports-panel-full">
                            <h3>All Categories</h3>
                            <div class="reports-list" id="report-all-categories"></div>
                        </div>
                    </div>

                    <!-- P&L Statement Tab -->
                    <div id="report-pnl" class="reports-content">
                        <div class="pnl-header">
                            <div class="pnl-period-selector">
                                <select id="pnl-period" class="form-select" onchange="changePnlPeriod(this.value)">
                                    <option value="this_month">This Month</option>
                                    <option value="last_month">Last Month</option>
                                    <option value="this_quarter">This Quarter</option>
                                    <option value="this_year">This Year</option>
                                    <option value="last_year">Last Year</option>
                                    <option value="all" selected>All Time</option>
                                    <option value="custom">Custom Range</option>
                                </select>
                                <div class="pnl-custom-dates" id="pnl-custom-dates" style="display: none;">
                                    <input type="date" id="pnl-start-date" class="form-input">
                                    <span>to</span>
                                    <input type="date" id="pnl-end-date" class="form-input">
                                    <button class="btn btn-primary btn-sm" onclick="loadPnlReport()">Apply</button>
                                </div>
                            </div>
                            <div class="pnl-actions">
                                <button class="btn btn-secondary" onclick="openPnlExportModal()">Export</button>
                            </div>
                        </div>

                        <div class="pnl-statement">
                            <div class="pnl-title">
                                <h3>Profit & Loss Statement</h3>
                                <span class="pnl-date-range" id="pnl-date-range">January 1 - December 31, 2025</span>
                            </div>

                            <!-- Income Section -->
                            <div class="pnl-section">
                                <div class="pnl-section-header">
                                    <span>INCOME</span>
                                    <div class="pnl-section-actions">
                                        <button class="pnl-toggle-link" id="income-toggle-btn" onclick="togglePnlSection('income')">Expand All</button>
                                    </div>
                                    <span id="pnl-income-total">$0.00</span>
                                </div>
                                <div class="pnl-items" id="pnl-income-items">
                                    <!-- Income items will be populated here -->
                                </div>
                            </div>

                            <!-- Expenses Section -->
                            <div class="pnl-section">
                                <div class="pnl-section-header">
                                    <span>EXPENSES</span>
                                    <div class="pnl-section-actions">
                                        <button class="pnl-toggle-link" id="expense-toggle-btn" onclick="togglePnlSection('expense')">Expand All</button>
                                    </div>
                                    <span id="pnl-expenses-total">$0.00</span>
                                </div>
                                <div class="pnl-items" id="pnl-expense-items">
                                    <!-- Expense items will be populated here -->
                                </div>
                            </div>

                            <!-- Net Income -->
                            <div class="pnl-net-income">
                                <span>NET INCOME</span>
                                <span id="pnl-net-income">$0.00</span>
                            </div>

                            <!-- Summary Cards -->
                            <div class="pnl-summary-cards">
                                <div class="pnl-summary-card">
                                    <span class="pnl-summary-label">Gross Margin</span>
                                    <span class="pnl-summary-value" id="pnl-gross-margin">0%</span>
                                </div>
                                <div class="pnl-summary-card">
                                    <span class="pnl-summary-label">Expense Ratio</span>
                                    <span class="pnl-summary-value" id="pnl-expense-ratio">0%</span>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- Custom Report Tab -->
                    <div id="report-custom" class="reports-content">
                        <div class="custom-report-layout">
                            <div class="cr-sidebar">
                                <div class="cr-sidebar-header">
                                    <h3>Select Categories</h3>
                                    <div class="cr-select-actions">
                                        <button class="cr-btn-link" id="cr-select-all">Select All</button>
                                        <button class="cr-btn-link" id="cr-select-none">Clear</button>
                                    </div>
                                </div>
                                <div class="cr-category-list" id="cr-category-list"></div>
                                <div class="cr-sidebar-footer">
                                    <span id="cr-selected-count">0 selected</span>
                                </div>
                            </div>
                            <div class="cr-main">
                                <div class="cr-toolbar">
                                    <select id="cr-period" class="form-select">
                                        <option value="this_month">This Month</option>
                                        <option value="last_month">Last Month</option>
                                        <option value="last_3_months">Last 3 Months</option>
                                        <option value="last_6_months">Last 6 Months</option>
                                        <option value="this_year" selected>This Year</option>
                                        <option value="last_year">Last Year</option>
                                        <option value="all_time">All Time</option>
                                        <option value="custom">Custom Range</option>
                                    </select>
                                    <div class="cr-custom-dates" id="cr-custom-dates" style="display: none;">
                                        <input type="date" id="cr-start-date" class="form-input">
                                        <span>to</span>
                                        <input type="date" id="cr-end-date" class="form-input">
                                    </div>
                                    <button class="btn btn-primary" id="cr-generate">Generate Report</button>
                                </div>
                                <div class="cr-results" id="cr-results">
                                    <div class="cr-placeholder">
                                        <div class="cr-placeholder-icon">üìä</div>
                                        <p>Select categories and click "Generate Report"</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Budgets Page -->
                <div class="page" id="page-budgets">
                    <div class="budgets-header">
                        <h2>Monthly Budgets</h2>
                        <div class="budgets-actions">
                            <input type="month" id="budget-month" class="form-input">
                            <button class="btn btn-primary" onclick="openAddBudgetModal()" style="white-space: nowrap;">+ Add Budget</button>
                        </div>
                    </div>

                    <div class="budgets-summary-cards">
                        <div class="budgets-summary-card">
                            <span class="budgets-card-label">Total Budget</span>
                            <span class="budgets-card-value" id="total-budget">$0.00</span>
                        </div>
                        <div class="budgets-summary-card">
                            <span class="budgets-card-label">Total Spent</span>
                            <span class="budgets-card-value expense" id="total-spent">$0.00</span>
                        </div>
                        <div class="budgets-summary-card">
                            <span class="budgets-card-label">Remaining</span>
                            <span class="budgets-card-value income" id="total-remaining">$0.00</span>
                        </div>
                    </div>

                    <div class="budgets-progress-card">
                        <h3>Overall Budget Progress</h3>
                        <div class="budgets-progress-bar">
                            <div class="budgets-progress-fill" id="overall-progress-bar" style="width: 0%"></div>
                        </div>
                        <div class="budgets-progress-text">
                            <span id="progress-spent">$0 spent</span>
                            <span id="progress-percent">0%</span>
                            <span id="progress-budget">$0 budget</span>
                        </div>
                    </div>

                    <div class="budgets-list" id="budgets-list">
                        <div class="empty-state">
                            <div class="empty-state-icon">üí∞</div>
                            <p>No budgets set yet. Click "Add Budget" to get started!</p>
                        </div>
                    </div>

                    <!-- Budget Modal -->
                    <div class="modal-overlay" id="budget-modal">
                        <div class="modal budget-modal-content">
                            <div class="modal-header">
                                <h3 id="budget-modal-title">Add Budget</h3>
                                <button class="modal-close" onclick="closeBudgetModal()">&times;</button>
                            </div>
                            <div class="modal-body">
                                <form id="budget-form" onsubmit="saveBudget(event)">
                                    <input type="hidden" id="budget-id">

                                    <div class="form-group">
                                        <label for="budget-category">Category</label>
                                        <select id="budget-category" class="form-select" required>
                                            <option value="">Select a category...</option>
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <label for="budget-amount">Budget Amount</label>
                                        <div class="input-with-prefix">
                                            <span class="input-prefix">$</span>
                                            <input type="number" id="budget-amount" class="form-input" step="0.01"
                                                min="0" placeholder="0.00" required>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="budget-period">Period</label>
                                        <select id="budget-period" class="form-select">
                                            <option value="monthly">Monthly</option>
                                            <option value="weekly">Weekly</option>
                                            <option value="yearly">Yearly</option>
                                        </select>
                                    </div>

                                    <div class="modal-actions">
                                        <button type="button" class="btn btn-secondary"
                                            onclick="closeBudgetModal()">Cancel</button>
                                        <button type="button" class="btn btn-danger" id="budget-delete-btn"
                                            onclick="deleteBudget()" style="display: none;">Delete</button>
                                        <button type="submit" class="btn btn-primary">Save Budget</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recurring Page -->
                <div class="page" id="page-recurring">
                    <div class="recurring-header">
                        <h2>Recurring Transactions</h2>
                        <button class="btn btn-primary" onclick="openRecurringModal()">+ Add Recurring</button>
                    </div>

                    <div class="recurring-summary-cards">
                        <div class="recurring-summary-card">
                            <span class="recurring-card-label">Active Recurring</span>
                            <span class="recurring-card-value" id="recurring-total-active">0</span>
                        </div>
                        <div class="recurring-summary-card">
                            <span class="recurring-card-label">Due This Month</span>
                            <span class="recurring-card-value" id="recurring-due-this-month">0</span>
                        </div>
                        <div class="recurring-summary-card">
                            <span class="recurring-card-label">Monthly Expenses</span>
                            <span class="recurring-card-value expense" id="recurring-monthly-total">$0.00</span>
                        </div>
                    </div>

                    <div class="recurring-list" id="recurring-list">
                        <div class="empty-state">
                            <div class="empty-state-icon">üîÑ</div>
                            <p>No recurring transactions yet. Add subscriptions, rent, bills, etc.</p>
                        </div>
                    </div>

                    <!-- Recurring Modal -->
                    <div class="modal-overlay" id="recurring-modal">
                        <div class="modal recurring-modal-content">
                            <div class="modal-header">
                                <h3 id="recurring-modal-title">Add Recurring Transaction</h3>
                                <button class="modal-close" onclick="closeRecurringModal()">&times;</button>
                            </div>
                            <form id="recurring-form" onsubmit="saveRecurring(event)">
                                <div class="modal-body">
                                    <input type="hidden" id="recurring-id">

                                    <!-- Schedule Section -->
                                    <div class="form-section">
                                        <div class="section-label"><span>Schedule</span></div>
                                        <div class="section-content">
                                            <div class="form-row">
                                                <div class="form-group">
                                                    <label>Start Date <span class="required">*</span></label>
                                                    <input type="date" id="recurring-start" required>
                                                </div>
                                                <div class="form-group">
                                                    <label>End Date</label>
                                                    <input type="date" id="recurring-end">
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="form-group">
                                                    <label>Frequency <span class="required">*</span></label>
                                                    <select id="recurring-frequency" onchange="updateDayOfMonthVisibility()">
                                                        <option value="daily">Daily</option>
                                                        <option value="weekly">Weekly</option>
                                                        <option value="biweekly">Bi-weekly</option>
                                                        <option value="monthly" selected>Monthly</option>
                                                        <option value="quarterly">Quarterly</option>
                                                        <option value="yearly">Yearly</option>
                                                    </select>
                                                </div>
                                                <div class="form-group" id="day-of-month-group">
                                                    <label>Day of Month</label>
                                                    <input type="number" id="recurring-day" min="1" max="31">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Transaction Section -->
                                    <div class="form-section">
                                        <div class="section-label"><span>Transaction</span></div>
                                        <div class="section-content">
                                            <div class="form-row">
                                                <div class="form-group">
                                                    <label>Account <span class="required">*</span></label>
                                                    <select id="recurring-account" required></select>
                                                </div>
                                                <div class="form-group">
                                                    <label>Category</label>
                                                    <select id="recurring-category"></select>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="form-group">
                                                    <label>Amount <span class="required">*</span></label>
                                                    <input type="number" id="recurring-amount" step="0.01" min="0" required>
                                                </div>
                                                <div class="form-group">
                                                    <label>Type</label>
                                                    <select id="recurring-type">
                                                        <option value="debit">Expense (Debit)</option>
                                                        <option value="credit">Income (Credit)</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-row single-col">
                                                <div class="form-group">
                                                    <label>Description <span class="required">*</span></label>
                                                    <input type="text" id="recurring-description" required>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Options Section -->
                                    <div class="form-section options-section">
                                        <div class="section-label"><span>Options</span></div>
                                        <div class="section-content">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="recurring-auto-create">
                                                <span>Automatically create transactions when due</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-danger" id="recurring-delete-btn"
                                        onclick="deleteRecurringFromModal()" style="display: none; margin-right: auto;">Delete</button>
                                    <button type="button" class="btn btn-secondary" onclick="closeRecurringModal()">Cancel</button>
                                    <button type="submit" class="btn btn-primary">Save Recurring</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Checks Page - Classic Banking Theme -->
                <div class="page" id="page-checks">
                    <div class="banking-page-header">
                        <h2 class="banking-page-title">Write Checks</h2>
                        <div class="banking-header-actions">
                            <button class="btn-banking btn-banking-outline" onclick="openGeneralSplitModal()" title="Split check across multiple categories">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/></svg>
                                Split Check
                            </button>
                            <button class="btn-banking btn-banking-outline" onclick="printCheck()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9V2h12v7M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>
                                Print Check
                            </button>
                            <button class="btn-banking btn-banking-primary" onclick="resetCheckForm()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
                                New Check
                            </button>
                        </div>
                    </div>

                    <div class="banking-layout">
                        <!-- Main Check Area -->
                        <div class="banking-main">
                            <!-- Check Paper -->
                            <div class="check-paper">
                                <div class="check-paper-inner">
                                    <!-- Check Header -->
                                    <div class="check-header-row">
                                        <div class="check-number-field">
                                            <span class="check-label">No.</span>
                                            <input type="text" id="check-number" class="check-input check-number-input" placeholder="----" oninput="updateCheckPreview()">
                                        </div>
                                        <div class="check-date-field">
                                            <span class="check-label">Date</span>
                                            <input type="date" id="check-date" class="check-input check-date-input" onchange="updateCheckPreview()">
                                        </div>
                                    </div>

                                    <!-- Pay To Line -->
                                    <div class="check-payto-row">
                                        <span class="check-label-inline">PAY TO THE ORDER OF</span>
                                        <input type="text" id="check-payee" class="check-input check-payee-input" placeholder="Recipient Name" oninput="updateCheckPreview()">
                                    </div>

                                    <!-- Amount Row -->
                                    <div class="check-amount-row">
                                        <div class="check-amount-box-container">
                                            <span class="check-currency">$</span>
                                            <input type="number" id="check-amount" class="check-input check-amount-input" placeholder="0.00" min="0.01" step="0.01" oninput="updateCheckPreview()">
                                        </div>
                                        <div class="check-amount-words-line">
                                            <span id="preview-amount-words" class="amount-words-text">Zero and 00/100</span>
                                            <span class="dollars-text">DOLLARS</span>
                                        </div>
                                    </div>

                                    <!-- Bottom Section -->
                                    <div class="check-bottom-row">
                                        <div class="check-left-section">
                                            <textarea id="check-address" class="check-input check-address-input" placeholder="Mailing Address (optional)" rows="2" oninput="updateCheckPreview()"></textarea>
                                            <div class="check-memo-line">
                                                <span class="check-label-inline">MEMO</span>
                                                <input type="text" id="check-memo" class="check-input check-memo-input" placeholder="What is this check for?" oninput="updateCheckPreview()">
                                            </div>
                                        </div>
                                        <div class="check-right-section">
                                            <div class="signature-line"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Options and Actions -->
                            <div class="check-options-card">
                                <input type="hidden" id="check-id">
                                <input type="hidden" id="check-status" value="pending">
                                <div class="check-options-footer" style="justify-content: space-between;">
                                    <div class="check-option-inline">
                                        <label>Category:</label>
                                        <select id="check-category" class="check-option-select" style="min-width: 200px;"></select>
                                    </div>
                                    <div class="check-action-buttons">
                                        <button type="button" class="btn-banking btn-banking-danger" id="delete-check-btn" onclick="deleteCheck()" style="display:none;">Delete</button>
                                        <button type="button" class="btn-banking btn-banking-outline" onclick="resetCheckForm()">Cancel</button>
                                        <button type="button" class="btn-banking btn-banking-primary" onclick="saveCheckFromButton()">Save Check</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Sidebar - Check Register -->
                        <div class="banking-sidebar">
                            <div class="register-header">
                                <h3>Check Register</h3>
                            </div>
                            <div class="register-stats">
                                <div class="register-stat">
                                    <span class="register-stat-value" id="pending-count">0</span>
                                    <span class="register-stat-label">Pending</span>
                                </div>
                                <div class="register-stat highlight">
                                    <span class="register-stat-value" id="pending-amount">$0</span>
                                    <span class="register-stat-label">Outstanding</span>
                                </div>
                            </div>
                            <div class="register-filter-tabs">
                                <button class="register-tab active" onclick="filterChecks('', this)">All</button>
                                <button class="register-tab" onclick="filterChecks('pending', this)">Pending</button>
                                <button class="register-tab" onclick="filterChecks('cleared', this)">Cleared</button>
                            </div>
                            <div class="register-list" id="checks-list">
                                <div class="register-empty">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#c9a962" stroke-width="1.5"><rect x="3" y="5" width="18" height="14" rx="2"/><path d="M3 10h18"/></svg>
                                    <p>No checks written yet</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Hidden form for compatibility -->
                    <form id="check-form" style="display:none;">
                        <button type="submit">Submit</button>
                    </form>
                </div>

                <!-- Reconcile Page -->
                <div class="page" id="page-reconcile">
                    <div class="reconcile-header">
                        <h2>Reconcile Accounts</h2>
                        <div class="reconcile-actions">
                            <button class="btn btn-secondary" onclick="undoLastReconcile()">Undo Last</button>
                            <button class="btn btn-primary" onclick="finishReconciliation()">Finish
                                Reconciliation</button>
                        </div>
                    </div>

                    <!-- Account Selection -->
                    <div class="reconcile-setup card">
                        <h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                style="vertical-align: middle; margin-right: 8px;">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                <polyline points="22 4 12 14.01 9 11.01"></polyline>
                            </svg>Start Reconciliation</h3>
                        <div class="reconcile-form">
                            <div class="form-group">
                                <label>Select Account</label>
                                <select id="reconcile-account" onchange="loadReconcileAccount()">
                                    <option value="">-- Select Account --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Statement Date</label>
                                <input type="date" id="reconcile-statement-date" onchange="updateReconcileFilters()">
                            </div>
                            <div class="form-group">
                                <label>Statement Ending Balance</label>
                                <input type="number" id="reconcile-ending-balance" step="0.01"
                                    placeholder="Enter balance from bank statement">
                            </div>
                            <button class="btn btn-primary" onclick="startReconciliation()">Begin
                                Reconciliation</button>
                        </div>
                    </div>

                    <!-- Reconciliation Summary -->
                    <div class="reconcile-summary card" id="reconcile-summary" style="display: none;">
                        <div class="reconcile-summary-grid">
                            <div class="reconcile-summary-item">
                                <span class="label">Statement Balance</span>
                                <span class="value" id="stmt-balance">$0.00</span>
                            </div>
                            <div class="reconcile-summary-item">
                                <span class="label">Cleared Balance</span>
                                <span class="value" id="cleared-balance">$0.00</span>
                            </div>
                            <div class="reconcile-summary-item highlight">
                                <span class="label">Difference</span>
                                <span class="value" id="reconcile-difference">$0.00</span>
                            </div>
                        </div>
                        <div class="reconcile-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="reconcile-progress-fill" style="width: 0%"></div>
                            </div>
                            <span class="progress-text" id="reconcile-progress-text">0 of 0 items cleared</span>
                        </div>
                    </div>

                    <!-- Transactions to Reconcile -->
                    <div class="reconcile-transactions card" id="reconcile-transactions" style="display: none;">
                        <div class="reconcile-tabs">
                            <button class="reconcile-tab active" data-tab="deposits"
                                onclick="switchReconcileTab('deposits')">
                                Deposits & Credits <span class="badge" id="deposits-count">0</span>
                            </button>
                            <button class="reconcile-tab" data-tab="payments" onclick="switchReconcileTab('payments')">
                                Payments & Debits <span class="badge" id="payments-count">0</span>
                            </button>
                        </div>

                        <div class="reconcile-toolbar">
                            <div class="reconcile-search">
                                <input type="text" id="reconcile-search" placeholder="Search transactions..."
                                    oninput="filterReconcileTransactions()">
                            </div>
                            <div class="reconcile-bulk-actions">
                                <button class="btn btn-sm" onclick="selectAllReconcile()">Select All</button>
                                <button class="btn btn-sm" onclick="clearAllReconcile()">Clear All</button>
                            </div>
                        </div>

                        <div class="reconcile-list-container">
                            <!-- Deposits Tab -->
                            <div class="reconcile-list active" id="reconcile-deposits">
                                <div class="reconcile-list-header">
                                    <span class="col-check"></span>
                                    <span class="col-date">Date</span>
                                    <span class="col-desc">Description</span>
                                    <span class="col-amount">Amount</span>
                                </div>
                                <div class="reconcile-list-body" id="deposits-list">
                                    <div class="empty-state">No deposits to reconcile</div>
                                </div>
                                <div class="reconcile-list-footer">
                                    <span>Total Deposits:</span>
                                    <span id="deposits-total">$0.00</span>
                                </div>
                            </div>

                            <!-- Payments Tab -->
                            <div class="reconcile-list" id="reconcile-payments">
                                <div class="reconcile-list-header">
                                    <span class="col-check"></span>
                                    <span class="col-date">Date</span>
                                    <span class="col-desc">Description</span>
                                    <span class="col-amount">Amount</span>
                                </div>
                                <div class="reconcile-list-body" id="payments-list">
                                    <div class="empty-state">No payments to reconcile</div>
                                </div>
                                <div class="reconcile-list-footer">
                                    <span>Total Payments:</span>
                                    <span id="payments-total">$0.00</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Reconciliation History -->
                    <div class="reconcile-history card">
                        <h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                style="vertical-align: middle; margin-right: 8px;">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>Reconciliation History</h3>
                        <div class="reconcile-history-list" id="reconcile-history-list">
                            <div class="empty-state">No reconciliations completed yet</div>
                        </div>
                    </div>
                </div>

                <!-- Receipts & Reimbursements Page -->
                <div class="page" id="page-receipts">
                    <div class="page-header">
                        <h1>Receipts & Reimbursements</h1>
                        <div class="header-actions">
                            <!-- View Toggle -->
                            <div class="view-toggle">
                                <button type="button" class="view-btn active" id="view-btn-list" onclick="switchReceiptsView('list')">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="8" y1="6" x2="21" y2="6"/>
                                        <line x1="8" y1="12" x2="21" y2="12"/>
                                        <line x1="8" y1="18" x2="21" y2="18"/>
                                        <line x1="3" y1="6" x2="3.01" y2="6"/>
                                        <line x1="3" y1="12" x2="3.01" y2="12"/>
                                        <line x1="3" y1="18" x2="3.01" y2="18"/>
                                    </svg>
                                    List
                                </button>
                                <button type="button" class="view-btn" id="view-btn-kanban" onclick="switchReceiptsView('kanban')">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="3" width="5" height="18" rx="1"/>
                                        <rect x="10" y="3" width="5" height="12" rx="1"/>
                                        <rect x="17" y="3" width="5" height="15" rx="1"/>
                                    </svg>
                                    Kanban
                                </button>
                            </div>
                            <button class="btn btn-primary" onclick="openUploadReceiptModal()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                                    <polyline points="17 8 12 3 7 8" />
                                    <line x1="12" y1="3" x2="12" y2="15" />
                                </svg>
                                Upload Receipt
                            </button>
                        </div>
                    </div>

                    <!-- List View -->
                    <div class="receipts-view" id="receipts-list-view">
                        <!-- Summary Cards -->
                        <div class="receipts-summary-grid">
                            <div class="summary-card pending clickable" onclick="switchReceiptsTab('pending')">
                                <div class="summary-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"/>
                                        <polyline points="12 6 12 12 16 14"/>
                                    </svg>
                                </div>
                                <div class="summary-content">
                                    <span class="summary-label">Pending</span>
                                    <span class="summary-value" id="reimb-pending-total">$0.00</span>
                                    <span class="summary-count" id="reimb-pending-count">0 items</span>
                                </div>
                            </div>
                            <div class="summary-card cash clickable" onclick="switchReceiptsTab('cash')">
                                <div class="summary-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
                                        <circle cx="12" cy="12" r="3"/>
                                    </svg>
                                </div>
                                <div class="summary-content">
                                    <span class="summary-label">Cash Pending</span>
                                    <span class="summary-value" id="reimb-cash-total">$0.00</span>
                                    <span class="summary-count" id="reimb-cash-count">0 items</span>
                                </div>
                            </div>
                            <div class="summary-card submitted clickable" onclick="switchReceiptsTab('submitted')">
                                <div class="summary-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M22 2L11 13"/>
                                        <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                                    </svg>
                                </div>
                                <div class="summary-content">
                                    <span class="summary-label">Submitted</span>
                                    <span class="summary-value" id="reimb-submitted-total">$0.00</span>
                                    <span class="summary-count" id="reimb-submitted-count">0 items</span>
                                </div>
                            </div>
                            <div class="summary-card reimbursed clickable" onclick="switchReceiptsTab('reimbursements')">
                                <div class="summary-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="12" y1="1" x2="12" y2="23"/>
                                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                                    </svg>
                                </div>
                                <div class="summary-content">
                                    <span class="summary-label">Reimbursed</span>
                                    <span class="summary-value" id="reimb-reimbursed-total">$0.00</span>
                                    <span class="summary-count" id="reimb-reimbursed-count">0 items</span>
                                </div>
                            </div>
                        </div>

                        <!-- Tabs -->
                        <div class="receipts-tabs">
                            <button class="tab-btn active" onclick="switchReceiptsTab('all')">All Receipts <span class="tab-count" id="tab-count-all">0</span></button>
                            <button class="tab-btn" onclick="switchReceiptsTab('pending')">Pending <span class="tab-count" id="tab-count-pending">0</span></button>
                            <button class="tab-btn" onclick="switchReceiptsTab('cash')">Cash Pending <span class="tab-count" id="tab-count-cash">0</span></button>
                            <button class="tab-btn" onclick="switchReceiptsTab('submitted')">Submitted <span class="tab-count" id="tab-count-submitted">0</span></button>
                            <button class="tab-btn" onclick="switchReceiptsTab('reimbursements')">Reimbursements <span class="tab-count" id="tab-count-reimbursements">0</span></button>
                        </div>

                        <!-- Bulk Action Bar -->
                        <div class="receipt-bulk-actions" id="receipt-bulk-actions" style="display: none;">
                            <span class="selected-count">0 selected</span>
                            <button class="btn btn-danger btn-sm" onclick="bulkDeleteReceipts()">Delete</button>
                            <button class="btn btn-secondary btn-sm" onclick="openMoveFolderModal()">Move to Folder</button>
                            <button class="btn btn-outline btn-sm" onclick="selectAllReceipts()">Select All</button>
                        </div>

                        <!-- Receipts Grid -->
                        <div class="receipts-grid" id="receipts-grid">
                            <div class="empty-state">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="1.5">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                    <polyline points="14 2 14 8 20 8"/>
                                    <line x1="16" y1="13" x2="8" y2="13"/>
                                    <line x1="16" y1="17" x2="8" y2="17"/>
                                </svg>
                                <p>No receipts yet</p>
                                <button class="btn btn-primary" onclick="openUploadReceiptModal()">Upload your first receipt</button>
                            </div>
                        </div>
                    </div>

                    <!-- Kanban View -->
                    <div class="receipts-view" id="receipts-kanban-view" style="display: none;">
                    <div class="kanban-board" id="kanban-board">
                        <!-- Pending Column -->
                        <div class="kanban-column" data-status="pending">
                            <div class="kanban-column-header pending">
                                <div class="column-title">
                                    <span class="column-icon">‚è≥</span>
                                    <span>Pending</span>
                                    <span class="column-count" id="kanban-count-pending">0</span>
                                </div>
                                <div class="column-total" id="kanban-total-pending">$0.00</div>
                            </div>
                            <div class="kanban-cards" id="kanban-cards-pending"
                                ondragover="handleDragOver(event)"
                                ondrop="handleDrop(event, 'pending')"
                                ondragleave="handleDragLeave(event)">
                            </div>
                        </div>

                        <!-- Cash Pending Column -->
                        <div class="kanban-column" data-status="cash">
                            <div class="kanban-column-header cash">
                                <div class="column-title">
                                    <span class="column-icon">üíµ</span>
                                    <span>Cash Pending</span>
                                    <span class="column-count" id="kanban-count-cash">0</span>
                                </div>
                                <div class="column-total" id="kanban-total-cash">$0.00</div>
                            </div>
                            <div class="kanban-cards" id="kanban-cards-cash"
                                ondragover="handleDragOver(event)"
                                ondrop="handleDrop(event, 'cash')"
                                ondragleave="handleDragLeave(event)">
                            </div>
                        </div>

                        <!-- Submitted Column -->
                        <div class="kanban-column" data-status="submitted">
                            <div class="kanban-column-header submitted">
                                <div class="column-title">
                                    <span class="column-icon">üì§</span>
                                    <span>Submitted</span>
                                    <span class="column-count" id="kanban-count-submitted">0</span>
                                </div>
                                <div class="column-total" id="kanban-total-submitted">$0.00</div>
                            </div>
                            <div class="kanban-cards" id="kanban-cards-submitted"
                                ondragover="handleDragOver(event)"
                                ondrop="handleDrop(event, 'submitted')"
                                ondragleave="handleDragLeave(event)">
                            </div>
                        </div>

                        <!-- Reimbursed Column -->
                        <div class="kanban-column" data-status="reimbursed">
                            <div class="kanban-column-header reimbursed">
                                <div class="column-title">
                                    <span class="column-icon">‚úÖ</span>
                                    <span>Reimbursed</span>
                                    <span class="column-count" id="kanban-count-reimbursed">0</span>
                                </div>
                                <div class="column-total" id="kanban-total-reimbursed">$0.00</div>
                            </div>
                            <div class="kanban-cards" id="kanban-cards-reimbursed"
                                ondragover="handleDragOver(event)"
                                ondrop="handleDrop(event, 'reimbursed')"
                                ondragleave="handleDragLeave(event)">
                            </div>
                        </div>
                    </div>
                    </div>
                </div>

                <!-- Upload Receipt Modal -->
                <div class="modal-overlay" id="receipt-upload-modal">
                    <div class="modal receipt-modal">
                        <div class="modal-header">
                            <h3>Upload Receipt</h3>
                            <button class="modal-close" onclick="closeReceiptUploadModal()">&times;</button>
                        </div>
                        <form id="receipt-upload-form" onsubmit="handleReceiptUpload(event)">
                            <div class="modal-body">
                                <div class="receipt-dropzone" id="receipt-dropzone">
                                    <input type="file" id="receipt-file" accept="image/*,.pdf"
                                        onchange="handleFileSelect(event)" hidden>
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#9ca3af"
                                        stroke-width="1.5">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                                        <polyline points="17 8 12 3 7 8" />
                                        <line x1="12" y1="3" x2="12" y2="15" />
                                    </svg>
                                    <p>Drag & drop or <span
                                            onclick="document.getElementById('receipt-file').click()">browse</span></p>
                                    <small>JPG, PNG, GIF, PDF (max 10MB)</small>
                                </div>
                                <div class="receipt-preview" id="receipt-preview" style="display: none;">
                                    <img id="receipt-preview-img" src="" alt="Preview">
                                    <button type="button" class="btn btn-sm btn-secondary"
                                        onclick="clearReceiptPreview()">Remove</button>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Vendor / Store</label>
                                        <input type="text" id="receipt-vendor">
                                    </div>
                                    <div class="form-group">
                                        <label>Amount</label>
                                        <input type="number" id="receipt-amount" step="0.01">
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Receipt Date</label>
                                        <input type="date" id="receipt-date">
                                    </div>
                                    <div class="form-group">
                                        <label>Link to Transaction</label>
                                        <select id="receipt-transaction">
                                            <option value="">-- Select Transaction (Optional) --</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label>Description / Notes</label>
                                    <textarea id="receipt-description" rows="2"></textarea>
                                </div>

                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="receipt-cash" onchange="toggleCashReimbursement()">
                                        Cash (no linked transaction)
                                    </label>
                                </div>

                                <div class="form-group" id="cash-reimbursement-group" style="display: none;">
                                    <label>Reimbursement Status</label>
                                    <select id="receipt-reimbursement-status">
                                        <option value="none">None</option>
                                        <option value="pending">Pending</option>
                                        <option value="submitted">Submitted</option>
                                        <option value="reimbursed">Reimbursed</option>
                                    </select>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary"
                                    onclick="closeReceiptUploadModal()">Cancel</button>
                                <button type="submit" class="btn btn-primary">Upload Receipt</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Receipt View Modal -->
                <div class="modal-overlay" id="receipt-view-modal">
                    <div class="modal receipt-view-modal">
                        <div class="modal-header">
                            <h3>Receipt Details</h3>
                            <button class="modal-close" onclick="closeReceiptViewModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="receipt-view-container">
                                <div class="receipt-image-container">
                                    <img id="receipt-view-img" src="" alt="Receipt">
                                </div>
                                <div class="receipt-details">
                                    <div class="receipt-detail-row">
                                        <span class="label">Vendor:</span>
                                        <span class="value" id="receipt-view-vendor">-</span>
                                    </div>
                                    <div class="receipt-detail-row">
                                        <span class="label">Amount:</span>
                                        <span class="value" id="receipt-view-amount">-</span>
                                    </div>
                                    <div class="receipt-detail-row">
                                        <span class="label">Date:</span>
                                        <span class="value" id="receipt-view-date">-</span>
                                    </div>
                                    <div class="receipt-detail-row">
                                        <span class="label">Description:</span>
                                        <span class="value" id="receipt-view-description">-</span>
                                    </div>
                                    <div class="receipt-detail-row">
                                        <span class="label">Linked Transaction:</span>
                                        <span class="value" id="receipt-view-transaction">Not linked</span>
                                    </div>
                                    <div class="receipt-detail-row" id="receipt-link-row">
                                        <select class="form-control" id="receipt-link-select" style="flex: 1;"
                                            onchange="if(this.value) linkReceiptToTransaction()">
                                            <option value="">-- Select Transaction --</option>
                                        </select>
                                    </div>
                                    <div class="receipt-actions">
                                        <button class="btn btn-outline" onclick="editReceipt()">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                stroke="currentColor" stroke-width="2">
                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
                                            </svg>
                                            Edit
                                        </button>
                                        <button class="btn btn-secondary" onclick="downloadReceipt()">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                stroke="currentColor" stroke-width="2">
                                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                                                <polyline points="7 10 12 15 17 10" />
                                                <line x1="12" y1="15" x2="12" y2="3" />
                                            </svg>
                                            Download
                                        </button>
                                        <button class="btn btn-danger" onclick="deleteReceipt()">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                stroke="currentColor" stroke-width="2">
                                                <polyline points="3 6 5 6 21 6" />
                                                <path
                                                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                                            </svg>
                                            Delete
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CPA Portal Page -->
                <div class="page" id="page-cpa-portal">
                    <div class="cpa-header">
                        <h2>CPA Portal</h2>
                        <p class="cpa-subtitle">Prepare and share financial documents with your accountant</p>
                    </div>

                    <!-- Quick Actions -->
                    <div class="cpa-quick-actions">
                        <button class="cpa-action-btn" onclick="generateReportPackage()">
                            <span class="action-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path
                                        d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
                                    </path>
                                    <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                                    <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                </svg></span>
                            <span class="action-text">Generate Report Package</span>
                        </button>
                        <button class="cpa-action-btn" onclick="openEmailModal()">
                            <span class="action-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path
                                        d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z">
                                    </path>
                                    <polyline points="22,6 12,13 2,6"></polyline>
                                </svg></span>
                            <span class="action-text">Email to Accountant</span>
                        </button>
                        <button class="cpa-action-btn" onclick="downloadAllReports()">
                            <span class="action-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="7 10 12 15 17 10"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                </svg></span>
                            <span class="action-text">Download All Reports</span>
                        </button>
                    </div>

                    <!-- Document Selection -->
                    <div class="cpa-documents card">
                        <h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                style="vertical-align: middle; margin-right: 8px;">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10 9 9 9 8 9"></polyline>
                            </svg>Available Documents</h3>
                        <div class="cpa-period-selector">
                            <label>Report Period:</label>
                            <select id="cpa-period" onchange="updateCpaDocuments()">
                                <option value="this_month">This Month</option>
                                <option value="last_month">Last Month</option>
                                <option value="this_quarter">This Quarter</option>
                                <option value="last_quarter">Last Quarter</option>
                                <option value="ytd" selected>Year to Date</option>
                                <option value="last_year">Last Year</option>
                                <option value="custom">Custom Range</option>
                            </select>
                            <div class="cpa-custom-dates" id="cpa-custom-dates" style="display: none;">
                                <input type="date" id="cpa-start-date">
                                <span>to</span>
                                <input type="date" id="cpa-end-date">
                                <button class="btn btn-sm btn-primary" onclick="applyCpaCustomDates()">Apply</button>
                            </div>
                        </div>

                        <div class="cpa-document-list" id="cpa-document-list">
                            <div class="cpa-document-item">
                                <input type="checkbox" id="doc-pnl" checked>
                                <label for="doc-pnl">
                                    <span class="doc-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                            stroke="#6366f1" stroke-width="2">
                                            <line x1="18" y1="20" x2="18" y2="10"></line>
                                            <line x1="12" y1="20" x2="12" y2="4"></line>
                                            <line x1="6" y1="20" x2="6" y2="14"></line>
                                        </svg></span>
                                    <div class="doc-info">
                                        <span class="doc-name">Profit & Loss Statement</span>
                                        <span class="doc-desc">Income and expenses summary</span>
                                    </div>
                                </label>
                                <button class="btn btn-sm" onclick="previewDocument('pnl')">Preview</button>
                                <button class="btn btn-sm" onclick="downloadDocument('pnl')">Download</button>
                            </div>
                            <div class="cpa-document-item">
                                <input type="checkbox" id="doc-transactions" checked>
                                <label for="doc-transactions">
                                    <span class="doc-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                            stroke="#8b5cf6" stroke-width="2">
                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                            <polyline points="14 2 14 8 20 8"></polyline>
                                            <line x1="16" y1="13" x2="8" y2="13"></line>
                                            <line x1="16" y1="17" x2="8" y2="17"></line>
                                        </svg></span>
                                    <div class="doc-info">
                                        <span class="doc-name">Transaction Report</span>
                                        <span class="doc-desc">All transactions with categories</span>
                                    </div>
                                </label>
                                <button class="btn btn-sm" onclick="previewDocument('transactions')">Preview</button>
                                <button class="btn btn-sm" onclick="downloadDocument('transactions')">Download</button>
                            </div>
                            <div class="cpa-document-item">
                                <input type="checkbox" id="doc-categories" checked>
                                <label for="doc-categories">
                                    <span class="doc-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                            stroke="#f59e0b" stroke-width="2">
                                            <path
                                                d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z">
                                            </path>
                                        </svg></span>
                                    <div class="doc-info">
                                        <span class="doc-name">Category Summary</span>
                                        <span class="doc-desc">Expenses grouped by category</span>
                                    </div>
                                </label>
                                <button class="btn btn-sm" onclick="previewDocument('categories')">Preview</button>
                                <button class="btn btn-sm" onclick="downloadDocument('categories')">Download</button>
                            </div>
                            <div class="cpa-document-item">
                                <input type="checkbox" id="doc-accounts">
                                <label for="doc-accounts">
                                    <span class="doc-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                            stroke="#10b981" stroke-width="2">
                                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                            <line x1="3" y1="9" x2="21" y2="9"></line>
                                            <line x1="9" y1="21" x2="9" y2="9"></line>
                                        </svg></span>
                                    <div class="doc-info">
                                        <span class="doc-name">Account Summary</span>
                                        <span class="doc-desc">Balance summary for all accounts</span>
                                    </div>
                                </label>
                                <button class="btn btn-sm" onclick="previewDocument('accounts')">Preview</button>
                                <button class="btn btn-sm" onclick="downloadDocument('accounts')">Download</button>
                            </div>
                            <div class="cpa-document-item">
                                <input type="checkbox" id="doc-vendors">
                                <label for="doc-vendors">
                                    <span class="doc-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                            stroke="#ec4899" stroke-width="2">
                                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                            <polyline points="9 22 9 12 15 12 15 22"></polyline>
                                        </svg></span>
                                    <div class="doc-info">
                                        <span class="doc-name">Vendor Report</span>
                                        <span class="doc-desc">Spending by vendor/payee</span>
                                    </div>
                                </label>
                                <button class="btn btn-sm" onclick="previewDocument('vendors')">Preview</button>
                                <button class="btn btn-sm" onclick="downloadDocument('vendors')">Download</button>
                            </div>
                        </div>
                    </div>

                    <!-- Accountant Settings -->
                    <div class="cpa-settings card">
                        <h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                style="vertical-align: middle; margin-right: 8px;">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>Accountant Information</h3>
                        <div class="cpa-accountant-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Accountant Name</label>
                                    <input type="text" id="cpa-name" placeholder="John Smith, CPA">
                                </div>
                                <div class="form-group">
                                    <label>Email Address</label>
                                    <input type="email" id="cpa-email" placeholder="accountant@email.com">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Company/Firm</label>
                                    <input type="text" id="cpa-firm" placeholder="Smith & Associates">
                                </div>
                                <div class="form-group">
                                    <label>Phone</label>
                                    <input type="tel" id="cpa-phone" placeholder="(555) 123-4567">
                                </div>
                            </div>
                            <button class="btn btn-secondary" onclick="saveCpaSettings()">Save Settings</button>
                        </div>
                    </div>

                    <!-- Shared History -->
                    <div class="cpa-history card">
                        <h3>Sharing History</h3>
                        <div class="cpa-history-list" id="cpa-history-list">
                            <div class="empty-state">No documents shared yet</div>
                        </div>
                    </div>
                </div>

                <!-- Email Modal -->
                <div class="modal-overlay" id="email-modal" style="display: none;">
                    <div class="modal cpa-email-modal">
                        <div class="modal-header">
                            <h3>Email Documents to Accountant</h3>
                            <button class="modal-close" onclick="closeEmailModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label>To:</label>
                                <input type="email" id="email-to" placeholder="accountant@email.com">
                            </div>
                            <div class="form-group">
                                <label>Subject:</label>
                                <input type="text" id="email-subject" value="Financial Documents - ">
                            </div>
                            <div class="form-group">
                                <label>Message:</label>
                                <textarea id="email-message" rows="4"
                                    placeholder="Please find attached the financial documents for your review..."></textarea>
                            </div>
                            <div class="form-group">
                                <label>Attachments:</label>
                                <div class="email-attachments" id="email-attachments">
                                    <!-- Populated dynamically -->
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeEmailModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="sendEmail()">Send Email</button>
                        </div>
                    </div>
                </div>

                <!-- Admin Page -->
                <div class="page" id="page-admin">
                    <div class="admin-header">
                        <h2>Admin Panel</h2>
                    </div>

                    <!-- Admin Tabs -->
                    <div class="admin-tabs">
                        <button class="admin-tab active" data-tab="users" onclick="switchAdminTab('users')">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                            </svg>
                            User Management
                        </button>
                        <button class="admin-tab" data-tab="roles" onclick="switchAdminTab('roles')">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                            </svg>
                            Roles & Permissions
                        </button>
                    </div>

                    <!-- Users Tab Content -->
                    <div class="admin-tab-content active" id="admin-tab-users">
                        <div class="admin-tab-header">
                            <button class="btn btn-primary" onclick="openUserModal()">+ Add User</button>
                        </div>

                        <div class="admin-stats" id="admin-stats">
                            <div class="admin-stat-card">
                                <span class="stat-icon">üë•</span>
                                <div class="stat-info">
                                    <span class="stat-value" id="stat-total-users">0</span>
                                    <span class="stat-label">Total Users</span>
                                </div>
                            </div>
                            <div class="admin-stat-card">
                                <span class="stat-icon">‚úÖ</span>
                                <div class="stat-info">
                                    <span class="stat-value" id="stat-active-users">0</span>
                                    <span class="stat-label">Active Users</span>
                                </div>
                            </div>
                            <div class="admin-stat-card">
                                <span class="stat-icon">üîê</span>
                                <div class="stat-info">
                                    <span class="stat-value" id="stat-admin-users">0</span>
                                    <span class="stat-label">Admin Users</span>
                                </div>
                            </div>
                            <div class="admin-stat-card">
                                <span class="stat-icon">üìä</span>
                                <div class="stat-info">
                                    <span class="stat-value" id="stat-total-transactions">0</span>
                                    <span class="stat-label">Total Transactions</span>
                                </div>
                            </div>
                        </div>

                        <div class="admin-users-section">
                            <h3>User Management</h3>
                            <div class="admin-users-list" id="admin-users-list">
                                <div class="loading">Loading users...</div>
                            </div>
                        </div>
                    </div>

                    <!-- Roles Tab Content -->
                    <div class="admin-tab-content" id="admin-tab-roles">
                        <div class="admin-tab-header">
                            <button class="btn btn-primary" onclick="openRoleModal()">+ Add Role</button>
                        </div>

                        <div class="roles-grid" id="roles-grid">
                            <div class="loading">Loading roles...</div>
                        </div>
                    </div>

                    <!-- User Modal -->
                    <div class="modal-overlay" id="user-modal">
                        <div class="modal user-modal-content">
                            <div class="modal-header">
                                <h3 id="user-modal-title">Add User</h3>
                                <button class="modal-close" onclick="closeUserModal()">&times;</button>
                            </div>
                            <form id="user-form" onsubmit="saveUser(event)">
                                <div class="modal-body">
                                    <input type="hidden" id="edit-user-id">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>Username *</label>
                                            <input type="text" id="edit-username" required minlength="3">
                                        </div>
                                        <div class="form-group">
                                            <label>Email *</label>
                                            <input type="email" id="edit-email" required>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>Display Name</label>
                                        <input type="text" id="edit-display-name">
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>Password <span id="password-hint">(required for new user)</span></label>
                                            <input type="password" id="edit-password" minlength="6">
                                        </div>
                                        <div class="form-group">
                                            <label>Role</label>
                                            <select id="edit-user-role" class="form-select">
                                                <option value="">Select role...</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="edit-is-active" checked>
                                                <span>Active Account</span>
                                            </label>
                                        </div>
                                        <div class="form-group">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="edit-is-admin">
                                                <span>Admin Access</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                        onclick="closeUserModal()">Cancel</button>
                                    <button type="submit" class="btn btn-primary">Save User</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Reset Password Modal -->
                    <div class="modal-overlay" id="reset-password-modal">
                        <div class="modal">
                            <div class="modal-header">
                                <h3>Reset Password</h3>
                                <button class="modal-close" onclick="closeResetPasswordModal()">&times;</button>
                            </div>
                            <form id="reset-password-form" onsubmit="submitResetPassword(event)">
                                <div class="modal-body">
                                    <input type="hidden" id="reset-user-id">
                                    <p>Reset password for: <strong id="reset-username"></strong></p>
                                    <div class="form-group">
                                        <label>New Password *</label>
                                        <input type="password" id="new-password" required minlength="6">
                                    </div>
                                    <div class="form-group">
                                        <label>Confirm Password *</label>
                                        <input type="password" id="confirm-password" required minlength="6">
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                        onclick="closeResetPasswordModal()">Cancel</button>
                                    <button type="submit" class="btn btn-primary">Reset Password</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Role Modal -->
                    <div class="modal-overlay" id="role-modal">
                        <div class="modal role-modal-content">
                            <div class="modal-header">
                                <h3 id="role-modal-title">Add Role</h3>
                                <button class="modal-close" onclick="closeRoleModal()">&times;</button>
                            </div>
                            <form id="role-form" onsubmit="saveRole(event)">
                                <div class="modal-body">
                                    <input type="hidden" id="edit-role-id">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>Role Name *</label>
                                            <input type="text" id="edit-role-name" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Description</label>
                                            <input type="text" id="edit-role-description">
                                        </div>
                                    </div>

                                    <div class="permissions-section">
                                        <h4>Permissions</h4>
                                        <div class="permissions-grid" id="role-permissions-grid">
                                            <!-- Permissions will be populated by JavaScript -->
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" onclick="closeRoleModal()">Cancel</button>
                                    <button type="submit" class="btn btn-primary">Save Role</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Import Page -->
                <div class="page" id="page-import">
                    <div class="page-header">
                        <h2>Import Transactions</h2>
                    </div>

                    <div class="card import-card">
                        <form id="import-form" enctype="multipart/form-data">
                            <div class="form-group">
                                <label for="import-account">Select Account</label>
                                <select id="import-account" class="form-select" required>
                                    <option value="">Choose account...</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="import-institution">Bank/Institution</label>
                                <select id="import-institution" class="form-select" required>
                                    <option value="">Choose bank format...</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="import-file">CSV File</label>
                                <div class="file-upload">
                                    <input type="file" id="import-file" accept=".csv" required>
                                    <div class="file-upload-text">
                                        <span>Drop CSV file here or click to browse</span>
                                    </div>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary btn-block">Import Transactions</button>
                        </form>

                        <div class="import-result" id="import-result" style="display: none;">
                            <!-- Import results -->
                        </div>
                    </div>

                    <!-- Import History -->
                    <div class="card">
                        <h3>Import History</h3>
                        <table class="import-history-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>File</th>
                                    <th>Account</th>
                                    <th>Imported</th>
                                    <th>Duplicates</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="import-history">
                                <!-- Import history rows -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Rules Page -->
                <div class="page" id="page-rules">
                    <!-- Page Header -->
                    <div class="rules-page-header">
                        <h2>Categorization Rules</h2>
                        <button class="btn btn-primary" id="add-rule-btn">+ Add Rule</button>
                    </div>

                    <!-- Stats Cards -->
                    <div class="rules-stats">
                        <div class="rules-stat-card">
                            <div class="rules-stat-value" id="rules-total">0</div>
                            <div class="rules-stat-label">Total Rules</div>
                        </div>
                        <div class="rules-stat-card">
                            <div class="rules-stat-value rules-stat-active" id="rules-active">0</div>
                            <div class="rules-stat-label">Active (Hits > 0)</div>
                        </div>
                        <div class="rules-stat-card">
                            <div class="rules-stat-value rules-stat-unused" id="rules-unused">0</div>
                            <div class="rules-stat-label">Unused</div>
                        </div>
                        <div class="rules-stat-card">
                            <div class="rules-stat-value rules-stat-hits" id="rules-total-hits">0</div>
                            <div class="rules-stat-label">Total Hits</div>
                        </div>
                    </div>

                    <!-- Toolbar -->
                    <div class="rules-toolbar">
                        <div class="rules-toolbar-left">
                            <div class="rules-search-box">
                                <span class="rules-search-icon">&#128269;</span>
                                <input type="text" id="rules-search" placeholder="Search rules..."
                                    class="rules-search-input">
                            </div>
                            <select id="rules-category-filter" class="rules-filter-select">
                                <option value="">All Categories</option>
                            </select>
                            <select id="rules-type-filter" class="rules-filter-select">
                                <option value="">All Types</option>
                                <option value="income">Income</option>
                                <option value="expense">Expense</option>
                                <option value="transfer">Transfer</option>
                            </select>
                            <select id="rules-status-filter" class="rules-filter-select">
                                <option value="">All Status</option>
                                <option value="active">Active (Hits > 0)</option>
                                <option value="unused">Unused (Hits = 0)</option>
                            </select>
                        </div>
                        <div class="rules-toolbar-right">
                            <button class="rules-toolbar-btn" id="rules-expand-all" title="Expand All">
                                <span>&#9660;</span> Expand All
                            </button>
                            <button class="rules-toolbar-btn" id="rules-collapse-all" title="Collapse All">
                                <span>&#9650;</span> Collapse All
                            </button>
                        </div>
                    </div>

                    <!-- Rules Content (Grouped by Category) -->
                    <div class="rules-content" id="rules-content">
                        <!-- Dynamic content here -->
                    </div>
                </div>

                <!-- Data Management Page -->
                <div class="page" id="page-data-management">
                    <div class="dm-container">
                        <!-- Header -->
                        <div class="dm-header">
                            <div class="dm-header-content">
                                <h1>Data Management</h1>
                                <p>Export, import, backup and restore your financial data</p>
                            </div>
                        </div>

                        <!-- Navigation Tabs -->
                        <div class="dm-nav">
                            <button class="dm-nav-item active" data-tab="export">
                                <svg class="dm-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="17 8 12 3 7 8"/>
                                    <line x1="12" y1="3" x2="12" y2="15"/>
                                </svg>
                                <span>Export</span>
                            </button>
                            <button class="dm-nav-item" data-tab="import">
                                <svg class="dm-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                <span>Import</span>
                            </button>
                            <button class="dm-nav-item" data-tab="backup">
                                <svg class="dm-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                    <polyline points="17 21 17 13 7 13 7 21"/>
                                    <polyline points="7 3 7 8 15 8"/>
                                </svg>
                                <span>Backup</span>
                            </button>
                            <button class="dm-nav-item" data-tab="restore">
                                <svg class="dm-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="1 4 1 10 7 10"/>
                                    <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
                                </svg>
                                <span>Restore</span>
                            </button>
                        </div>

                        <!-- Export Tab -->
                        <div id="export-content" class="dm-tab-content active">
                            <div class="dm-card">
                                <div class="dm-card-header">
                                    <div class="dm-card-icon dm-icon-blue">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                            <polyline points="17 8 12 3 7 8"/>
                                            <line x1="12" y1="3" x2="12" y2="15"/>
                                        </svg>
                                    </div>
                                    <div class="dm-card-title">
                                        <h2>Export Data</h2>
                                        <p>Download your data as CSV files</p>
                                    </div>
                                </div>

                                <div class="dm-card-body">
                                    <p class="dm-section-label">Select data to export</p>
                                    <div class="dm-export-grid">
                                        <label class="dm-checkbox-card">
                                            <input type="checkbox" name="dm-export" value="transactions" checked>
                                            <div class="dm-checkbox-content">
                                                <div class="dm-checkbox-icon">
                                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                                                    </svg>
                                                </div>
                                                <span class="dm-checkbox-label">Transactions</span>
                                                <span class="dm-checkbox-desc">All income & expenses</span>
                                            </div>
                                            <div class="dm-checkbox-check">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                                    <polyline points="20 6 9 17 4 12"/>
                                                </svg>
                                            </div>
                                        </label>
                                        <label class="dm-checkbox-card">
                                            <input type="checkbox" name="dm-export" value="categories">
                                            <div class="dm-checkbox-content">
                                                <div class="dm-checkbox-icon">
                                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                                                    </svg>
                                                </div>
                                                <span class="dm-checkbox-label">Categories</span>
                                                <span class="dm-checkbox-desc">Custom categories</span>
                                            </div>
                                            <div class="dm-checkbox-check">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                                    <polyline points="20 6 9 17 4 12"/>
                                                </svg>
                                            </div>
                                        </label>
                                        <label class="dm-checkbox-card">
                                            <input type="checkbox" name="dm-export" value="accounts">
                                            <div class="dm-checkbox-content">
                                                <div class="dm-checkbox-icon">
                                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/>
                                                    </svg>
                                                </div>
                                                <span class="dm-checkbox-label">Accounts</span>
                                                <span class="dm-checkbox-desc">Bank accounts</span>
                                            </div>
                                            <div class="dm-checkbox-check">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                                    <polyline points="20 6 9 17 4 12"/>
                                                </svg>
                                            </div>
                                        </label>
                                        <label class="dm-checkbox-card">
                                            <input type="checkbox" name="dm-export" value="rules">
                                            <div class="dm-checkbox-content">
                                                <div class="dm-checkbox-icon">
                                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/>
                                                    </svg>
                                                </div>
                                                <span class="dm-checkbox-label">Rules</span>
                                                <span class="dm-checkbox-desc">Auto-categorization</span>
                                            </div>
                                            <div class="dm-checkbox-check">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                                    <polyline points="20 6 9 17 4 12"/>
                                                </svg>
                                            </div>
                                        </label>
                                        <label class="dm-checkbox-card">
                                            <input type="checkbox" name="dm-export" value="recurring">
                                            <div class="dm-checkbox-content">
                                                <div class="dm-checkbox-icon">
                                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                                                    </svg>
                                                </div>
                                                <span class="dm-checkbox-label">Recurring</span>
                                                <span class="dm-checkbox-desc">Scheduled items</span>
                                            </div>
                                            <div class="dm-checkbox-check">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                                    <polyline points="20 6 9 17 4 12"/>
                                                </svg>
                                            </div>
                                        </label>
                                        <label class="dm-checkbox-card">
                                            <input type="checkbox" name="dm-export" value="budgets">
                                            <div class="dm-checkbox-content">
                                                <div class="dm-checkbox-icon">
                                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/>
                                                    </svg>
                                                </div>
                                                <span class="dm-checkbox-label">Budgets</span>
                                                <span class="dm-checkbox-desc">Budget settings</span>
                                            </div>
                                            <div class="dm-checkbox-check">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                                    <polyline points="20 6 9 17 4 12"/>
                                                </svg>
                                            </div>
                                        </label>
                                    </div>
                                </div>

                                <div class="dm-card-footer">
                                    <div class="dm-loading" id="dm-export-loading">
                                        <div class="dm-spinner"></div>
                                        <span>Preparing download...</span>
                                    </div>
                                    <button class="dm-btn dm-btn-primary" onclick="exportSelectedData()">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                            <polyline points="7 10 12 15 17 10"/>
                                            <line x1="12" y1="15" x2="12" y2="3"/>
                                        </svg>
                                        Download CSV Files
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Import Tab -->
                        <div id="import-content" class="dm-tab-content">
                            <div class="dm-grid-2">
                                <div class="dm-card">
                                    <div class="dm-card-header">
                                        <div class="dm-card-icon dm-icon-green">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                                <polyline points="7 10 12 15 17 10"/>
                                                <line x1="12" y1="15" x2="12" y2="3"/>
                                            </svg>
                                        </div>
                                        <div class="dm-card-title">
                                            <h2>Import Data</h2>
                                            <p>Upload CSV files to import</p>
                                        </div>
                                    </div>

                                    <div class="dm-card-body">
                                        <div class="dm-form-group">
                                            <label class="dm-label">Import Format</label>
                                            <select class="dm-select" id="dm-import-format">
                                                <option value="chase">Chase (Checking/Credit Card)</option>
                                                <option value="amex">American Express (AMEX)</option>
                                            </select>
                                        </div>

                                        <div class="dm-form-group">
                                            <label class="dm-label">Import to Account</label>
                                            <select class="dm-select" id="dm-import-account">
                                                <option value="">Select account...</option>
                                            </select>
                                        </div>

                                        <div class="dm-form-group" id="dm-transfer-account-group">
                                            <label class="dm-label">Payment From (Bank Account) <span style="color:#64748b;font-weight:normal;font-size:12px">- optional, for tracking card payments</span></label>
                                            <select class="dm-select" id="dm-transfer-account">
                                                <option value="">Skip payments / No transfer account</option>
                                            </select>
                                        </div>

                                        <div class="dm-form-group">
                                            <label class="dm-label">CSV or ZIP File</label>
                                            <div class="dm-dropzone" id="dm-import-dropzone">
                                                <input type="file" id="dm-import-file" accept=".csv,.zip" onchange="updateImportFileName(this)">
                                                <div class="dm-dropzone-content">
                                                    <svg class="dm-dropzone-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                                        <polyline points="14 2 14 8 20 8"/>
                                                        <line x1="12" y1="18" x2="12" y2="12"/>
                                                        <line x1="9" y1="15" x2="15" y2="15"/>
                                                    </svg>
                                                    <p class="dm-dropzone-text">Drop CSV or ZIP file here or <span>browse</span></p>
                                                    <p class="dm-dropzone-hint" id="dm-import-file-name">No file selected</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="dm-card-footer">
                                        <div class="dm-loading" id="dm-import-loading">
                                            <div class="dm-spinner"></div>
                                            <span>Importing...</span>
                                        </div>
                                        <button class="dm-btn dm-btn-success" onclick="importData()">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                                <polyline points="17 8 12 3 7 8"/>
                                                <line x1="12" y1="3" x2="12" y2="15"/>
                                            </svg>
                                            Import Data
                                        </button>
                                    </div>
                                </div>

                                <div class="dm-card dm-card-log dm-card-clickable" id="activity-log-card">
                                    <div class="dm-card-header">
                                        <div class="dm-card-icon dm-icon-gray">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="10"/>
                                                <polyline points="12 6 12 12 16 14"/>
                                            </svg>
                                        </div>
                                        <div class="dm-card-title">
                                            <h2>Activity Log</h2>
                                            <p>Recent import/export history</p>
                                        </div>
                                        <span class="dm-activity-badge" id="dm-activity-badge" style="display:none;">0</span>
                                    </div>
                                    <div class="dm-card-body" id="activity-log-preview">
                                        <div class="activity-empty-state">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="32" height="32">
                                                <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                                            </svg>
                                            <span>No recent activity</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Backup Tab -->
                        <div id="backup-content" class="dm-tab-content">
                            <div class="dm-card">
                                <div class="dm-card-header">
                                    <div class="dm-card-icon dm-icon-purple">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                            <polyline points="17 21 17 13 7 13 7 21"/>
                                            <polyline points="7 3 7 8 15 8"/>
                                        </svg>
                                    </div>
                                    <div class="dm-card-title">
                                        <h2>Full Backup</h2>
                                        <p>Download complete data archive</p>
                                    </div>
                                </div>

                                <div class="dm-card-body">
                                    <div class="dm-backup-preview">
                                        <div class="dm-backup-icon">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                                                <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                                                <line x1="12" y1="22.08" x2="12" y2="12"/>
                                            </svg>
                                        </div>
                                        <div class="dm-backup-info">
                                            <h3>ExpenseTracker_Backup.zip</h3>
                                            <p>Complete backup including all your data</p>
                                        </div>
                                    </div>

                                    <div class="dm-included-list">
                                        <p class="dm-section-label">Backup includes</p>
                                        <div class="dm-included-grid">
                                            <div class="dm-included-item">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                                                <span>Transactions</span>
                                            </div>
                                            <div class="dm-included-item">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                                                <span>Categories</span>
                                            </div>
                                            <div class="dm-included-item">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                                                <span>Accounts</span>
                                            </div>
                                            <div class="dm-included-item">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                                                <span>Rules & Budgets</span>
                                            </div>
                                            <div class="dm-included-item">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                                                <span>Bank Statements</span>
                                            </div>
                                            <div class="dm-included-item">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                                                <span>Receipt Images</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="dm-card-footer">
                                    <div class="dm-loading" id="dm-backup-loading">
                                        <div class="dm-spinner"></div>
                                        <span>Creating backup...</span>
                                    </div>
                                    <button class="dm-btn dm-btn-purple" onclick="createFullBackup()">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                            <polyline points="7 10 12 15 17 10"/>
                                            <line x1="12" y1="15" x2="12" y2="3"/>
                                        </svg>
                                        Download Backup
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Restore Tab -->
                        <div id="restore-content" class="dm-tab-content">
                            <div class="dm-card">
                                <div class="dm-card-header">
                                    <div class="dm-card-icon dm-icon-orange">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="1 4 1 10 7 10"/>
                                            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
                                        </svg>
                                    </div>
                                    <div class="dm-card-title">
                                        <h2>Restore Backup</h2>
                                        <p>Restore from a backup file</p>
                                    </div>
                                </div>

                                <div class="dm-card-body">
                                    <div class="dm-alert dm-alert-warning">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                                            <line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>
                                        </svg>
                                        <div>
                                            <strong>Caution</strong>
                                            <p>Replace mode will permanently delete existing data before restoring.</p>
                                        </div>
                                    </div>

                                    <div class="dm-form-group">
                                        <label class="dm-label">Restore Mode</label>
                                        <div class="dm-radio-cards">
                                            <label class="dm-radio-card">
                                                <input type="radio" name="dm-restore-mode" value="merge" checked>
                                                <div class="dm-radio-content">
                                                    <div class="dm-radio-indicator"></div>
                                                    <div class="dm-radio-text">
                                                        <span class="dm-radio-title">Merge</span>
                                                        <span class="dm-radio-desc">Keep existing data, add new records</span>
                                                    </div>
                                                </div>
                                            </label>
                                            <label class="dm-radio-card">
                                                <input type="radio" name="dm-restore-mode" value="replace">
                                                <div class="dm-radio-content">
                                                    <div class="dm-radio-indicator"></div>
                                                    <div class="dm-radio-text">
                                                        <span class="dm-radio-title">Replace</span>
                                                        <span class="dm-radio-desc">Delete all existing data first</span>
                                                    </div>
                                                </div>
                                            </label>
                                        </div>
                                    </div>

                                    <div class="dm-form-group">
                                        <label class="dm-label">Backup File</label>
                                        <div class="dm-dropzone" id="dm-restore-dropzone">
                                            <input type="file" id="dm-restore-file" accept=".zip" onchange="updateRestoreFileName(this)">
                                            <div class="dm-dropzone-content">
                                                <svg class="dm-dropzone-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                                                    <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                                                    <line x1="12" y1="22.08" x2="12" y2="12"/>
                                                </svg>
                                                <p class="dm-dropzone-text">Drop ZIP file here or <span>browse</span></p>
                                                <p class="dm-dropzone-hint" id="dm-restore-file-name">No file selected</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="dm-card-footer">
                                    <div class="dm-loading" id="dm-restore-loading">
                                        <div class="dm-spinner"></div>
                                        <span>Restoring data...</span>
                                    </div>
                                    <button class="dm-btn dm-btn-warning" onclick="restoreBackup()">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="1 4 1 10 7 10"/>
                                            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
                                        </svg>
                                        Restore Backup
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ========================================= -->
                <!-- ENTITIES (Vendors, Customers, Employees) -->
                <!-- ========================================= -->
                <!-- Vendors Page -->
                <div class="page" id="page-vendors">
                    <div class="page-header">
                        <div>
                            <h1 class="page-title">Vendors</h1>
                            <p class="page-subtitle">Manage vendors and suppliers</p>
                        </div>
                        <button onclick="showAddEntityModal('vendor')" class="btn btn-primary">+ Add Vendor</button>
                    </div>
                    <div class="card" style="padding: 0; overflow: hidden;">
                        <div class="entity-table-header">
                            <div class="search-box">
                                <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                                <input type="text" id="vendors-search" placeholder="Search vendors..." oninput="searchEntitiesByType('vendor', this.value)">
                            </div>
                        </div>
                        <div id="vendors-table-container"></div>
                        <div id="vendors-empty" class="empty-state" style="display: none;">
                            <div class="empty-icon">üè¢</div>
                            <div class="empty-title">No vendors yet</div>
                            <div class="empty-text">Add your first vendor to get started</div>
                            <button onclick="showAddEntityModal('vendor')" class="btn btn-primary" style="margin-top: 16px;">Add Vendor</button>
                        </div>
                    </div>
                </div>

                <!-- Customers Page -->
                <div class="page" id="page-customers">
                    <div class="page-header">
                        <div>
                            <h1 class="page-title">Customers</h1>
                            <p class="page-subtitle">Manage customers and clients</p>
                        </div>
                        <button onclick="showAddEntityModal('customer')" class="btn btn-success">+ Add Customer</button>
                    </div>
                    <div class="card" style="padding: 0; overflow: hidden;">
                        <div class="entity-table-header">
                            <div class="search-box">
                                <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                                <input type="text" id="customers-search" placeholder="Search customers..." oninput="searchEntitiesByType('customer', this.value)">
                            </div>
                        </div>
                        <div id="customers-table-container"></div>
                        <div id="customers-empty" class="empty-state" style="display: none;">
                            <div class="empty-icon">üë§</div>
                            <div class="empty-title">No customers yet</div>
                            <div class="empty-text">Add your first customer to get started</div>
                            <button onclick="showAddEntityModal('customer')" class="btn btn-success" style="margin-top: 16px;">Add Customer</button>
                        </div>
                    </div>
                </div>

                <!-- Employees Page -->
                <div class="page" id="page-employees">
                    <div class="page-header">
                        <div>
                            <h1 class="page-title">Employees</h1>
                            <p class="page-subtitle">Manage employees and staff</p>
                        </div>
                        <button onclick="showAddEntityModal('employee')" class="btn" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">+ Add Employee</button>
                    </div>
                    <div class="card" style="padding: 0; overflow: hidden;">
                        <div class="entity-table-header">
                            <div class="search-box">
                                <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                                <input type="text" id="employees-search" placeholder="Search employees..." oninput="searchEntitiesByType('employee', this.value)">
                            </div>
                        </div>
                        <div id="employees-table-container"></div>
                        <div id="employees-empty" class="empty-state" style="display: none;">
                            <div class="empty-icon">üëî</div>
                            <div class="empty-title">No employees yet</div>
                            <div class="empty-text">Add your first employee to get started</div>
                            <button onclick="showAddEntityModal('employee')" class="btn" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); margin-top: 16px;">Add Employee</button>
                        </div>
                    </div>
                </div>

                <!-- ==================== COST ACCOUNT PAGES ==================== -->

                <!-- Cost Client Ledger Page - IOLTA Style 2-Column Layout -->
                <div class="page" id="page-cost-client-ledger" style="background: #f8fafc;">

                    <!-- LEFT SIDEBAR: Client List -->
                    <div class="cost-sidebar" style="width: 280px; background: white; border-right: 1px solid #e2e8f0; display: flex; flex-direction: column; overflow: hidden;">

                        <!-- Sidebar Header -->
                        <div style="padding: 16px; background: linear-gradient(135deg, #059669 0%, #047857 100%); color: white;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <h3 style="margin: 0; font-size: 15px; font-weight: 600;">Cost Clients</h3>
                                <button onclick="openCostClientModal()" style="width: 26px; height: 26px; border-radius: 6px; background: rgba(255,255,255,0.2); color: white; border: none; cursor: pointer; font-size: 14px;">+</button>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 12px; opacity: 0.9;">
                                <span>Balance</span>
                                <span id="cost-total-balance" style="font-weight: 700;">$0.00</span>
                            </div>
                        </div>

                        <!-- Client Search -->
                        <div style="padding: 10px 12px; border-bottom: 1px solid #e2e8f0;">
                            <div style="position: relative;">
                                <input type="text" id="cost-client-search"
                                       placeholder="Search clients..."
                                       oninput="filterCostClients()"
                                       autocomplete="off"
                                       style="width: 100%; padding: 8px 10px 8px 32px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 13px; box-sizing: border-box;">
                                <svg style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); width: 14px; height: 14px; color: #94a3b8;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                </svg>
                            </div>
                        </div>

                        <!-- Client List -->
                        <div id="cost-client-list" style="flex: 1; overflow-y: auto;">
                            <!-- Populated dynamically -->
                        </div>
                    </div>

                    <!-- RIGHT MAIN AREA -->
                    <div style="flex: 1; display: flex; flex-direction: column; overflow: hidden;">

                        <!-- Action Bar Header -->
                        <div style="padding: 12px 20px; background: white; border-bottom: 1px solid #e2e8f0;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <!-- Selected Client Info -->
                                <div>
                                    <div id="cost-selected-name" style="font-size: 17px; font-weight: 600; color: #1e293b;">All Clients</div>
                                    <div id="cost-selected-detail" style="font-size: 12px; color: #64748b;">Select a client to view transactions</div>
                                </div>

                                <!-- Action Buttons -->
                                <div style="display: flex; gap: 8px; align-items: center;">
                                    <!-- New Transaction Button -->
                                    <button onclick="openCostTransactionModal('deposit')"
                                            style="padding: 9px 14px; background: linear-gradient(135deg, #059669 0%, #047857 100%); color: white; border: none; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                                        + New Transaction
                                    </button>

                                    <!-- Split Cost Button -->
                                    <button onclick="openCostSplitModal()"
                                            style="padding: 9px 14px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                                        <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/></svg>
                                        Split
                                    </button>

                                    <div style="width: 1px; height: 24px; background: #e2e8f0;"></div>

                                    <!-- Check Status Button -->
                                    <button onclick="openCostCheckStatusModal('pending')"
                                            style="padding: 9px 14px; background: #f1f5f9; color: #475569; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                                        Check Status
                                        <span style="display: flex; gap: 4px;">
                                            <span id="cost-pending-count" style="background: #f59e0b; color: white; font-size: 10px; padding: 2px 5px; border-radius: 8px;" title="Pending">0</span>
                                            <span id="cost-printed-count" style="background: #3b82f6; color: white; font-size: 10px; padding: 2px 5px; border-radius: 8px;" title="Printed">0</span>
                                            <span id="cost-cleared-count" style="background: #22c55e; color: white; font-size: 10px; padding: 2px 5px; border-radius: 8px;" title="Cleared">0</span>
                                        </span>
                                    </button>

                                    <div style="width: 1px; height: 24px; background: #e2e8f0;"></div>

                                    <input type="file" id="cost-csv-import" accept=".csv" style="display: none;" onchange="handleCostCsvImport(this)">
                                    <button onclick="document.getElementById('cost-csv-import').click()"
                                            style="padding: 9px 14px; background: #f1f5f9; color: #475569; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 13px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                                        <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
                                        Import
                                    </button>
                                    <button onclick="openCostBatchModal()"
                                            style="padding: 9px 14px; background: #f1f5f9; color: #475569; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 13px; font-weight: 500; cursor: pointer;">
                                        Batch
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Client Balance Bar (shows when client selected) -->
                        <div id="cost-balance-bar" style="display: none; padding: 10px 20px; background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); border-bottom: 1px solid #a7f3d0;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="display: flex; gap: 20px;">
                                    <div>
                                        <div style="font-size: 10px; color: #059669; text-transform: uppercase; font-weight: 500;">Balance</div>
                                        <div id="cost-client-balance" style="font-size: 18px; font-weight: 700; color: #047857;">$0.00</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 10px; color: #64748b; text-transform: uppercase;">Deposits</div>
                                        <div id="cost-client-deposits" style="font-size: 13px; font-weight: 600; color: #10b981;">$0.00</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 10px; color: #64748b; text-transform: uppercase;">Disbursements</div>
                                        <div id="cost-client-disbursements" style="font-size: 13px; font-weight: 600; color: #ef4444;">$0.00</div>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <button onclick="printCostClientStatement()" style="padding: 6px 10px; background: white; color: #374151; border: 1px solid #e2e8f0; border-radius: 5px; font-size: 11px; cursor: pointer;">
                                        Print Statement
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Transaction List -->
                        <div style="flex: 1; padding: 16px 20px; overflow-y: auto;">
                            <div style="background: white; border-radius: 10px; border: 1px solid #e2e8f0; overflow: hidden;">
                                <!-- Search Bar -->
                                <div id="cost-search-bar" style="padding: 12px 16px; background: #f8fafc; border-bottom: 1px solid #e2e8f0; display: flex; gap: 12px; align-items: center;">
                                    <div style="flex: 1; position: relative;">
                                        <input type="text" id="cost-tx-search" placeholder="Search by Reference #, Amount, Description..."
                                               oninput="filterCostTransactions(this.value)"
                                               style="width: 100%; padding: 8px 12px 8px 36px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 13px; box-sizing: border-box;">
                                        <span style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #94a3b8;">&#128269;</span>
                                    </div>
                                    <button id="cost-clear-search-btn" onclick="clearCostTxSearch()" style="display: none; padding: 8px 12px; background: #f1f5f9; border: 1px solid #e2e8f0; border-radius: 6px; cursor: pointer; font-size: 12px; color: #64748b;">
                                        Clear
                                    </button>
                                    <span id="cost-tx-count" style="font-size: 12px; color: #64748b;">0 transactions</span>
                                </div>

                                <!-- Table Header (IOLTA Style) -->
                                <div style="padding: 10px 14px; border-bottom: 1px solid #e2e8f0; background: #f1f5f9;">
                                    <div id="cost-table-header" style="display: grid; grid-template-columns: 36px 85px 70px 130px 60px 1fr 90px 90px 60px; gap: 8px; font-size: 11px; font-weight: 600; color: #64748b; text-transform: uppercase;">
                                        <div><input type="checkbox" id="cost-select-all" onchange="toggleSelectAllCostTx(this.checked)"></div>
                                        <div class="sortable-header" onclick="sortCostTable('date')" style="cursor: pointer; user-select: none;">DATE <span id="cost-sort-icon-date"></span></div>
                                        <div class="sortable-header" onclick="sortCostTable('check')" style="cursor: pointer; user-select: none;">CHECK # <span id="cost-sort-icon-check"></span></div>
                                        <div class="sortable-header" onclick="sortCostTable('payee')" style="cursor: pointer; user-select: none;">PAYEE <span id="cost-sort-icon-payee"></span></div>
                                        <div>TYPE</div>
                                        <div class="sortable-header" onclick="sortCostTable('description')" style="cursor: pointer; user-select: none;">DESCRIPTION <span id="cost-sort-icon-description"></span></div>
                                        <div class="sortable-header" onclick="sortCostTable('amount')" style="text-align: right; cursor: pointer; user-select: none;">AMOUNT <span id="cost-sort-icon-amount"></span></div>
                                        <div style="text-align: right;">BALANCE</div>
                                        <div class="sortable-header" onclick="sortCostTable('status')" style="cursor: pointer; user-select: none;">STATUS <span id="cost-sort-icon-status"></span></div>
                                    </div>
                                </div>

                                <!-- Bulk Actions Bar (IOLTA Style) -->
                                <div id="cost-bulk-actions" style="display: none; padding: 10px 14px; background: #ecfdf5; border-bottom: 1px solid #a7f3d0;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <span id="cost-selected-count" style="font-size: 12px; font-weight: 600; color: #047857;">0 selected</span>
                                        </div>
                                        <div style="display: flex; gap: 8px;">
                                            <button onclick="markSelectedCostAsCleared()" id="cost-clear-status-btn" style="padding: 6px 12px; background: white; color: #374151; border: 1px solid #e2e8f0; border-radius: 5px; font-size: 11px; font-weight: 500; cursor: pointer; display: none;">
                                                Clear
                                            </button>
                                            <button onclick="editSelectedCostTx()" id="cost-edit-btn" style="padding: 6px 12px; background: white; color: #374151; border: 1px solid #e2e8f0; border-radius: 5px; font-size: 11px; font-weight: 500; cursor: pointer; display: none;">
                                                Edit
                                            </button>
                                            <button onclick="openCostMoveModal()" style="padding: 6px 12px; background: white; color: #374151; border: 1px solid #e2e8f0; border-radius: 5px; font-size: 11px; font-weight: 500; cursor: pointer;">
                                                Move to Client
                                            </button>
                                            <button onclick="deleteSelectedCostTx()" style="padding: 6px 12px; background: #fef2f2; color: #dc2626; border: 1px solid #fecaca; border-radius: 5px; font-size: 11px; font-weight: 500; cursor: pointer;">
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Table Body -->
                                <div id="cost-transactions-list" style="max-height: calc(100vh - 320px); overflow-y: auto;">
                                    <div style="padding: 50px 20px; text-align: center; color: #94a3b8;">
                                        <div style="font-size: 40px; margin-bottom: 10px;">üìÑ</div>
                                        <div style="font-size: 15px; font-weight: 500;">Select a client</div>
                                        <div style="font-size: 12px; margin-top: 4px;">to view their transaction history</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cost Accounts Page -->
                <div class="page" id="page-cost-accounts">
                    <div style="flex: 1; display: flex; flex-direction: column; min-width: 0; background: #f8fafc; overflow: hidden;">
                        <div style="padding: 20px 24px; background: white; border-bottom: 1px solid #e2e8f0;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h2 style="margin: 0; font-size: 22px; font-weight: 600; color: #1e293b;">Cost Accounts</h2>
                                    <p style="margin: 4px 0 0; font-size: 13px; color: #64748b;">Manage credit cards and bank accounts for cost tracking</p>
                                </div>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <button onclick="openCostAccountModal()" style="padding: 8px 16px; background: linear-gradient(135deg, #059669 0%, #047857 100%); color: white; border: none; border-radius: 8px; font-size: 13px; font-weight: 500; cursor: pointer;">
                                        + Add Account
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div style="flex: 1; overflow-y: auto; padding: 24px;">
                            <div id="cost-accounts-grid" class="accounts-grid">
                                <!-- Cost account cards will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cost Operations Page -->
                <div class="page" id="page-cost-operations">
                    <div style="flex: 1; display: flex; flex-direction: column; min-width: 0; background: #f8fafc; overflow: hidden;">
                        <div style="padding: 20px 24px; background: white; border-bottom: 1px solid #e2e8f0;">
                            <h2 style="margin: 0; font-size: 22px; font-weight: 600; color: #1e293b;">Cost Operations</h2>
                            <p style="margin: 4px 0 0; font-size: 13px; color: #64748b;">Manage cost deposits and disbursements</p>
                        </div>
                        <div style="padding: 24px;">
                            <div class="ops-tabs" style="display: flex; gap: 8px; margin-bottom: 24px;">
                                <button class="ops-tab active" data-tab="receive" onclick="switchCostOperationsTab('receive')" style="padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; background: #059669; color: white;">
                                    Deposit
                                </button>
                                <button class="ops-tab" data-tab="disburse" onclick="switchCostOperationsTab('disburse')" style="padding: 10px 20px; border: 1px solid #e2e8f0; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; background: white; color: #64748b;">
                                    Payout
                                </button>
                            </div>
                            <div id="cost-ops-tab-receive" class="cost-ops-tab-content" style="display: flex; gap: 24px;">
                                <div style="width: 300px; background: white; border-radius: 12px; border: 1px solid #e2e8f0; overflow: hidden;">
                                    <div style="padding: 16px; border-bottom: 1px solid #e2e8f0; background: #f8fafc;">
                                        <h3 style="margin: 0; font-size: 14px; font-weight: 600; color: #1e293b;">Select Client</h3>
                                    </div>
                                    <div id="cost-deposit-clients" style="max-height: 500px; overflow-y: auto;"></div>
                                </div>
                                <div style="flex: 1; background: white; border-radius: 12px; border: 1px solid #e2e8f0; padding: 24px;">
                                    <div id="cost-deposit-form-container">
                                        <div style="text-align: center; padding: 60px 20px; color: #64748b;">
                                            <p>Select a client to record a deposit</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="cost-ops-tab-disburse" class="cost-ops-tab-content" style="display: none; gap: 24px;">
                                <div style="width: 300px; background: white; border-radius: 12px; border: 1px solid #e2e8f0; overflow: hidden;">
                                    <div style="padding: 16px; border-bottom: 1px solid #e2e8f0; background: #f8fafc;">
                                        <h3 style="margin: 0; font-size: 14px; font-weight: 600; color: #1e293b;">Select Client</h3>
                                    </div>
                                    <div id="cost-disburse-clients" style="max-height: 500px; overflow-y: auto;"></div>
                                </div>
                                <div style="flex: 1; background: white; border-radius: 12px; border: 1px solid #e2e8f0; padding: 24px;">
                                    <div id="cost-disburse-form-container">
                                        <div style="text-align: center; padding: 60px 20px; color: #64748b;">
                                            <p>Select a client to record a disbursement</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cost Reconcile Page -->
                <div class="page" id="page-cost-reconcile">
                    <!-- Content loaded dynamically by cost-reconcile.js -->
                </div>

                <!-- Cost Data Management Page -->
                <div class="page" id="page-cost-data-management">
                    <div class="dm-container" style="padding: 0; max-width: 100%;">
                        <!-- Header -->
                        <div class="dm-header" style="background: linear-gradient(135deg, #059669 0%, #047857 100%); margin: 0; padding: 32px 40px; border-radius: 0;">
                            <div class="dm-header-content">
                                <h1 style="color: white;">Data Management</h1>
                                <p style="color: rgba(255,255,255,0.85);">Export, import, backup and restore your cost account data</p>
                            </div>
                        </div>

                        <!-- Navigation Tabs -->
                        <div class="dm-nav" style="margin: 32px 40px;">
                            <button class="dm-nav-item active" data-tab="cost-export" onclick="switchCostDmTab('export')">
                                <svg class="dm-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="17 8 12 3 7 8"/>
                                    <line x1="12" y1="3" x2="12" y2="15"/>
                                </svg>
                                <span>Export</span>
                            </button>
                            <button class="dm-nav-item" data-tab="cost-import" onclick="switchCostDmTab('import')">
                                <svg class="dm-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                <span>Import</span>
                            </button>
                            <button class="dm-nav-item" data-tab="cost-backup" onclick="switchCostDmTab('backup')">
                                <svg class="dm-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                    <polyline points="17 21 17 13 7 13 7 21"/>
                                    <polyline points="7 3 7 8 15 8"/>
                                </svg>
                                <span>Backup</span>
                            </button>
                            <button class="dm-nav-item" data-tab="cost-restore" onclick="switchCostDmTab('restore')">
                                <svg class="dm-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="1 4 1 10 7 10"/>
                                    <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
                                </svg>
                                <span>Restore</span>
                            </button>
                        </div>

                        <!-- Export Tab -->
                        <div id="cost-export-content" class="dm-tab-content active" style="padding: 0 40px 40px;">
                            <div class="dm-card">
                                <div class="dm-card-header">
                                    <div class="dm-card-icon dm-icon-blue" style="background: #d1fae5; color: #059669;">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                            <polyline points="17 8 12 3 7 8"/>
                                            <line x1="12" y1="3" x2="12" y2="15"/>
                                        </svg>
                                    </div>
                                    <div class="dm-card-title">
                                        <h2>Export Data</h2>
                                        <p>Download your data as CSV files</p>
                                    </div>
                                </div>

                                <div class="dm-card-body">
                                    <p class="dm-section-label">Select data to export</p>
                                    <div class="dm-export-grid">
                                        <label class="dm-checkbox-card">
                                            <input type="checkbox" name="cost-dm-export" value="transactions" checked>
                                            <div class="dm-checkbox-content">
                                                <div class="dm-checkbox-icon">
                                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                                                    </svg>
                                                </div>
                                                <span class="dm-checkbox-label">Transactions</span>
                                                <span class="dm-checkbox-desc">All cost transactions</span>
                                            </div>
                                            <div class="dm-checkbox-check">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                                    <polyline points="20 6 9 17 4 12"/>
                                                </svg>
                                            </div>
                                        </label>
                                        <label class="dm-checkbox-card">
                                            <input type="checkbox" name="cost-dm-export" value="clients">
                                            <div class="dm-checkbox-content">
                                                <div class="dm-checkbox-icon">
                                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                                        <circle cx="9" cy="7" r="4"/>
                                                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                                                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                                                    </svg>
                                                </div>
                                                <span class="dm-checkbox-label">Clients</span>
                                                <span class="dm-checkbox-desc">Client information</span>
                                            </div>
                                            <div class="dm-checkbox-check">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                                    <polyline points="20 6 9 17 4 12"/>
                                                </svg>
                                            </div>
                                        </label>
                                        <label class="dm-checkbox-card">
                                            <input type="checkbox" name="cost-dm-export" value="accounts">
                                            <div class="dm-checkbox-content">
                                                <div class="dm-checkbox-icon">
                                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/>
                                                    </svg>
                                                </div>
                                                <span class="dm-checkbox-label">Accounts</span>
                                                <span class="dm-checkbox-desc">Bank accounts</span>
                                            </div>
                                            <div class="dm-checkbox-check">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                                    <polyline points="20 6 9 17 4 12"/>
                                                </svg>
                                            </div>
                                        </label>
                                        <label class="dm-checkbox-card">
                                            <input type="checkbox" name="cost-dm-export" value="summary">
                                            <div class="dm-checkbox-content">
                                                <div class="dm-checkbox-icon">
                                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M21.21 15.89A10 10 0 1 1 8 2.83"/>
                                                        <path d="M22 12A10 10 0 0 0 12 2v10z"/>
                                                    </svg>
                                                </div>
                                                <span class="dm-checkbox-label">Summary</span>
                                                <span class="dm-checkbox-desc">Client balances</span>
                                            </div>
                                            <div class="dm-checkbox-check">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                                    <polyline points="20 6 9 17 4 12"/>
                                                </svg>
                                            </div>
                                        </label>
                                    </div>
                                </div>

                                <div class="dm-card-footer">
                                    <div class="dm-loading" id="cost-dm-export-loading">
                                        <div class="dm-spinner"></div>
                                        <span>Preparing download...</span>
                                    </div>
                                    <button class="dm-btn dm-btn-primary" onclick="exportCostData()" style="background: #059669;">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                            <polyline points="7 10 12 15 17 10"/>
                                            <line x1="12" y1="15" x2="12" y2="3"/>
                                        </svg>
                                        Download CSV Files
                                    </button>
                                </div>
                            </div>

                            <!-- Additional Export Features -->
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; margin-top: 32px; align-items: stretch;">
                                <!-- Generate Statement -->
                                <div style="background: white; border: 1px solid #e2e8f0; border-radius: 12px; overflow: hidden; display: flex; flex-direction: column;">
                                    <div style="padding: 20px; border-bottom: 1px solid #e2e8f0;">
                                        <div style="display: flex; align-items: center; gap: 12px;">
                                            <div style="width: 40px; height: 40px; background: #f1f5f9; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#475569" stroke-width="2">
                                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                                    <polyline points="14 2 14 8 20 8"/>
                                                    <line x1="16" y1="13" x2="8" y2="13"/>
                                                    <line x1="16" y1="17" x2="8" y2="17"/>
                                                </svg>
                                            </div>
                                            <div>
                                                <h3 style="margin: 0; color: #1e293b; font-size: 15px; font-weight: 600;">Generate Statement</h3>
                                                <p style="margin: 2px 0 0; color: #64748b; font-size: 12px;">PDF statement by date range</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding: 20px; flex: 1; display: flex; flex-direction: column;">
                                        <div style="flex: 1;">
                                            <div style="margin-bottom: 16px;">
                                                <label style="display: block; font-size: 12px; font-weight: 500; color: #64748b; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">Account</label>
                                                <select id="cost-stmt-account" style="width: 100%; padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 14px; background: white; color: #1e293b;">
                                                    <option value="">All Accounts</option>
                                                </select>
                                            </div>
                                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                                                <div>
                                                    <label style="display: block; font-size: 12px; font-weight: 500; color: #64748b; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">From</label>
                                                    <input type="date" id="cost-stmt-from" style="width: 100%; padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 14px; box-sizing: border-box;">
                                                </div>
                                                <div>
                                                    <label style="display: block; font-size: 12px; font-weight: 500; color: #64748b; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">To</label>
                                                    <input type="date" id="cost-stmt-to" style="width: 100%; padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 14px; box-sizing: border-box;">
                                                </div>
                                            </div>
                                        </div>
                                        <button onclick="generateCostStatement()" style="display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%; padding: 10px 16px; background: #1e293b; color: white; border: none; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; margin-top: auto;">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                                <polyline points="14 2 14 8 20 8"/>
                                            </svg>
                                            Generate PDF
                                        </button>
                                    </div>
                                </div>

                                <!-- Print Ledger -->
                                <div style="background: white; border: 1px solid #e2e8f0; border-radius: 12px; overflow: hidden; display: flex; flex-direction: column;">
                                    <div style="padding: 20px; border-bottom: 1px solid #e2e8f0;">
                                        <div style="display: flex; align-items: center; gap: 12px;">
                                            <div style="width: 40px; height: 40px; background: #f1f5f9; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#475569" stroke-width="2">
                                                    <polyline points="6 9 6 2 18 2 18 9"/>
                                                    <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/>
                                                    <rect x="6" y="14" width="12" height="8"/>
                                                </svg>
                                            </div>
                                            <div>
                                                <h3 style="margin: 0; color: #1e293b; font-size: 15px; font-weight: 600;">Print Ledger</h3>
                                                <p style="margin: 2px 0 0; color: #64748b; font-size: 12px;">Client ledger report</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding: 20px; flex: 1; display: flex; flex-direction: column;">
                                        <div style="flex: 1;">
                                            <div style="margin-bottom: 16px;">
                                                <label style="display: block; font-size: 12px; font-weight: 500; color: #64748b; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">Search Client</label>
                                                <div style="position: relative;">
                                                    <input type="text" id="cost-print-client-search" placeholder="Type to search clients..." autocomplete="off"
                                                        style="width: 100%; padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 14px; background: white; color: #1e293b; box-sizing: border-box;">
                                                    <input type="hidden" id="cost-print-client" value="">
                                                    <div id="cost-print-client-dropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; max-height: 200px; overflow-y: auto; background: white; border: 1px solid #e2e8f0; border-top: none; border-radius: 0 0 6px 6px; z-index: 100; box-shadow: 0 4px 6px rgba(0,0,0,0.1);"></div>
                                                </div>
                                            </div>
                                            <div style="margin-bottom: 16px;">
                                                <label style="display: block; font-size: 12px; font-weight: 500; color: #64748b; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;">Include</label>
                                                <div style="display: flex; gap: 20px;">
                                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                                        <input type="checkbox" id="cost-print-summary" checked style="width: 16px; height: 16px; accent-color: #1e293b;">
                                                        <span style="font-size: 13px; color: #475569;">Summary</span>
                                                    </label>
                                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                                        <input type="checkbox" id="cost-print-details" checked style="width: 16px; height: 16px; accent-color: #1e293b;">
                                                        <span style="font-size: 13px; color: #475569;">Details</span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <button onclick="printCostLedger()" style="display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%; padding: 10px 16px; background: #1e293b; color: white; border: none; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; margin-top: auto;">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="6 9 6 2 18 2 18 9"/>
                                                <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/>
                                            </svg>
                                            Print
                                        </button>
                                    </div>
                                </div>

                                <!-- Email Report -->
                                <div style="background: white; border: 1px solid #e2e8f0; border-radius: 12px; overflow: hidden; display: flex; flex-direction: column;">
                                    <div style="padding: 20px; border-bottom: 1px solid #e2e8f0;">
                                        <div style="display: flex; align-items: center; gap: 12px;">
                                            <div style="width: 40px; height: 40px; background: #f1f5f9; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#475569" stroke-width="2">
                                                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                                    <polyline points="22,6 12,13 2,6"/>
                                                </svg>
                                            </div>
                                            <div>
                                                <h3 style="margin: 0; color: #1e293b; font-size: 15px; font-weight: 600;">Email Report</h3>
                                                <p style="margin: 2px 0 0; color: #64748b; font-size: 12px;">Send via email</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding: 20px; flex: 1; display: flex; flex-direction: column;">
                                        <div style="flex: 1;">
                                            <div style="margin-bottom: 16px;">
                                                <label style="display: block; font-size: 12px; font-weight: 500; color: #64748b; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">Recipient</label>
                                                <input type="email" id="cost-email-to" placeholder="email@example.com" style="width: 100%; padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 14px; box-sizing: border-box;">
                                            </div>
                                            <div style="margin-bottom: 16px;">
                                                <label style="display: block; font-size: 12px; font-weight: 500; color: #64748b; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">Report Type</label>
                                                <select id="cost-email-type" style="width: 100%; padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 14px; background: white; color: #1e293b;">
                                                    <option value="summary">Summary Report</option>
                                                    <option value="detailed">Detailed Ledger</option>
                                                    <option value="client">Client Statement</option>
                                                </select>
                                            </div>
                                        </div>
                                        <button onclick="emailCostReport()" style="display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%; padding: 10px 16px; background: #1e293b; color: white; border: none; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; margin-top: auto;">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <line x1="22" y1="2" x2="11" y2="13"/>
                                                <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                                            </svg>
                                            Send Email
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Import Tab -->
                        <div id="cost-import-content" class="dm-tab-content" style="padding: 0 40px 40px;">
                            <div class="dm-grid-2">
                                <div class="dm-card">
                                    <div class="dm-card-header">
                                        <div class="dm-card-icon dm-icon-green" style="background: #d1fae5; color: #059669;">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                                <polyline points="7 10 12 15 17 10"/>
                                                <line x1="12" y1="15" x2="12" y2="3"/>
                                            </svg>
                                        </div>
                                        <div class="dm-card-title">
                                            <h2>Import Data</h2>
                                            <p>Upload CSV files to import</p>
                                        </div>
                                    </div>

                                    <div class="dm-card-body">
                                        <div class="dm-form-group">
                                            <label class="dm-label">Import Format</label>
                                            <select class="dm-select" id="cost-dm-import-format">
                                                <option value="chase">Chase (Checking/Credit Card)</option>
                                                <option value="amex">American Express (AMEX)</option>
                                                <option value="generic">Generic CSV</option>
                                            </select>
                                        </div>

                                        <div class="dm-form-group">
                                            <label class="dm-label">Import to Account</label>
                                            <select class="dm-select" id="cost-dm-import-account">
                                                <option value="">Select account...</option>
                                            </select>
                                        </div>

                                        <div class="dm-form-group">
                                            <label class="dm-label">CSV or ZIP File</label>
                                            <div class="dm-dropzone" id="cost-dm-import-dropzone">
                                                <input type="file" id="cost-dm-import-file" accept=".csv,.zip" onchange="updateCostImportFileName(this)">
                                                <div class="dm-dropzone-content">
                                                    <svg class="dm-dropzone-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                                        <polyline points="14 2 14 8 20 8"/>
                                                        <line x1="12" y1="18" x2="12" y2="12"/>
                                                        <line x1="9" y1="15" x2="15" y2="15"/>
                                                    </svg>
                                                    <p class="dm-dropzone-text">Drop CSV or ZIP file here or <span>browse</span></p>
                                                    <p class="dm-dropzone-hint" id="cost-dm-import-file-name">No file selected</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="dm-card-footer">
                                        <div class="dm-loading" id="cost-dm-import-loading">
                                            <div class="dm-spinner"></div>
                                            <span>Importing...</span>
                                        </div>
                                        <button class="dm-btn dm-btn-success" onclick="importCostData()" style="background: #059669;">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                                <polyline points="17 8 12 3 7 8"/>
                                                <line x1="12" y1="3" x2="12" y2="15"/>
                                            </svg>
                                            Import Data
                                        </button>
                                    </div>
                                </div>

                                <div class="dm-card dm-card-log dm-card-clickable" id="cost-activity-log-card">
                                    <div class="dm-card-header">
                                        <div class="dm-card-icon dm-icon-gray">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="10"/>
                                                <polyline points="12 6 12 12 16 14"/>
                                            </svg>
                                        </div>
                                        <div class="dm-card-title">
                                            <h2>Activity Log</h2>
                                            <p>Recent import/export history</p>
                                        </div>
                                        <span class="dm-activity-badge" id="cost-dm-activity-badge" style="display:none;">0</span>
                                    </div>
                                    <div class="dm-card-body" id="cost-activity-log-preview">
                                        <div class="activity-empty-state">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="32" height="32">
                                                <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                                            </svg>
                                            <span>No recent activity</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Backup Tab -->
                        <div id="cost-backup-content" class="dm-tab-content" style="padding: 0 40px 40px;">
                            <div class="dm-card">
                                <div class="dm-card-header">
                                    <div class="dm-card-icon dm-icon-purple" style="background: #ede9fe; color: #7c3aed;">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                            <polyline points="17 21 17 13 7 13 7 21"/>
                                            <polyline points="7 3 7 8 15 8"/>
                                        </svg>
                                    </div>
                                    <div class="dm-card-title">
                                        <h2>Full Backup</h2>
                                        <p>Download complete cost account data archive</p>
                                    </div>
                                </div>

                                <div class="dm-card-body">
                                    <div class="dm-backup-preview">
                                        <div class="dm-backup-icon">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                                                <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                                                <line x1="12" y1="22.08" x2="12" y2="12"/>
                                            </svg>
                                        </div>
                                        <div class="dm-backup-info">
                                            <h3>CostAccount_Backup.zip</h3>
                                            <p>Complete backup including all cost account data</p>
                                        </div>
                                    </div>

                                    <div class="dm-included-list">
                                        <p class="dm-section-label">Backup includes</p>
                                        <div class="dm-included-grid">
                                            <div class="dm-included-item">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                                                <span>Transactions</span>
                                            </div>
                                            <div class="dm-included-item">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                                                <span>Clients</span>
                                            </div>
                                            <div class="dm-included-item">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                                                <span>Accounts</span>
                                            </div>
                                            <div class="dm-included-item">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                                                <span>Client Balances</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="dm-card-footer">
                                    <div class="dm-loading" id="cost-dm-backup-loading">
                                        <div class="dm-spinner"></div>
                                        <span>Creating backup...</span>
                                    </div>
                                    <button class="dm-btn dm-btn-purple" onclick="createCostFullBackup()">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                            <polyline points="7 10 12 15 17 10"/>
                                            <line x1="12" y1="15" x2="12" y2="3"/>
                                        </svg>
                                        Download Backup
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Restore Tab -->
                        <div id="cost-restore-content" class="dm-tab-content" style="padding: 0 40px 40px;">
                            <div class="dm-card">
                                <div class="dm-card-header">
                                    <div class="dm-card-icon dm-icon-orange" style="background: #ffedd5; color: #ea580c;">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="1 4 1 10 7 10"/>
                                            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
                                        </svg>
                                    </div>
                                    <div class="dm-card-title">
                                        <h2>Restore Backup</h2>
                                        <p>Restore from a backup file</p>
                                    </div>
                                </div>

                                <div class="dm-card-body">
                                    <div class="dm-alert dm-alert-warning">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                                            <line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>
                                        </svg>
                                        <div>
                                            <strong>Caution</strong>
                                            <p>Replace mode will permanently delete existing cost account data before restoring.</p>
                                        </div>
                                    </div>

                                    <div class="dm-form-group">
                                        <label class="dm-label">Restore Mode</label>
                                        <div class="dm-radio-cards">
                                            <label class="dm-radio-card">
                                                <input type="radio" name="cost-dm-restore-mode" value="merge" checked>
                                                <div class="dm-radio-content">
                                                    <div class="dm-radio-indicator"></div>
                                                    <div class="dm-radio-text">
                                                        <span class="dm-radio-title">Merge</span>
                                                        <span class="dm-radio-desc">Keep existing data, add new records</span>
                                                    </div>
                                                </div>
                                            </label>
                                            <label class="dm-radio-card">
                                                <input type="radio" name="cost-dm-restore-mode" value="replace">
                                                <div class="dm-radio-content">
                                                    <div class="dm-radio-indicator"></div>
                                                    <div class="dm-radio-text">
                                                        <span class="dm-radio-title">Replace</span>
                                                        <span class="dm-radio-desc">Delete all existing data first</span>
                                                    </div>
                                                </div>
                                            </label>
                                        </div>
                                    </div>

                                    <div class="dm-form-group">
                                        <label class="dm-label">Backup File</label>
                                        <div class="dm-dropzone" id="cost-dm-restore-dropzone">
                                            <input type="file" id="cost-dm-restore-file" accept=".zip" onchange="updateCostRestoreFileName(this)">
                                            <div class="dm-dropzone-content">
                                                <svg class="dm-dropzone-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                                                    <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                                                    <line x1="12" y1="22.08" x2="12" y2="12"/>
                                                </svg>
                                                <p class="dm-dropzone-text">Drop ZIP file here or <span>browse</span></p>
                                                <p class="dm-dropzone-hint" id="cost-dm-restore-file-name">No file selected</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="dm-card-footer">
                                    <div class="dm-loading" id="cost-dm-restore-loading">
                                        <div class="dm-spinner"></div>
                                        <span>Restoring data...</span>
                                    </div>
                                    <button class="dm-btn dm-btn-warning" onclick="restoreCostBackup()">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="1 4 1 10 7 10"/>
                                            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
                                        </svg>
                                        Restore Backup
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cost Reports Page -->
                <div class="page" id="page-cost-reports">
                    <div class="page-header" style="background: linear-gradient(135deg, #059669 0%, #047857 100%); color: white; padding: 24px; border-radius: 12px; margin-bottom: 24px; width: 100%; box-sizing: border-box;">
                        <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                            <div style="flex-shrink: 0;">
                                <h1 class="page-title" style="color: white; margin: 0;">Cost Reports</h1>
                                <p class="page-subtitle" style="color: rgba(255,255,255,0.8); margin: 4px 0 0;">Cost account analytics and client summary</p>
                            </div>
                            <div style="display: flex; gap: 12px; align-items: center; margin-left: auto;">
                                <select id="cost-report-period" onchange="loadCostReportData()" style="padding: 8px 12px; border: 1px solid rgba(255,255,255,0.3); border-radius: 6px; background: rgba(255,255,255,0.1); color: white; font-size: 14px; cursor: pointer;">
                                    <option value="this_month" style="background: #1e293b; color: white;">This Month</option>
                                    <option value="last_month" style="background: #1e293b; color: white;">Last Month</option>
                                    <option value="this_quarter" style="background: #1e293b; color: white;">This Quarter</option>
                                    <option value="ytd" selected style="background: #1e293b; color: white;">Year to Date</option>
                                    <option value="last_year" style="background: #1e293b; color: white;">Last Year</option>
                                    <option value="all" style="background: #1e293b; color: white;">All Time</option>
                                </select>
                                <button onclick="exportCostReport()" style="padding: 8px 16px; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); border-radius: 6px; color: white; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                        <polyline points="7 10 12 15 17 10"/>
                                        <line x1="12" y1="15" x2="12" y2="3"/>
                                    </svg>
                                    Export
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Summary Cards -->
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px;">
                        <div class="card" style="padding: 20px; text-align: center;">
                            <div style="font-size: 12px; color: #64748b; text-transform: uppercase; margin-bottom: 8px;">Total Clients</div>
                            <div id="cost-report-total-clients" style="font-size: 28px; font-weight: 700; color: #1e293b;">0</div>
                        </div>
                        <div class="card" style="padding: 20px; text-align: center;">
                            <div style="font-size: 12px; color: #64748b; text-transform: uppercase; margin-bottom: 8px;">Total Deposits</div>
                            <div id="cost-report-total-deposits" style="font-size: 28px; font-weight: 700; color: #10b981;">$0.00</div>
                        </div>
                        <div class="card" style="padding: 20px; text-align: center;">
                            <div style="font-size: 12px; color: #64748b; text-transform: uppercase; margin-bottom: 8px;">Total Payouts</div>
                            <div id="cost-report-total-payouts" style="font-size: 28px; font-weight: 700; color: #ef4444;">$0.00</div>
                        </div>
                        <div class="card" style="padding: 20px; text-align: center;">
                            <div style="font-size: 12px; color: #64748b; text-transform: uppercase; margin-bottom: 8px;">Current Balance</div>
                            <div id="cost-report-balance" style="font-size: 28px; font-weight: 700; color: #059669;">$0.00</div>
                        </div>
                    </div>

                    <!-- Charts Row -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
                        <div class="card" style="padding: 20px;">
                            <h3 style="margin: 0 0 16px; font-size: 16px; color: #1e293b;">Monthly Activity</h3>
                            <div style="height: 250px;">
                                <canvas id="cost-monthly-chart"></canvas>
                            </div>
                        </div>
                        <div class="card" style="padding: 20px;">
                            <h3 style="margin: 0 0 16px; font-size: 16px; color: #1e293b;">Top Clients by Balance</h3>
                            <div style="height: 250px;">
                                <canvas id="cost-clients-chart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Client Summary Table -->
                    <div class="card" style="padding: 0; overflow: hidden;">
                        <div style="padding: 16px 20px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;">
                            <h3 style="margin: 0; font-size: 16px; color: #1e293b;">Client Summary</h3>
                            <input type="text" id="cost-report-search" placeholder="Search clients..." oninput="filterCostReportTable(this.value)" style="padding: 6px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 13px; width: 200px;">
                        </div>
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                                <thead>
                                    <tr style="background: #f8fafc;">
                                        <th style="padding: 12px 16px; text-align: left; font-weight: 600; color: #64748b; border-bottom: 1px solid #e2e8f0;">Client</th>
                                        <th style="padding: 12px 16px; text-align: left; font-weight: 600; color: #64748b; border-bottom: 1px solid #e2e8f0;">Case #</th>
                                        <th style="padding: 12px 16px; text-align: right; font-weight: 600; color: #64748b; border-bottom: 1px solid #e2e8f0;">Deposits</th>
                                        <th style="padding: 12px 16px; text-align: right; font-weight: 600; color: #64748b; border-bottom: 1px solid #e2e8f0;">Payouts</th>
                                        <th style="padding: 12px 16px; text-align: right; font-weight: 600; color: #64748b; border-bottom: 1px solid #e2e8f0;">Balance</th>
                                        <th style="padding: 12px 16px; text-align: center; font-weight: 600; color: #64748b; border-bottom: 1px solid #e2e8f0;">Transactions</th>
                                    </tr>
                                </thead>
                                <tbody id="cost-report-table-body">
                                    <tr>
                                        <td colspan="6" style="padding: 40px; text-align: center; color: #94a3b8;">Loading...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- ==================== END COST ACCOUNT PAGES ==================== -->

                <!-- ========================================= -->
                <!-- IOLTA ACCOUNT PAGES -->
                <!-- ========================================= -->

                <!-- UNIFIED IOLTA PAGE - Combined Operations + Ledger -->
                <div class="page" id="page-iolta" style="background: #f8fafc;">

                    <!-- LEFT SIDEBAR: Client List -->
                    <div class="iolta-sidebar" style="background: white; border-right: 1px solid #e2e8f0; display: flex; flex-direction: column; overflow: hidden;">

                        <!-- Sidebar Header -->
                        <div style="padding: 16px; background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%); color: white;">
                            <div style="margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                                <h3 style="margin: 0; font-size: 15px; font-weight: 600;">Trust Clients</h3>
                                <button onclick="openTrustClientModal()" style="width: 24px; height: 24px; border-radius: 6px; border: none; background: rgba(255,255,255,0.2); color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; font-weight: 500; transition: background 0.15s;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">+</button>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 12px; opacity: 0.9;">
                                <span>Balance</span>
                                <span id="iolta-total-balance" style="font-weight: 700;">$0.00</span>
                            </div>
                        </div>

                        <!-- Client Search -->
                        <div style="padding: 10px 12px; border-bottom: 1px solid #e2e8f0;">
                            <div style="position: relative;">
                                <input type="text" id="iolta-client-search"
                                       placeholder="Search clients..."
                                       oninput="filterIoltaClients()"
                                       autocomplete="off"
                                       style="width: 100%; padding: 8px 10px 8px 32px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 13px; box-sizing: border-box;">
                                <svg style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); width: 14px; height: 14px; color: #94a3b8;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                </svg>
                            </div>
                        </div>

                        <!-- Client List -->
                        <div id="iolta-client-list" style="flex: 1; overflow-y: auto;">
                            <!-- Populated dynamically -->
                        </div>
                    </div>

                    <!-- RIGHT MAIN AREA -->
                    <div style="flex: 1; display: flex; flex-direction: column; overflow: hidden;">

                        <!-- Action Bar Header -->
                        <div style="padding: 12px 20px; background: white; border-bottom: 1px solid #e2e8f0;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <!-- Selected Client Info -->
                                <div>
                                    <div id="iolta-selected-name" style="font-size: 17px; font-weight: 600; color: #1e293b;">All Clients</div>
                                    <div id="iolta-selected-detail" style="font-size: 12px; color: #64748b;">Select a client to view transactions</div>
                                </div>

                                <!-- Action Buttons -->
                                <div style="display: flex; gap: 8px; align-items: center;">
                                    <!-- New Transaction Button (opens unified modal with tabs) -->
                                    <button onclick="openNewTransactionModal('deposit')"
                                            style="padding: 9px 14px; background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); color: white; border: none; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                                        + New Transaction
                                    </button>

                                    <!-- Split Transaction Button -->
                                    <div style="position: relative; display: inline-block;">
                                        <button id="split-dropdown-btn" onclick="toggleSplitDropdown()"
                                                style="padding: 9px 14px; background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; border: none; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                                            <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/></svg>
                                            Split
                                            <svg width="10" height="10" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/></svg>
                                        </button>
                                        <div id="split-dropdown-menu" style="display: none; position: absolute; top: 100%; left: 0; margin-top: 4px; background: white; border: 1px solid #e2e8f0; border-radius: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); z-index: 1000; min-width: 160px; overflow: hidden;">
                                            <button onclick="openSplitTransactionModal('check'); closeSplitDropdown();" style="width: 100%; padding: 10px 14px; background: none; border: none; text-align: left; cursor: pointer; font-size: 13px; color: #374151; display: flex; align-items: center; gap: 10px; transition: background 0.15s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='none'">
                                                <span style="font-size: 16px;">üìù</span> Split Check
                                            </button>
                                            <button onclick="openSplitTransactionModal('deposit'); closeSplitDropdown();" style="width: 100%; padding: 10px 14px; background: none; border: none; text-align: left; cursor: pointer; font-size: 13px; color: #374151; display: flex; align-items: center; gap: 10px; transition: background 0.15s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='none'">
                                                <span style="font-size: 16px;">üì•</span> Split Deposit
                                            </button>
                                        </div>
                                    </div>

                                    <div style="width: 1px; height: 24px; background: #e2e8f0;"></div>

                                    <!-- Check Status Button (opens unified modal with tabs) -->
                                    <button onclick="openCheckStatusModal('pending')"
                                            style="padding: 9px 14px; background: #f1f5f9; color: #475569; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                                        Check Status
                                        <span style="display: flex; gap: 4px;">
                                            <span id="iolta-pending-count" class="pending-checks-count" style="background: #f59e0b; color: white; font-size: 10px; padding: 2px 5px; border-radius: 8px;" title="Pending">0</span>
                                            <span id="iolta-printed-count" style="background: #3b82f6; color: white; font-size: 10px; padding: 2px 5px; border-radius: 8px;" title="Printed">0</span>
                                            <span id="iolta-cleared-count" style="background: #22c55e; color: white; font-size: 10px; padding: 2px 5px; border-radius: 8px;" title="Cleared">0</span>
                                        </span>
                                    </button>

                                    <div style="width: 1px; height: 24px; background: #e2e8f0;"></div>

                                    <input type="file" id="iolta-csv-import" accept=".csv" style="display: none;" onchange="handleIoltaCsvImport(this)">
                                    <button onclick="document.getElementById('iolta-csv-import').click()"
                                            style="padding: 9px 14px; background: #f1f5f9; color: #475569; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 13px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                                        <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
                                        Import
                                    </button>
                                    <button onclick="openNewBatchModal()"
                                            style="padding: 9px 14px; background: #f1f5f9; color: #475569; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 13px; font-weight: 500; cursor: pointer;">
                                        Batch
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Client Balance Bar (shows when client selected) -->
                        <div id="iolta-balance-bar" style="display: none; padding: 10px 20px; background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); border-bottom: 1px solid #a7f3d0;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="display: flex; gap: 20px;">
                                    <div>
                                        <div style="font-size: 10px; color: #059669; text-transform: uppercase; font-weight: 500;">Balance</div>
                                        <div id="iolta-client-balance" style="font-size: 18px; font-weight: 700; color: #047857;">$0.00</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 10px; color: #64748b; text-transform: uppercase;">Deposits</div>
                                        <div id="iolta-client-deposits" style="font-size: 13px; font-weight: 600; color: #10b981;">$0.00</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 10px; color: #64748b; text-transform: uppercase;">Disbursements</div>
                                        <div id="iolta-client-disbursements" style="font-size: 13px; font-weight: 600; color: #ef4444;">$0.00</div>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <button onclick="printClientStatement()" style="padding: 6px 10px; background: white; color: #374151; border: 1px solid #e2e8f0; border-radius: 5px; font-size: 11px; cursor: pointer;">
                                        Print Statement
                                    </button>
                                    <button id="iolta-delete-client-btn" onclick="deleteSelectedClient()" style="padding: 6px 10px; background: white; color: #ef4444; border: 1px solid #fecaca; border-radius: 5px; font-size: 11px; cursor: pointer; display: none;">
                                        Delete Client
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Transaction List -->
                        <div style="flex: 1; padding: 16px 20px; overflow-y: auto;">
                            <div style="background: white; border-radius: 10px; border: 1px solid #e2e8f0; overflow: hidden;">
                                <!-- Search Bar -->
                                <div id="iolta-search-bar" style="padding: 12px 16px; background: #f8fafc; border-bottom: 1px solid #e2e8f0; display: flex; gap: 12px; align-items: center;">
                                    <div style="flex: 1; position: relative;">
                                        <input type="text" id="iolta-tx-search" placeholder="Search by Check #, Amount, Date, Description..."
                                               oninput="filterIoltaTransactions(this.value)"
                                               style="width: 100%; padding: 8px 12px 8px 36px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 13px; box-sizing: border-box;">
                                        <span style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #94a3b8;">&#128269;</span>
                                    </div>
                                    <button id="iolta-clear-search-btn" onclick="clearIoltaTxSearch()" style="display: none; padding: 8px 12px; background: #f1f5f9; border: 1px solid #e2e8f0; border-radius: 6px; cursor: pointer; font-size: 12px; color: #64748b;">
                                        Clear
                                    </button>
                                    <button id="iolta-auto-match-btn" onclick="runAutoMatch()" style="display: none; padding: 8px 16px; background: #8b5cf6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 500;">
                                        Auto-Match
                                    </button>
                                    <span id="iolta-tx-count" style="font-size: 12px; color: #64748b;">0 of 0</span>
                                </div>

                                <!-- Table Header -->
                                <div style="padding: 10px 14px; border-bottom: 1px solid #e2e8f0; background: #f1f5f9;">
                                    <div id="iolta-table-header">
                                        <div><input type="checkbox" id="iolta-select-all" onchange="toggleSelectAllIoltaTx(this.checked)"></div>
                                        <div class="sortable-header" onclick="sortIoltaTable('date')" style="cursor: pointer; user-select: none;">DATE <span id="sort-icon-date">‚ñº</span></div>
                                        <div class="sortable-header" onclick="sortIoltaTable('check')" style="cursor: pointer; user-select: none;">CHECK # <span id="sort-icon-check"></span></div>
                                        <div class="sortable-header" onclick="sortIoltaTable('payee')" style="cursor: pointer; user-select: none;">PAYEE <span id="sort-icon-payee"></span></div>
                                        <div>TYPE</div>
                                        <div class="sortable-header" onclick="sortIoltaTable('description')" style="cursor: pointer; user-select: none;">DESCRIPTION <span id="sort-icon-description"></span></div>
                                        <div class="sortable-header" onclick="sortIoltaTable('amount')" style="cursor: pointer; user-select: none;">AMOUNT <span id="sort-icon-amount"></span></div>
                                        <div>BALANCE</div>
                                        <div class="sortable-header" onclick="sortIoltaTable('status')" style="cursor: pointer; user-select: none;">STATUS <span id="sort-icon-status"></span></div>
                                    </div>
                                </div>

                                <!-- Bulk Actions Bar (inside table card) -->
                                <div id="iolta-bulk-actions" style="display: none; padding: 10px 14px; background: #eff6ff; border-bottom: 1px solid #bfdbfe;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <span id="iolta-selected-count" style="font-size: 12px; font-weight: 600; color: #1d4ed8;">0 selected</span>
                                        </div>
                                        <div style="display: flex; gap: 8px;">
                                            <button onclick="markSelectedIoltaAsCleared()" id="iolta-clear-status-btn" style="padding: 6px 12px; background: white; color: #374151; border: 1px solid #e2e8f0; border-radius: 5px; font-size: 11px; font-weight: 500; cursor: pointer; display: none;">
                                                Clear
                                            </button>
                                            <button onclick="editSelectedIoltaTx()" id="iolta-edit-btn" style="padding: 6px 12px; background: white; color: #374151; border: 1px solid #e2e8f0; border-radius: 5px; font-size: 11px; font-weight: 500; cursor: pointer; display: none;">
                                                Edit
                                            </button>
                                            <button onclick="openIoltaMoveModal()" style="padding: 6px 12px; background: white; color: #374151; border: 1px solid #e2e8f0; border-radius: 5px; font-size: 11px; font-weight: 500; cursor: pointer;">
                                                Move to Client
                                            </button>
                                            <button onclick="deleteSelectedIoltaTx()" style="padding: 6px 12px; background: #fef2f2; color: #dc2626; border: 1px solid #fecaca; border-radius: 5px; font-size: 11px; font-weight: 500; cursor: pointer;">
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Table Body -->
                                <div id="iolta-transactions-list" style="max-height: calc(100vh - 320px); overflow-y: auto;">
                                    <div style="padding: 50px 20px; text-align: center; color: #94a3b8;">
                                        <div style="font-size: 40px; margin-bottom: 10px;">üìÑ</div>
                                        <div style="font-size: 15px; font-weight: 500;">Select a client</div>
                                        <div style="font-size: 12px; margin-top: 4px;">to view their transaction history</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Trust Operations Page -->
                <div class="page" id="page-trust-operations">
                    <div id="trust-operations-content">
                        <p style="color: #6b7280;">Loading operations...</p>
                    </div>
                </div>

                <!-- IOLTA Bank Reconciliation Page (QuickBooks Style) -->
                <div class="page" id="page-trust-reconcile">
                    <div id="trust-reconcile-page" style="height: 100%;">
                        <!-- Content dynamically rendered by JS -->
                        <div style="display: flex; justify-content: center; align-items: center; height: 100%; color: #94a3b8;">
                            <div style="text-align: center;">
                                <div style="font-size: 40px; margin-bottom: 12px;">üè¶</div>
                                <div>Loading reconciliation...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- IOLTA Audit Log Page -->
                <div class="page" id="page-trust-audit" style="padding: 24px; background: #f8fafc;">
                    <!-- Page Header Card -->
                    <div style="background: white; border-radius: 16px; padding: 24px; margin-bottom: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.08);">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
                            <div>
                                <h2 style="margin: 0; font-size: 28px; font-weight: 700; color: #1e293b;">Audit Trail</h2>
                                <p style="margin: 6px 0 0; color: #64748b; font-size: 14px;">Track all trust account activities</p>
                            </div>
                            <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <label style="font-size: 13px; color: #64748b; font-weight: 500;">From</label>
                                    <input type="date" id="audit-start-date"
                                           style="padding: 10px 14px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; color: #334155; background: white; cursor: pointer; min-width: 150px;"
                                           onchange="loadTrustAuditLog()">
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <label style="font-size: 13px; color: #64748b; font-weight: 500;">To</label>
                                    <input type="date" id="audit-end-date"
                                           style="padding: 10px 14px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; color: #334155; background: white; cursor: pointer; min-width: 150px;"
                                           onchange="loadTrustAuditLog()">
                                </div>
                                <button onclick="loadTrustAuditLog()"
                                        style="padding: 10px 20px; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; border: none; border-radius: 8px; font-size: 14px; cursor: pointer; font-weight: 600; transition: all 0.2s; box-shadow: 0 2px 4px rgba(59,130,246,0.3);"
                                        onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 8px rgba(59,130,246,0.4)'"
                                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(59,130,246,0.3)'">
                                    Refresh
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Summary Stats -->
                    <div id="audit-summary-stats" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 12px; margin-bottom: 24px;">
                        <!-- Populated by JS -->
                    </div>

                    <!-- Audit Log List -->
                    <div style="background: white; border-radius: 16px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0,0,0,0.08); overflow: hidden;">
                        <div id="audit-log-container">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                </div>

                <!-- IOLTA Reports Page -->
                <div class="page" id="page-trust-reports">
                    <div class="trust-reports-container">
                        <div class="trust-reports-header">
                            <h2>Trust Reports</h2>
                            <p>Generate comprehensive reports for your IOLTA accounts</p>
                        </div>

                        <!-- Report Cards Grid -->
                        <div class="trust-reports-grid">
                            <div class="trust-report-card" onclick="showTrustReport('balance_summary')">
                                <div class="trust-report-icon">
                                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M18 20V10"/>
                                        <path d="M12 20V4"/>
                                        <path d="M6 20v-6"/>
                                    </svg>
                                </div>
                                <div class="trust-report-content">
                                    <h3>Balance Summary</h3>
                                    <p>Overview of all trust accounts with client balances and reconciliation status</p>
                                </div>
                                <div class="trust-report-arrow">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M5 12h14M12 5l7 7-7 7"/>
                                    </svg>
                                </div>
                            </div>

                            <div class="trust-report-card" onclick="showTrustReport('account_summary')">
                                <div class="trust-report-icon">
                                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
                                        <line x1="1" y1="10" x2="23" y2="10"/>
                                    </svg>
                                </div>
                                <div class="trust-report-content">
                                    <h3>Account Summary</h3>
                                    <p>Detailed breakdown of client ledgers by trust account</p>
                                </div>
                                <div class="trust-report-arrow">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M5 12h14M12 5l7 7-7 7"/>
                                    </svg>
                                </div>
                            </div>

                            <div class="trust-report-card" onclick="showTrustReport('audit_trail')">
                                <div class="trust-report-icon">
                                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                        <polyline points="14 2 14 8 20 8"/>
                                        <line x1="16" y1="13" x2="8" y2="13"/>
                                        <line x1="16" y1="17" x2="8" y2="17"/>
                                        <polyline points="10 9 9 9 8 9"/>
                                    </svg>
                                </div>
                                <div class="trust-report-content">
                                    <h3>Audit Trail</h3>
                                    <p>Complete activity log for compliance and audit purposes</p>
                                </div>
                                <div class="trust-report-arrow">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M5 12h14M12 5l7 7-7 7"/>
                                    </svg>
                                </div>
                            </div>

                            <div class="trust-report-card" onclick="showTrustReport('client_breakdown')">
                                <div class="trust-report-icon" style="color: #8b5cf6;">
                                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"/>
                                        <path d="M12 2a10 10 0 0 1 10 10"/>
                                        <path d="M12 2a10 10 0 0 0-10 10"/>
                                        <path d="M12 12L12 2"/>
                                        <path d="M12 12L20 16"/>
                                    </svg>
                                </div>
                                <div class="trust-report-content">
                                    <h3>Client Breakdown</h3>
                                    <p>Analyze balances by Legal Fee, Cost, and Client Payout with filtering options</p>
                                </div>
                                <div class="trust-report-arrow">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M5 12h14M12 5l7 7-7 7"/>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <!-- Report Display Area -->
                        <div class="trust-report-display" id="trust-report-display" style="display: none;">
                            <div class="trust-report-toolbar">
                                <button class="btn btn-secondary" onclick="hideTrustReport()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                                    </svg>
                                    Back to Reports
                                </button>
                                <div class="trust-report-actions">
                                    <button class="btn btn-secondary" onclick="printTrustReport()">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="6 9 6 2 18 2 18 9"/>
                                            <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/>
                                            <rect x="6" y="14" width="12" height="8"/>
                                        </svg>
                                        Print
                                    </button>
                                    <button class="btn btn-primary" onclick="exportTrustReportPDF()">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                            <polyline points="7 10 12 15 17 10"/>
                                            <line x1="12" y1="15" x2="12" y2="3"/>
                                        </svg>
                                        Export PDF
                                    </button>
                                </div>
                            </div>
                            <div class="trust-report-content-area" id="trust-report-content">
                                <!-- Report content will be rendered here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- IOLTA Staging Page -->
                <div class="page" id="page-trust-staging">
                    <div id="staging-content" style="padding: 24px;">
                        <!-- Content loaded by iolta-staging.js -->
                    </div>
                </div>

                <!-- IOLTA Data Management Page -->
                <div class="page" id="page-trust-data-management">
                    <div class="dm-container">
                        <!-- Header -->
                        <div class="dm-header">
                            <div class="dm-header-content">
                                <h1>IOLTA Data Management</h1>
                                <p>Export, import, backup and restore your trust accounting data</p>
                            </div>
                        </div>

                        <!-- Navigation Tabs -->
                        <div class="dm-nav" id="trust-dm-tabs">
                            <button class="dm-nav-item active" data-tab="trust-export">
                                <svg class="dm-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="17 8 12 3 7 8"/>
                                    <line x1="12" y1="3" x2="12" y2="15"/>
                                </svg>
                                <span>Export</span>
                            </button>
                            <button class="dm-nav-item" data-tab="trust-import">
                                <svg class="dm-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                <span>Import</span>
                            </button>
                            <button class="dm-nav-item" data-tab="trust-backup">
                                <svg class="dm-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                    <polyline points="17 21 17 13 7 13 7 21"/>
                                    <polyline points="7 3 7 8 15 8"/>
                                </svg>
                                <span>Backup</span>
                            </button>
                            <button class="dm-nav-item" data-tab="trust-restore">
                                <svg class="dm-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="1 4 1 10 7 10"/>
                                    <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
                                </svg>
                                <span>Restore</span>
                            </button>
                        </div>

                        <!-- Export Tab -->
                        <div id="trust-export-content" class="dm-tab-content active">
                            <div class="dm-card">
                                <div class="dm-card-header">
                                    <div class="dm-card-icon dm-icon-blue">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                            <polyline points="17 8 12 3 7 8"/>
                                            <line x1="12" y1="3" x2="12" y2="15"/>
                                        </svg>
                                    </div>
                                    <div class="dm-card-title">
                                        <h2>Export Trust Data</h2>
                                        <p>Download your data as CSV files</p>
                                    </div>
                                </div>

                                <div class="dm-card-body">
                                    <p class="dm-section-label">Select data to export</p>
                                    <div class="dm-export-grid">
                                        <label class="dm-checkbox-card">
                                            <input type="checkbox" name="trust-export" value="clients" checked>
                                            <div class="dm-checkbox-content">
                                                <div class="dm-checkbox-icon">
                                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                                                    </svg>
                                                </div>
                                                <span class="dm-checkbox-label">Trust Clients</span>
                                                <span class="dm-checkbox-desc">Client records</span>
                                            </div>
                                            <div class="dm-checkbox-check">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                                    <polyline points="20 6 9 17 4 12"/>
                                                </svg>
                                            </div>
                                        </label>
                                        <label class="dm-checkbox-card">
                                            <input type="checkbox" name="trust-export" value="ledger" checked>
                                            <div class="dm-checkbox-content">
                                                <div class="dm-checkbox-icon">
                                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                                                    </svg>
                                                </div>
                                                <span class="dm-checkbox-label">Client Ledgers</span>
                                                <span class="dm-checkbox-desc">Account balances</span>
                                            </div>
                                            <div class="dm-checkbox-check">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                                    <polyline points="20 6 9 17 4 12"/>
                                                </svg>
                                            </div>
                                        </label>
                                        <label class="dm-checkbox-card">
                                            <input type="checkbox" name="trust-export" value="transactions" checked>
                                            <div class="dm-checkbox-content">
                                                <div class="dm-checkbox-icon">
                                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                                                    </svg>
                                                </div>
                                                <span class="dm-checkbox-label">Transactions</span>
                                                <span class="dm-checkbox-desc">All trust activity</span>
                                            </div>
                                            <div class="dm-checkbox-check">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                                    <polyline points="20 6 9 17 4 12"/>
                                                </svg>
                                            </div>
                                        </label>
                                        <label class="dm-checkbox-card">
                                            <input type="checkbox" name="trust-export" value="checks">
                                            <div class="dm-checkbox-content">
                                                <div class="dm-checkbox-icon">
                                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/>
                                                    </svg>
                                                </div>
                                                <span class="dm-checkbox-label">Trust Checks</span>
                                                <span class="dm-checkbox-desc">Written checks</span>
                                            </div>
                                            <div class="dm-checkbox-check">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                                    <polyline points="20 6 9 17 4 12"/>
                                                </svg>
                                            </div>
                                        </label>
                                        <label class="dm-checkbox-card">
                                            <input type="checkbox" name="trust-export" value="reconciliations">
                                            <div class="dm-checkbox-content">
                                                <div class="dm-checkbox-icon">
                                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>
                                                    </svg>
                                                </div>
                                                <span class="dm-checkbox-label">Reconciliations</span>
                                                <span class="dm-checkbox-desc">3-way recon history</span>
                                            </div>
                                            <div class="dm-checkbox-check">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                                    <polyline points="20 6 9 17 4 12"/>
                                                </svg>
                                            </div>
                                        </label>
                                        <label class="dm-checkbox-card">
                                            <input type="checkbox" name="trust-export" value="audit">
                                            <div class="dm-checkbox-content">
                                                <div class="dm-checkbox-icon">
                                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/>
                                                    </svg>
                                                </div>
                                                <span class="dm-checkbox-label">Audit Log</span>
                                                <span class="dm-checkbox-desc">Compliance trail</span>
                                            </div>
                                            <div class="dm-checkbox-check">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                                    <polyline points="20 6 9 17 4 12"/>
                                                </svg>
                                            </div>
                                        </label>
                                    </div>
                                </div>

                                <div class="dm-card-footer">
                                    <div class="dm-loading" id="trust-export-loading">
                                        <div class="dm-spinner"></div>
                                        <span>Preparing download...</span>
                                    </div>
                                    <button class="dm-btn dm-btn-primary" onclick="exportTrustData()">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                            <polyline points="7 10 12 15 17 10"/>
                                            <line x1="12" y1="15" x2="12" y2="3"/>
                                        </svg>
                                        Download CSV Files
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Import Tab -->
                        <div id="trust-import-content" class="dm-tab-content">
                            <div class="dm-grid-2">
                                <div class="dm-card">
                                    <div class="dm-card-header">
                                        <div class="dm-card-icon dm-icon-green">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                                <polyline points="7 10 12 15 17 10"/>
                                                <line x1="12" y1="15" x2="12" y2="3"/>
                                            </svg>
                                        </div>
                                        <div class="dm-card-title">
                                            <h2>Import Data</h2>
                                            <p>Upload CSV files to import</p>
                                        </div>
                                    </div>

                                    <div class="dm-card-body">
                                        <div class="dm-form-group">
                                            <label class="dm-label">Import Format</label>
                                            <div class="dm-select" style="background: #f8fafc; color: #475569; cursor: default;">
                                                Bank Statement (Chase CSV)
                                            </div>
                                            <input type="hidden" id="trust-import-type" value="bank-statement">
                                        </div>

                                        <div class="dm-form-group">
                                            <label class="dm-label">Import to Account</label>
                                            <div class="dm-select" style="background: #f8fafc; color: #475569; cursor: default;">
                                                IOLTA Trust Account
                                            </div>
                                            <input type="hidden" id="trust-import-account">
                                        </div>

                                        <div class="dm-form-group">
                                            <label class="dm-label">CSV or ZIP File</label>
                                            <div class="dm-dropzone" id="trust-import-dropzone">
                                                <input type="file" id="trust-import-file" accept=".csv,.zip" onchange="updateTrustFileName(this)">
                                                <div class="dm-dropzone-content">
                                                    <svg class="dm-dropzone-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                                        <polyline points="14 2 14 8 20 8"/>
                                                        <line x1="12" y1="18" x2="12" y2="12"/>
                                                        <line x1="9" y1="15" x2="15" y2="15"/>
                                                    </svg>
                                                    <p class="dm-dropzone-text">Drop CSV or ZIP file here or <span>browse</span></p>
                                                    <p class="dm-dropzone-hint" id="trust-import-file-name">No file selected</p>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Import Result Box -->
                                        <div id="trust-import-result" style="display: none; padding: 12px; border-radius: 8px; margin-top: 12px; font-size: 13px;"></div>
                                    </div>

                                    <div class="dm-card-footer">
                                        <div class="dm-loading" id="trust-import-loading">
                                            <div class="dm-spinner"></div>
                                            <span>Importing...</span>
                                        </div>
                                        <button class="dm-btn dm-btn-success" onclick="importTrustData()">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                                <polyline points="17 8 12 3 7 8"/>
                                                <line x1="12" y1="3" x2="12" y2="15"/>
                                            </svg>
                                            Import Data
                                        </button>
                                    </div>
                                </div>

                                <div class="dm-card dm-card-log">
                                    <div class="dm-card-header">
                                        <div class="dm-card-icon dm-icon-gray">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="10"/>
                                                <polyline points="12 6 12 12 16 14"/>
                                            </svg>
                                        </div>
                                        <div class="dm-card-title">
                                            <h2>Activity Log</h2>
                                            <p>Recent import/export history</p>
                                        </div>
                                    </div>
                                    <div class="dm-card-body" id="trust-activity-log-preview">
                                        <div class="activity-empty-state">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="32" height="32">
                                                <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                                            </svg>
                                            <span>No recent activity</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Backup Tab -->
                        <div id="trust-backup-content" class="dm-tab-content">
                            <div class="dm-card">
                                <div class="dm-card-header">
                                    <div class="dm-card-icon dm-icon-purple">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                            <polyline points="17 21 17 13 7 13 7 21"/>
                                            <polyline points="7 3 7 8 15 8"/>
                                        </svg>
                                    </div>
                                    <div class="dm-card-title">
                                        <h2>Full IOLTA Backup</h2>
                                        <p>Download complete data archive</p>
                                    </div>
                                </div>

                                <div class="dm-card-body">
                                    <div class="dm-backup-preview">
                                        <div class="dm-backup-icon">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                                                <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                                                <line x1="12" y1="22.08" x2="12" y2="12"/>
                                            </svg>
                                        </div>
                                        <div class="dm-backup-info">
                                            <h3>IOLTA_Trust_Backup.zip</h3>
                                            <p>Complete backup including all your trust data</p>
                                        </div>
                                    </div>

                                    <div class="dm-included-list">
                                        <p class="dm-section-label">Backup includes</p>
                                        <div class="dm-included-grid">
                                            <div class="dm-included-item">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                                                <span>Trust Clients</span>
                                            </div>
                                            <div class="dm-included-item">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                                                <span>Client Ledgers</span>
                                            </div>
                                            <div class="dm-included-item">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                                                <span>Transactions</span>
                                            </div>
                                            <div class="dm-included-item">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                                                <span>Trust Checks</span>
                                            </div>
                                            <div class="dm-included-item">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                                                <span>Reconciliations</span>
                                            </div>
                                            <div class="dm-included-item">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                                                <span>Audit Log</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="dm-card-footer">
                                    <div class="dm-loading" id="trust-backup-loading">
                                        <div class="dm-spinner"></div>
                                        <span>Creating backup...</span>
                                    </div>
                                    <button class="dm-btn dm-btn-purple" onclick="createTrustBackup()">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                            <polyline points="7 10 12 15 17 10"/>
                                            <line x1="12" y1="15" x2="12" y2="3"/>
                                        </svg>
                                        Download Backup
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Restore Tab -->
                        <div id="trust-restore-content" class="dm-tab-content">
                            <div class="dm-card">
                                <div class="dm-card-header">
                                    <div class="dm-card-icon dm-icon-orange">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="1 4 1 10 7 10"/>
                                            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
                                        </svg>
                                    </div>
                                    <div class="dm-card-title">
                                        <h2>Restore Backup</h2>
                                        <p>Restore from a backup file</p>
                                    </div>
                                </div>

                                <div class="dm-card-body">
                                    <div class="dm-alert dm-alert-warning">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                                            <line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>
                                        </svg>
                                        <div>
                                            <strong>Caution</strong>
                                            <p>Replace mode will permanently delete existing data before restoring.</p>
                                        </div>
                                    </div>

                                    <div class="dm-form-group">
                                        <label class="dm-label">Restore Mode</label>
                                        <div class="dm-radio-cards">
                                            <label class="dm-radio-card">
                                                <input type="radio" name="trust-restore-mode" value="merge" checked>
                                                <div class="dm-radio-content">
                                                    <div class="dm-radio-indicator"></div>
                                                    <div class="dm-radio-text">
                                                        <span class="dm-radio-title">Merge</span>
                                                        <span class="dm-radio-desc">Keep existing data, add new records</span>
                                                    </div>
                                                </div>
                                            </label>
                                            <label class="dm-radio-card">
                                                <input type="radio" name="trust-restore-mode" value="replace">
                                                <div class="dm-radio-content">
                                                    <div class="dm-radio-indicator"></div>
                                                    <div class="dm-radio-text">
                                                        <span class="dm-radio-title">Replace</span>
                                                        <span class="dm-radio-desc">Delete all existing data first</span>
                                                    </div>
                                                </div>
                                            </label>
                                        </div>
                                    </div>

                                    <div class="dm-form-group">
                                        <label class="dm-label">Backup File</label>
                                        <div class="dm-dropzone" id="trust-restore-dropzone">
                                            <input type="file" id="trust-restore-file" accept=".zip" onchange="updateTrustRestoreFileName(this)">
                                            <div class="dm-dropzone-content">
                                                <svg class="dm-dropzone-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                                                    <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                                                    <line x1="12" y1="22.08" x2="12" y2="12"/>
                                                </svg>
                                                <p class="dm-dropzone-text">Drop ZIP file here or <span>browse</span></p>
                                                <p class="dm-dropzone-hint" id="trust-restore-file-name">No file selected</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="dm-card-footer">
                                    <div class="dm-loading" id="trust-restore-loading">
                                        <div class="dm-spinner"></div>
                                        <span>Restoring data...</span>
                                    </div>
                                    <button class="dm-btn dm-btn-warning" onclick="restoreTrustBackup()">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="1 4 1 10 7 10"/>
                                            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
                                        </svg>
                                        Restore Backup
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="modal-overlay">
        <div class="modal" id="modal">
            <div class="modal-header">
                <h3 id="modal-title">Modal Title</h3>
                <button class="close-btn" id="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Modal content -->
            </div>
        </div>
    </div>

    <!-- Category Detail Modal -->
    <div class="modal-overlay" id="category-detail-overlay">
        <div class="modal category-detail-modal" id="category-detail-modal">
            <div class="modal-header">
                <div class="category-detail-header">
                    <span class="category-detail-icon" id="cd-icon"></span>
                    <h3 id="cd-name">Category Name</h3>
                    <span class="category-detail-type" id="cd-type">expense</span>
                </div>
                <button class="close-btn" onclick="closeCategoryDetailModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Stats Row -->
                <div class="cd-stats-row">
                    <div class="cd-stat">
                        <div class="cd-stat-label">This Month</div>
                        <div class="cd-stat-value" id="cd-this-month">$0.00</div>
                    </div>
                    <div class="cd-stat">
                        <div class="cd-stat-label">Last Month</div>
                        <div class="cd-stat-value" id="cd-last-month">$0.00</div>
                    </div>
                    <div class="cd-stat">
                        <div class="cd-stat-label">All Time</div>
                        <div class="cd-stat-value" id="cd-all-time">$0.00</div>
                    </div>
                    <div class="cd-stat">
                        <div class="cd-stat-label">Transactions</div>
                        <div class="cd-stat-value" id="cd-txn-count">0</div>
                    </div>
                </div>

                <!-- Info Section -->
                <div class="cd-info-section">
                    <div class="cd-info-row">
                        <span class="cd-info-label">Parent Category</span>
                        <span class="cd-info-value" id="cd-parent">None</span>
                    </div>
                    <div class="cd-info-row">
                        <span class="cd-info-label">System Category</span>
                        <span class="cd-info-value" id="cd-system">No</span>
                    </div>
                    <div class="cd-info-row">
                        <span class="cd-info-label">Color</span>
                        <span class="cd-info-value">
                            <span class="cd-color-preview" id="cd-color"></span>
                            <span id="cd-color-text">#000000</span>
                        </span>
                    </div>
                </div>

                <!-- Recent Transactions -->
                <div class="cd-transactions-section">
                    <h4>Recent Transactions</h4>
                    <div class="cd-transactions-list" id="cd-transactions">
                        <!-- Populated by JS -->
                    </div>
                    <button class="cd-view-all-btn" id="cd-view-all-btn" onclick="viewAllCategoryTransactions()">
                        View All Transactions
                    </button>
                </div>
            </div>
            <div class="modal-footer cd-modal-footer">
                <button class="btn btn-outline" id="cd-edit-btn" onclick="editCategoryFromDetail()">Edit</button>
                <button class="btn btn-danger" id="cd-delete-btn" onclick="deleteCategoryFromDetail()">Delete</button>
            </div>
        </div>
    </div>

    <!-- Bulk Categorize Modal -->
    <div class="modal-overlay" id="bulk-categorize-overlay">
        <div class="modal bulk-categorize-modal-v2" id="bulk-categorize-modal">
            <div class="modal-header">
                <h3>Move Transactions to Category</h3>
                <button class="close-btn" onclick="closeBulkCategorizeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Selected Transactions Preview -->
                <div class="bulk-cat-preview">
                    <div class="bulk-cat-preview-header">
                        <span class="bulk-cat-label">Selected:</span>
                        <span class="bulk-cat-count-badge" id="bulk-cat-count-badge">0</span>
                    </div>
                    <div class="bulk-cat-items" id="bulk-cat-items">
                        <!-- Transaction items populated by JS -->
                    </div>
                </div>

                <!-- Category Selection -->
                <div class="form-group">
                    <label for="bulk-cat-select">Move to Category</label>
                    <select id="bulk-cat-select" class="form-select">
                        <!-- Categories populated by JS -->
                    </select>
                </div>

                <!-- Rule Settings Section -->
                <div class="bulk-cat-rule-section">
                    <label class="checkbox-label bulk-cat-rule-toggle">
                        <input type="checkbox" id="bulk-cat-create-rule" checked onchange="toggleRuleSettings()">
                        <span>Create Rule for Future Imports</span>
                    </label>

                    <div class="bulk-cat-rule-settings" id="bulk-cat-rule-settings">
                        <div class="rule-settings-grid">
                            <div class="form-group">
                                <label for="bulk-rule-name">Rule Name</label>
                                <input type="text" id="bulk-rule-name" class="form-input" placeholder="e.g., INTEREST CHARGED">
                            </div>
                            <div class="form-group">
                                <label for="bulk-rule-priority">Priority</label>
                                <input type="number" id="bulk-rule-priority" class="form-input" value="50" min="1" max="1000">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="bulk-rule-field">Match Field</label>
                            <select id="bulk-rule-field" class="form-select">
                                <option value="description" selected>Description</option>
                                <option value="vendor_name">Vendor Name</option>
                                <option value="amount">Amount</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Match Type</label>
                            <div class="match-type-options">
                                <label class="radio-label">
                                    <input type="radio" name="bulk-match-type" value="contains" checked>
                                    <span>Contains</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="bulk-match-type" value="exact">
                                    <span>Exact</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="bulk-match-type" value="starts_with">
                                    <span>Starts with</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="bulk-match-type" value="regex">
                                    <span>Regex</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="bulk-rule-value">Match Value</label>
                            <input type="text" id="bulk-rule-value" class="form-input" placeholder="Enter pattern to match">
                            <small class="form-hint">This pattern will be used to auto-categorize future imports</small>
                        </div>

                        <!-- Existing Rule Warning -->
                        <div class="existing-rule-warning" id="existing-rule-warning" style="display:none;">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                                <line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>
                            </svg>
                            <span id="existing-rule-text">Similar rule already exists</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeBulkCategorizeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="executeBulkCategorize()">Move Transactions</button>
            </div>
        </div>
    </div>

    <!-- Import Preview Modal - For selecting duplicates before import -->
    <div class="modal-overlay" id="import-preview-overlay">
        <div class="modal import-preview-modal" style="max-width:700px;max-height:85vh;">
            <div class="modal-header" style="background:linear-gradient(135deg,#3b82f6,#1d4ed8);color:white;padding:20px;">
                <div class="modal-header-content" style="display:flex;align-items:center;gap:12px;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="28" height="28">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/><line x1="12" y1="18" x2="12" y2="12"/><line x1="9" y1="15" x2="15" y2="15"/>
                    </svg>
                    <div>
                        <h3 style="margin:0;font-size:18px;">Import Preview</h3>
                        <p style="margin:4px 0 0;opacity:0.9;font-size:13px;">Review and select transactions to import</p>
                    </div>
                </div>
                <button class="close-btn" onclick="closeImportPreview()" style="color:white;font-size:28px;">&times;</button>
            </div>
            <div class="modal-body" style="padding:0;overflow-y:auto;max-height:calc(85vh - 180px);">
                <!-- Summary -->
                <div id="import-preview-summary" style="padding:16px 20px;background:#f8fafc;border-bottom:1px solid #e2e8f0;display:flex;gap:16px;flex-wrap:wrap;">
                    <!-- Populated by JS -->
                </div>

                <!-- Duplicate Groups Section -->
                <div id="import-preview-duplicates" style="padding:16px 20px;">
                    <!-- Populated by JS -->
                </div>

                <!-- Unique Transactions (auto-import) -->
                <div id="import-preview-unique" style="padding:0 20px 16px;display:none;">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                        <h4 style="margin:0;color:#059669;font-size:14px;">
                            <span style="margin-right:6px;">‚úì</span>Unique Transactions (will import)
                        </h4>
                        <button class="btn btn-sm" onclick="togglePreviewSection('unique')" style="font-size:12px;padding:4px 8px;">Show/Hide</button>
                    </div>
                    <div id="import-preview-unique-list" style="display:none;max-height:200px;overflow-y:auto;"></div>
                </div>

                <!-- Already in DB (will skip) -->
                <div id="import-preview-existing" style="padding:0 20px 16px;display:none;">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                        <h4 style="margin:0;color:#6b7280;font-size:14px;">
                            <span style="margin-right:6px;">‚äò</span>Already Imported (will skip)
                        </h4>
                        <button class="btn btn-sm" onclick="togglePreviewSection('existing')" style="font-size:12px;padding:4px 8px;">Show/Hide</button>
                    </div>
                    <div id="import-preview-existing-list" style="display:none;max-height:200px;overflow-y:auto;"></div>
                </div>

                <!-- Payments (will skip) -->
                <div id="import-preview-payments" style="padding:0 20px 16px;display:none;">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                        <h4 style="margin:0;color:#f59e0b;font-size:14px;">
                            <span style="margin-right:6px;">‚ö†</span>Payments (will skip)
                        </h4>
                        <button class="btn btn-sm" onclick="togglePreviewSection('payments')" style="font-size:12px;padding:4px 8px;">Show/Hide</button>
                    </div>
                    <div id="import-preview-payments-list" style="display:none;max-height:200px;overflow-y:auto;"></div>
                </div>
            </div>
            <div class="modal-footer" style="padding:16px 20px;background:#f8fafc;border-top:1px solid #e2e8f0;display:flex;justify-content:space-between;align-items:center;">
                <div id="import-preview-count" style="font-size:14px;color:#64748b;">
                    <!-- Selected count -->
                </div>
                <div style="display:flex;gap:12px;">
                    <button class="btn btn-outline" onclick="closeImportPreview()">Cancel</button>
                    <button class="btn btn-primary" onclick="confirmImportPreview()" id="confirm-import-btn">
                        Import Selected
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- P&L Export Options Modal -->
    <div class="modal-overlay" id="pnl-export-modal">
        <div class="modal pnl-export-modal">
            <div class="modal-header">
                <h3>Export P&L Report</h3>
                <button class="close-btn" onclick="closePnlExportModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Report Type Selection -->
                <div class="export-option-section">
                    <label class="export-option-label">Report Type</label>
                    <div class="export-radio-group">
                        <label class="export-radio-item">
                            <input type="radio" name="pnl-export-type" value="summary" checked>
                            <span class="export-radio-custom"></span>
                            <div class="export-radio-content">
                                <span class="export-radio-title">Summary Only</span>
                                <span class="export-radio-desc">Category totals only</span>
                            </div>
                        </label>
                        <label class="export-radio-item">
                            <input type="radio" name="pnl-export-type" value="detailed">
                            <span class="export-radio-custom"></span>
                            <div class="export-radio-content">
                                <span class="export-radio-title">Detailed (QuickBooks Style)</span>
                                <span class="export-radio-desc">All transactions with running balances</span>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Category Selection (shows when Detailed is selected) -->
                <div class="export-option-section" id="pnl-category-selection" style="display:none;">
                    <div class="export-category-header">
                        <label class="export-option-label">Include Categories</label>
                        <div class="export-select-all">
                            <label class="checkbox-label">
                                <input type="checkbox" id="pnl-select-all" checked onchange="toggleAllPnlCategories(this.checked)">
                                <span>Select All</span>
                            </label>
                        </div>
                    </div>
                    <div class="export-category-list" id="pnl-category-list">
                        <!-- Categories populated by JS -->
                        <div class="export-loading">Loading categories...</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closePnlExportModal()">Cancel</button>
                <div class="export-format-buttons">
                    <button class="btn btn-primary" onclick="executePnlExport('pdf')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                        Export PDF
                    </button>
                    <button class="btn btn-success" onclick="executePnlExport('excel')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="8" y1="13" x2="16" y2="13"></line>
                            <line x1="8" y1="17" x2="16" y2="17"></line>
                            <line x1="8" y1="9" x2="16" y2="9"></line>
                        </svg>
                        Export Excel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="spinner"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/exceljs@4.4.0/dist/exceljs.min.js"></script>
    <!-- Scripts -->
    <script type="module" src="js/utils.js"></script>
    <script type="module" src="js/state.js"></script>
    <script type="module" src="js/api.js"></script>
    <script type="module" src="js/auth.js"></script>
    <!-- Account Type System -->
    <script src="js/menu-config.js?v=20241220" defer></script>
    <script src="js/account-switcher.js?v=20241220" defer></script>
    <!-- Main App -->
    <script src="app.js" defer></script>
    <!-- Feature Modules -->
    <script src="js/modules/categories.js?v=20251225a" defer></script>
    <script src="js/modules/reports.js" defer></script>
    <script src="js/modules/receipts.js" defer></script>
    <script src="js/modules/budgets.js" defer></script>
    <script src="js/modules/recurring.js" defer></script>
    <script src="js/modules/checks.js?v=20251225d" defer></script>
    <script src="js/modules/reconcile.js?v=20251225b" defer></script>
    <script src="js/modules/cpa.js" defer></script>
    <script src="js/modules/admin.js" defer></script>
    <script src="js/modules/dashboard.js" defer></script>
    <script src="js/modules/import.js" defer></script>
    <script src="js/modules/rules.js" defer></script>
    <script src="js/modules/custom-reports.js" defer></script>
    <script src="js/modules/transactions.js" defer></script>
    <script src="js/modules/accounts.js" defer></script>
    <script src="js/modules/data-management.js" defer></script>
    <script src="js/modules/entities.js?v=20251226" defer></script>
    <!-- IOLTA Modules -->
    <script src="js/modules/iolta-common.js?v=20251226h" defer></script>
    <script src="js/modules/iolta-ledger.js?v=20251226a" defer></script>
    <script src="js/modules/iolta-staging.js?v=20251226" defer></script>
    <script src="js/modules/iolta-reconcile.js?v=20251226" defer></script>
    <script src="js/modules/iolta-reports.js?v=20251226" defer></script>
    <script src="js/modules/iolta-checks.js?v=20251226" defer></script>
    <script src="js/check-status-search.js?v=20251224" defer></script>
    <script src="js/new-transaction-modal.js?v=20251226k" defer></script>
    <script src="js/custom-dropdown.js?v=20251229" defer></script>
    <script src="js/split-transaction-modal.js?v=20251228" defer></script>
    <script src="js/split-general-modal.js?v=20251228" defer></script>
    <script src="js/split-cost-modal.js?v=20251228" defer></script>
    <!-- Cost Account Module (split for maintainability) -->
    <script src="js/modules/cost-core.js?v=20251229" defer></script>
    <script src="js/modules/cost-dashboard.js?v=20251229" defer></script>
    <script src="js/modules/cost-reconcile.js?v=20251226" defer></script>
    <script src="js/modules/cost-clients.js?v=20251226" defer></script>
    <script src="js/modules/cost-accounts.js?v=20251226" defer></script>

    <!-- Trust Deposit Modals (must be at body level for proper z-index) -->
    <div id="deposit-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 99999; justify-content: center; align-items: center;">
        <div style="width: 560px; max-width: 95%; border-radius: 16px; overflow: hidden; background: white; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);">
            <div style="padding: 20px 24px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 24px;">üì•</span>
                        <div>
                            <h3 style="margin: 0; font-size: 18px; font-weight: 600;" id="deposit-modal-title">New Deposit</h3>
                            <p style="margin: 2px 0 0; font-size: 13px; opacity: 0.9;">Record a check deposit</p>
                        </div>
                    </div>
                    <button onclick="closeDepositModal()" style="width: 32px; height: 32px; border-radius: 8px; background: rgba(255,255,255,0.2); color: white; border: none; cursor: pointer; font-size: 18px;">&times;</button>
                </div>
            </div>
            <form id="trust-deposit-form" onsubmit="saveTrustDeposit(event)" style="padding: 24px;">
                <input type="hidden" id="trust-deposit-id">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">Client Account <span style="color: #ef4444;">*</span></label>
                    <input type="hidden" id="trust-deposit-ledger" required>
                    <div style="position: relative;">
                        <input type="text" id="trust-deposit-client-search"
                               placeholder="Search clients..."
                               autocomplete="off"
                               oninput="searchTrustDepositClients(this.value)"
                               onfocus="showTrustDepositClientDropdown()"
                               style="width: 100%; padding: 12px 16px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; box-sizing: border-box;">
                        <div id="trust-deposit-client-dropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #e2e8f0; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 250px; overflow-y: auto; z-index: 1000; margin-top: 4px;"></div>
                    </div>
                    <div id="trust-deposit-balance-info" style="display: none; margin-top: 8px; padding: 8px 12px; background: #ecfdf5; border-radius: 6px; font-size: 13px; color: #059669;">
                        Current Balance: <span id="trust-deposit-current-balance" style="font-weight: 600;">$0.00</span>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">Check Number</label>
                        <input type="text" id="trust-deposit-check-number" placeholder="e.g., 1234" style="width: 100%; padding: 12px 16px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; box-sizing: border-box;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">Date <span style="color: #ef4444;">*</span></label>
                        <input type="date" id="trust-deposit-date" required style="width: 100%; padding: 12px 16px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; box-sizing: border-box;">
                    </div>
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">Amount <span style="color: #ef4444;">*</span></label>
                    <div style="position: relative;">
                        <span style="position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: #64748b; font-size: 16px;">$</span>
                        <input type="number" id="trust-deposit-amount" step="0.01" min="0.01" placeholder="0.00" required style="width: 100%; padding: 12px 16px 12px 32px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 18px; font-weight: 600; box-sizing: border-box;">
                    </div>
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">Received From <span style="color: #ef4444;">*</span></label>
                    <input type="text" id="trust-deposit-from" placeholder="Name on check" required style="width: 100%; padding: 12px 16px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; box-sizing: border-box;">
                </div>
                <div style="margin-bottom: 24px;">
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">Memo / Description <span style="color: #ef4444;">*</span></label>
                    <input type="text" id="trust-deposit-memo" placeholder="e.g., Retainer deposit, Settlement funds" required style="width: 100%; padding: 12px 16px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; box-sizing: border-box;">
                </div>
                <div style="display: flex; gap: 12px; padding-top: 16px; border-top: 1px solid #e2e8f0;">
                    <button type="button" id="trust-deposit-delete-btn" onclick="deleteTrustDeposit()" style="display: none; padding: 12px 20px; background: #fef2f2; color: #dc2626; border: 1px solid #fecaca; border-radius: 8px; font-size: 14px; cursor: pointer;">Delete</button>
                    <div style="flex: 1;"></div>
                    <button type="button" onclick="closeDepositModal()" style="padding: 12px 24px; background: white; color: #64748b; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; cursor: pointer;">Cancel</button>
                    <button type="submit" style="padding: 12px 28px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;">Save Deposit</button>
                </div>
            </form>
        </div>
    </div>

    <div id="deposit-register-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 99999; justify-content: center; align-items: center;">
        <div style="width: 700px; max-width: 95%; border-radius: 16px; overflow: hidden; max-height: 80vh; display: flex; flex-direction: column; background: white; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);">
            <div style="padding: 20px 24px; background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; flex-shrink: 0;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 24px;">üìã</span>
                        <div>
                            <h3 style="margin: 0; font-size: 18px; font-weight: 600;">Deposit Register</h3>
                            <p style="margin: 2px 0 0; font-size: 13px; opacity: 0.9;">All recorded deposits</p>
                        </div>
                    </div>
                    <button onclick="closeDepositRegisterModal()" style="width: 32px; height: 32px; border-radius: 8px; background: rgba(255,255,255,0.2); color: white; border: none; cursor: pointer; font-size: 18px;">&times;</button>
                </div>
            </div>
            <div style="padding: 12px 24px; background: #f8fafc; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;">
                <div style="display: flex; gap: 20px; font-size: 13px; color: #64748b;">
                    <span><strong id="register-deposit-count">0</strong> deposits</span>
                    <span>Total: <strong id="register-deposit-total" style="color: #10b981;">$0.00</strong></span>
                </div>
                <button onclick="closeDepositRegisterModal(); openDepositModal();" style="padding: 6px 12px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer;">+ New</button>
            </div>
            <div id="deposit-register-list" style="flex: 1; overflow-y: auto; padding: 0;">
                <div style="padding: 60px 20px; text-align: center; color: #94a3b8;">
                    <div style="font-size: 40px; margin-bottom: 12px;">üì•</div>
                    <div style="font-size: 14px; font-weight: 500; margin-bottom: 4px;">No deposits yet</div>
                    <div style="font-size: 12px;">Click "+ New" to record a deposit</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Trust Check Modals (must be at body level for proper z-index) -->
    <div id="check-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 99999; justify-content: center; align-items: center;">
        <div style="width: 560px; max-width: 95%; border-radius: 16px; overflow: hidden; background: white; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);">
            <div style="padding: 20px 24px; background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 24px;">‚úèÔ∏è</span>
                        <div>
                            <h3 style="margin: 0; font-size: 18px; font-weight: 600;" id="check-modal-title">New Check</h3>
                            <p style="margin: 2px 0 0; font-size: 13px; opacity: 0.9;">Issue a check from trust account</p>
                        </div>
                    </div>
                    <button onclick="closeCheckModal()" style="width: 32px; height: 32px; border-radius: 8px; background: rgba(255,255,255,0.2); color: white; border: none; cursor: pointer; font-size: 18px;">&times;</button>
                </div>
            </div>
            <form id="trust-check-form-modal" onsubmit="saveTrustCheckModal(event)" style="padding: 24px; max-height: 70vh; overflow-y: auto;">
                <input type="hidden" id="trust-check-id">
                <input type="hidden" id="trust-check-entity-id">
                <input type="hidden" id="trust-check-status" value="pending">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">Client Account <span style="color: #ef4444;">*</span></label>
                    <input type="hidden" id="trust-check-ledger" required>
                    <div style="position: relative;">
                        <input type="text" id="trust-check-client-search"
                               placeholder="Search clients..."
                               autocomplete="off"
                               oninput="searchTrustCheckClients(this.value)"
                               onfocus="showTrustCheckClientDropdown()"
                               style="width: 100%; padding: 12px 16px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; box-sizing: border-box;">
                        <div id="trust-check-client-dropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #e2e8f0; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 250px; overflow-y: auto; z-index: 1000; margin-top: 4px;"></div>
                    </div>
                    <div id="trust-check-balance-info" style="display: none; margin-top: 8px; padding: 8px 12px; background: #ecfdf5; border-radius: 6px; font-size: 13px; color: #059669;">
                        Available Balance: <span id="trust-check-available" style="font-weight: 600;">$0.00</span>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">Check Number <span style="color: #ef4444;">*</span></label>
                        <input type="text" id="trust-check-number" placeholder="e.g., 1001" required style="width: 100%; padding: 12px 16px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; box-sizing: border-box;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">Date <span style="color: #ef4444;">*</span></label>
                        <input type="date" id="trust-check-date" required style="width: 100%; padding: 12px 16px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; box-sizing: border-box;">
                    </div>
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">Pay To (Payee) <span style="color: #ef4444;">*</span></label>
                    <div style="position: relative;">
                        <input type="text" id="trust-check-payee" placeholder="Search vendors, employees..." required oninput="searchCheckPayeeEntity(this.value)" onfocus="showCheckPayeeDropdown()" autocomplete="off" style="width: 100%; padding: 12px 16px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; box-sizing: border-box;">
                        <div id="trust-check-entity-dropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #e2e8f0; border-radius: 8px; box-shadow: 0 8px 24px rgba(0,0,0,0.12); max-height: 200px; overflow-y: auto; z-index: 100; margin-top: 4px;"></div>
                    </div>
                    <div id="trust-check-entity-selected" style="display: none; margin-top: 8px; padding: 10px 12px; background: #f0fdf4; border-radius: 6px; border: 1px solid #bbf7d0;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <div id="trust-check-entity-name" style="font-weight: 600; color: #166534; font-size: 14px;"></div>
                                <div id="trust-check-entity-address" style="font-size: 12px; color: #64748b; margin-top: 2px;"></div>
                            </div>
                            <button type="button" onclick="clearCheckPayeeEntity()" style="background: none; border: none; font-size: 18px; color: #94a3b8; cursor: pointer; padding: 0; line-height: 1;">√ó</button>
                        </div>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">Type <span style="color: #ef4444;">*</span></label>
                        <select id="trust-check-type" required style="width: 100%; padding: 12px 16px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; box-sizing: border-box; background: white;">
                            <option value="">Select type...</option>
                            <option value="payout">Client Payout</option>
                            <option value="legal_fee">Legal Fee</option>
                            <option value="cost">Cost</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">Amount <span style="color: #ef4444;">*</span></label>
                        <div style="position: relative;">
                            <span style="position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: #64748b; font-size: 16px;">$</span>
                            <input type="number" id="trust-check-amount" step="0.01" min="0.01" placeholder="0.00" required oninput="updateTrustCheckWords()" style="width: 100%; padding: 12px 16px 12px 32px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 18px; font-weight: 600; box-sizing: border-box;">
                        </div>
                    </div>
                </div>
                <div id="trust-check-words" style="margin-bottom: 20px; font-size: 12px; color: #64748b; font-style: italic;">Zero and 00/100 dollars</div>
                <div style="margin-bottom: 24px;">
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">Memo <span style="color: #ef4444;">*</span></label>
                    <input type="text" id="trust-check-memo" placeholder="Invoice number, description, purpose..." required style="width: 100%; padding: 12px 16px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; box-sizing: border-box;">
                </div>
                <div id="trust-check-status-display" style="margin-bottom: 20px; display: none;">
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">Status</label>
                    <div id="trust-check-status-badge" style="display: inline-flex; align-items: center; padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 600;">PENDING</div>
                </div>
                <div style="display: flex; gap: 12px; padding-top: 16px; border-top: 1px solid #e2e8f0;">
                    <button type="button" id="trust-check-delete-btn" onclick="deleteTrustCheck()" style="display: none; padding: 12px 20px; background: #fef2f2; color: #dc2626; border: 1px solid #fecaca; border-radius: 8px; font-size: 14px; cursor: pointer;">Delete</button>
                    <button type="button" id="trust-check-void-btn" onclick="voidTrustCheck()" style="display: none; padding: 12px 20px; background: #fef2f2; color: #dc2626; border: 1px solid #fecaca; border-radius: 8px; font-size: 14px; cursor: pointer;">Void</button>
                    <div style="flex: 1;"></div>
                    <button type="button" onclick="closeCheckModal()" style="padding: 12px 24px; background: white; color: #64748b; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; cursor: pointer;">Cancel</button>
                    <button type="button" id="trust-check-print-btn" onclick="printTrustCheck()" style="padding: 12px 20px; background: #f0fdf4; color: #15803d; border: 1px solid #bbf7d0; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;">Print Check</button>
                    <button type="button" id="trust-check-clear-btn" onclick="clearTrustCheck()" style="display: none; padding: 12px 20px; background: #eff6ff; color: #1d4ed8; border: 1px solid #bfdbfe; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;">‚úì Clear</button>
                    <button type="submit" id="trust-check-save-btn" style="padding: 12px 28px; background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;">Save Check</button>
                </div>
            </form>
        </div>
    </div>

    <div id="check-register-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 99999; justify-content: center; align-items: center;">
        <div style="width: 800px; max-width: 95%; border-radius: 16px; overflow: hidden; max-height: 80vh; display: flex; flex-direction: column; background: white; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);">
            <div style="padding: 20px 24px; background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; flex-shrink: 0;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 24px;">üìã</span>
                        <div>
                            <h3 style="margin: 0; font-size: 18px; font-weight: 600;">Check Register</h3>
                            <p style="margin: 2px 0 0; font-size: 13px; opacity: 0.9;">All issued checks</p>
                        </div>
                    </div>
                    <button onclick="closeCheckRegisterModal()" style="width: 32px; height: 32px; border-radius: 8px; background: rgba(255,255,255,0.2); color: white; border: none; cursor: pointer; font-size: 18px;">&times;</button>
                </div>
            </div>
            <div style="padding: 12px 24px; background: #f8fafc; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;">
                <div style="display: flex; gap: 20px; font-size: 13px; color: #64748b;">
                    <span><strong id="register-check-count">0</strong> checks</span>
                    <span>Pending: <strong id="register-pending-count" style="color: #f59e0b;">0</strong></span>
                    <span>Total: <strong id="register-check-total" style="color: #dc2626;">$0.00</strong></span>
                </div>
                <div style="display: flex; gap: 8px;">
                    <button class="register-tab active" data-filter="all" onclick="filterCheckRegister('all')" style="padding: 6px 12px; background: #3b82f6; color: white; border: none; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer;">All</button>
                    <button class="register-tab" data-filter="pending" onclick="filterCheckRegister('pending')" style="padding: 6px 12px; background: white; color: #64748b; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer;">Pending</button>
                    <button class="register-tab" data-filter="printed" onclick="filterCheckRegister('printed')" style="padding: 6px 12px; background: white; color: #64748b; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer;">Printed</button>
                    <button class="register-tab" data-filter="cleared" onclick="filterCheckRegister('cleared')" style="padding: 6px 12px; background: white; color: #64748b; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer;">Cleared</button>
                    <button onclick="closeCheckRegisterModal(); openCheckModal();" style="padding: 6px 12px; background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; border: none; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer;">+ New</button>
                </div>
            </div>
            <div id="check-register-list" style="flex: 1; overflow-y: auto; padding: 0;">
                <div style="padding: 60px 20px; text-align: center; color: #94a3b8;">
                    <div style="font-size: 40px; margin-bottom: 12px;">‚úèÔ∏è</div>
                    <div style="font-size: 14px; font-weight: 500; margin-bottom: 4px;">No checks yet</div>
                    <div style="font-size: 12px;">Click "+ New" to write a check</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Transfer Modal -->
    <div id="transfer-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 99999; justify-content: center; align-items: center;">
        <div style="width: 480px; max-width: 95%; border-radius: 16px; overflow: hidden; background: white; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);">
            <div style="padding: 20px 24px; background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%); color: white;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 24px;">üîÑ</span>
                        <div>
                            <h3 style="margin: 0; font-size: 18px; font-weight: 600;">Transfer Between Clients</h3>
                            <p style="margin: 2px 0 0; font-size: 13px; opacity: 0.9;">Move funds between ledgers</p>
                        </div>
                    </div>
                    <button onclick="closeTransferModal()" style="width: 32px; height: 32px; border-radius: 8px; background: rgba(255,255,255,0.2); color: white; border: none; cursor: pointer; font-size: 18px;">&times;</button>
                </div>
            </div>
            <form id="transfer-modal-form" onsubmit="submitTransferModal(event)" style="padding: 24px;">
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">
                        <span style="background: #fef2f2; color: #ef4444; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-right: 6px;">FROM</span>
                        Source Ledger <span style="color: #ef4444;">*</span>
                    </label>
                    <select id="modal-transfer-from" required style="width: 100%; padding: 12px 16px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; background: #f8fafc; cursor: pointer;">
                        <option value="">Select source...</option>
                    </select>
                </div>
                <div style="display: flex; justify-content: center; padding: 8px 0;">
                    <div style="width: 36px; height: 36px; background: #f5f3ff; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                        <span style="font-size: 18px;">‚¨áÔ∏è</span>
                    </div>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">
                        <span style="background: #ecfdf5; color: #059669; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-right: 6px;">TO</span>
                        Destination Ledger <span style="color: #ef4444;">*</span>
                    </label>
                    <select id="modal-transfer-to" required style="width: 100%; padding: 12px 16px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; background: #f8fafc; cursor: pointer;">
                        <option value="">Select destination...</option>
                    </select>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                    <div>
                        <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">Amount <span style="color: #ef4444;">*</span></label>
                        <div style="position: relative;">
                            <span style="position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: #64748b;">$</span>
                            <input type="number" id="modal-transfer-amount" step="0.01" min="0.01" required placeholder="0.00" style="width: 100%; padding: 12px 16px 12px 32px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; box-sizing: border-box;">
                        </div>
                    </div>
                    <div>
                        <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">Date <span style="color: #ef4444;">*</span></label>
                        <input type="date" id="modal-transfer-date" required style="width: 100%; padding: 12px 16px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; box-sizing: border-box;">
                    </div>
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">Description <span style="color: #ef4444;">*</span></label>
                    <input type="text" id="modal-transfer-description" required placeholder="e.g., Reallocation of funds" style="width: 100%; padding: 12px 16px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; box-sizing: border-box;">
                </div>
                <div style="display: flex; gap: 12px;">
                    <button type="button" onclick="closeTransferModal()" style="flex: 1; padding: 12px 24px; background: white; color: #64748b; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; cursor: pointer;">Cancel</button>
                    <button type="submit" style="flex: 1; padding: 12px 24px; background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%); color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;">Execute Transfer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Fee Withdrawal Modal -->
    <div id="fee-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 99999; justify-content: center; align-items: center;">
        <div style="width: 480px; max-width: 95%; border-radius: 16px; overflow: hidden; background: white; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);">
            <div style="padding: 20px 24px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 24px;">üíµ</span>
                        <div>
                            <h3 style="margin: 0; font-size: 18px; font-weight: 600;">Withdraw Earned Fee</h3>
                            <p id="fee-modal-subtitle" style="margin: 2px 0 0; font-size: 13px; opacity: 0.9;">Transfer to operating account</p>
                        </div>
                    </div>
                    <button onclick="closeFeeModal()" style="width: 32px; height: 32px; border-radius: 8px; background: rgba(255,255,255,0.2); color: white; border: none; cursor: pointer; font-size: 18px;">&times;</button>
                </div>
            </div>
            <form id="fee-modal-form" onsubmit="submitFeeModal(event)" style="padding: 24px;">
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">Client Ledger <span style="color: #ef4444;">*</span></label>
                    <select id="modal-fee-ledger" required style="width: 100%; padding: 12px 16px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; background: #f8fafc; cursor: pointer;">
                        <option value="">Select client...</option>
                    </select>
                </div>

                <!-- Transfer To dropdown -->
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">Transfer To <span style="color: #ef4444;">*</span></label>
                    <select id="modal-fee-transfer-to" required onchange="onFeeTransferToChange(this.value)" style="width: 100%; padding: 12px 16px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; background: #f8fafc; cursor: pointer;">
                        <option value="general">General Account (Legal Fee)</option>
                        <option value="cost">Cost Account (Client Reimbursement)</option>
                    </select>
                </div>

                <!-- Cost Account Client dropdown (hidden by default) -->
                <div id="fee-cost-client-group" style="display: none; margin-bottom: 16px;">
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">Cost Account Client <span style="color: #ef4444;">*</span></label>
                    <select id="modal-fee-cost-client" style="width: 100%; padding: 12px 16px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; background: #f8fafc; cursor: pointer;">
                        <option value="">Select client...</option>
                    </select>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                    <div>
                        <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">Amount <span style="color: #ef4444;">*</span></label>
                        <div style="position: relative;">
                            <span style="position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: #64748b;">$</span>
                            <input type="number" id="modal-fee-amount" step="0.01" min="0.01" required placeholder="0.00" style="width: 100%; padding: 12px 16px 12px 32px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; box-sizing: border-box;">
                        </div>
                    </div>
                    <div>
                        <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">Date <span style="color: #ef4444;">*</span></label>
                        <input type="date" id="modal-fee-date" required style="width: 100%; padding: 12px 16px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; box-sizing: border-box;">
                    </div>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">Description <span style="color: #ef4444;">*</span></label>
                    <input type="text" id="modal-fee-description" required placeholder="e.g., Legal fees for contract review" style="width: 100%; padding: 12px 16px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; box-sizing: border-box;">
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">Invoice # <span style="color: #94a3b8; font-weight: 400;">(Optional)</span></label>
                    <input type="text" id="modal-fee-invoice" placeholder="INV-001" style="width: 100%; padding: 12px 16px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; box-sizing: border-box;">
                </div>
                <div style="display: flex; gap: 12px;">
                    <button type="button" onclick="closeFeeModal()" style="flex: 1; padding: 12px 24px; background: white; color: #64748b; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; cursor: pointer;">Cancel</button>
                    <button type="submit" id="fee-modal-submit-btn" style="flex: 1; padding: 12px 24px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;">Withdraw Fee</button>
                </div>
            </form>
        </div>
    </div>

    <!-- New Transaction Modal (Deposit/Check/Fee) -->
    <div id="new-transaction-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 99999; justify-content: center; align-items: center;">
        <div style="width: 900px; max-width: 95%; height: 700px; border-radius: 16px; overflow: hidden; background: white; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); display: flex; flex-direction: column;">
            <!-- Header -->
            <div style="padding: 16px 24px; background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); color: white;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 24px;">üí∞</span>
                        <div>
                            <h3 style="margin: 0; font-size: 18px; font-weight: 600;">New Transaction</h3>
                            <p style="margin: 2px 0 0; font-size: 13px; opacity: 0.9;">Record a trust account transaction</p>
                        </div>
                    </div>
                    <button onclick="closeNewTransactionModal()" style="width: 32px; height: 32px; border-radius: 8px; background: rgba(255,255,255,0.2); color: white; border: none; cursor: pointer; font-size: 18px;">&times;</button>
                </div>
            </div>

            <!-- Transaction Type Tabs -->
            <div style="display: flex; border-bottom: 1px solid #e2e8f0; background: #f8fafc;">
                <button id="txn-tab-deposit" onclick="switchTransactionTab('deposit')"
                        style="flex: 1; padding: 14px 20px; border: none; background: #dcfce7; color: #166534; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; border-bottom: 3px solid #22c55e;">
                    <span>üíµ</span> Deposit
                </button>
                <button id="txn-tab-check" onclick="switchTransactionTab('check')"
                        style="flex: 1; padding: 14px 20px; border: none; background: transparent; color: #64748b; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; border-bottom: 3px solid transparent;">
                    <span>üìù</span> Check
                </button>
                <button id="txn-tab-fee" onclick="switchTransactionTab('fee')"
                        style="flex: 1; padding: 14px 20px; border: none; background: transparent; color: #64748b; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; border-bottom: 3px solid transparent;">
                    <span>üè¶</span> Fee
                </button>
            </div>

            <!-- Form Content -->
            <div id="new-transaction-content" style="flex: 1; padding: 24px; overflow-y: auto;">
                <!-- Form will be loaded here by JS -->
            </div>
        </div>
    </div>

    <!-- Unified Check Status Modal -->
    <div id="check-status-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 99999; justify-content: center; align-items: center;">
        <div style="width: 900px; max-width: 95%; height: 700px; border-radius: 16px; overflow: hidden; background: white; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); display: flex; flex-direction: column;">
            <!-- Header -->
            <div style="padding: 16px 24px; background: linear-gradient(135deg, #475569 0%, #334155 100%); color: white;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 24px;">üìã</span>
                        <div>
                            <h3 style="margin: 0; font-size: 18px; font-weight: 600;">Check Status</h3>
                            <p style="margin: 2px 0 0; font-size: 13px; opacity: 0.9;">Manage checks by status</p>
                        </div>
                    </div>
                    <button onclick="closeCheckStatusModal()" style="width: 32px; height: 32px; border-radius: 8px; background: rgba(255,255,255,0.2); color: white; border: none; cursor: pointer; font-size: 18px;">&times;</button>
                </div>
            </div>

            <!-- Tabs -->
            <div style="display: flex; border-bottom: 1px solid #e2e8f0; background: #f8fafc;">
                <button id="check-tab-pending" onclick="switchCheckStatusTab('pending')"
                        style="flex: 1; padding: 14px 20px; border: none; background: #fef3c7; color: #92400e; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; border-bottom: 3px solid #f59e0b;">
                    <span>‚è≥</span> Pending <span id="check-tab-pending-count" style="background: #f59e0b; color: white; font-size: 11px; padding: 2px 8px; border-radius: 10px;">0</span>
                </button>
                <button id="check-tab-printed" onclick="switchCheckStatusTab('printed')"
                        style="flex: 1; padding: 14px 20px; border: none; background: transparent; color: #64748b; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; border-bottom: 3px solid transparent;">
                    <span>üñ®Ô∏è</span> Printed <span id="check-tab-printed-count" style="background: #94a3b8; color: white; font-size: 11px; padding: 2px 8px; border-radius: 10px;">0</span>
                </button>
                <button id="check-tab-cleared" onclick="switchCheckStatusTab('cleared')"
                        style="flex: 1; padding: 14px 20px; border: none; background: transparent; color: #64748b; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; border-bottom: 3px solid transparent;">
                    <span>‚úÖ</span> Cleared <span id="check-tab-cleared-count" style="background: #94a3b8; color: white; font-size: 11px; padding: 2px 8px; border-radius: 10px;">0</span>
                </button>
            </div>

            <!-- Search Bar -->
            <div style="padding: 12px 24px; border-bottom: 1px solid #e2e8f0; background: #f8fafc;">
                <div style="position: relative;">
                    <span style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #94a3b8; font-size: 16px;">üîç</span>
                    <input type="text" id="check-status-search" placeholder="Search by Check #, Client, or Payee..."
                           oninput="filterCheckStatusList(this.value)"
                           style="width: 100%; padding: 10px 12px 10px 40px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; outline: none; box-sizing: border-box;">
                </div>
            </div>

            <!-- Action Bar (changes based on tab) -->
            <div id="check-status-action-bar" style="padding: 12px 24px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; background: #fffbeb;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <input type="checkbox" id="check-status-select-all" onchange="toggleSelectAllCheckStatus(this)" style="width: 18px; height: 18px; cursor: pointer;">
                    <span id="check-status-select-label" style="font-size: 14px; color: #92400e; font-weight: 500;">Select All</span>
                    <span id="check-status-selected-count" style="font-size: 13px; color: #64748b;">(0 selected)</span>
                </div>
                <div id="check-status-actions" style="display: flex; gap: 8px;">
                    <!-- Actions populated by JS based on current tab -->
                </div>
            </div>

            <!-- Check List -->
            <div id="check-status-list" style="flex: 1; overflow-y: auto; padding: 16px 24px;">
                <div style="text-align: center; color: #64748b; padding: 40px;">
                    Loading checks...
                </div>
            </div>

            <!-- Footer -->
            <div style="padding: 16px 24px; border-top: 1px solid #e2e8f0; display: flex; justify-content: flex-end;">
                <button onclick="closeCheckStatusModal()" style="padding: 10px 20px; background: white; color: #64748b; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; cursor: pointer;">Close</button>
            </div>
        </div>
    </div>

    <!-- Uncleared Deposits Modal -->
    <div id="uncleared-deposits-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 99999; justify-content: center; align-items: center;">
        <div style="width: 800px; max-width: 95%; max-height: 90vh; border-radius: 16px; overflow: hidden; background: white; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); display: flex; flex-direction: column;">
            <div style="padding: 20px 24px; background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%); color: white;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 24px;">üïê</span>
                        <div>
                            <h3 style="margin: 0; font-size: 18px; font-weight: 600;">Uncleared Deposits</h3>
                            <p style="margin: 2px 0 0; font-size: 13px; opacity: 0.9;">Deposits pending bank clearance</p>
                        </div>
                    </div>
                    <button onclick="closeUnclearedDepositsModal()" style="width: 32px; height: 32px; border-radius: 8px; background: rgba(255,255,255,0.2); color: white; border: none; cursor: pointer; font-size: 18px;">&times;</button>
                </div>
            </div>
            <div style="padding: 16px 24px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; background: #e0f2fe;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <input type="checkbox" id="uncleared-deposits-select-all" onchange="toggleSelectAllUnclearedDeposits(this)" style="width: 18px; height: 18px; cursor: pointer;">
                    <span style="font-size: 14px; color: #0369a1; font-weight: 500;">Select All</span>
                    <span id="uncleared-deposits-selected-count" style="font-size: 13px; color: #64748b;">(0 selected)</span>
                </div>
                <div style="display: flex; gap: 8px;">
                    <button id="mark-cleared-btn" onclick="markSelectedDepositsCleared()" style="padding: 8px 16px; background: #059669; color: white; border: none; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; display: none;">
                        ‚úì Mark Cleared
                    </button>
                </div>
            </div>
            <div id="uncleared-deposits-list" style="flex: 1; overflow-y: auto; padding: 16px 24px; min-height: 200px; max-height: 400px;">
                <!-- Uncleared deposits will be loaded here -->
                <div style="text-align: center; color: #64748b; padding: 40px;">
                    Loading uncleared deposits...
                </div>
            </div>
            <div style="padding: 16px 24px; border-top: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;">
                <button onclick="openBankStatementImportModal()" style="padding: 10px 20px; background: #f8fafc; color: #374151; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; cursor: pointer;">üì§ Import Bank Statement</button>
                <button onclick="closeUnclearedDepositsModal()" style="padding: 10px 20px; background: white; color: #64748b; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; cursor: pointer;">Close</button>
            </div>
        </div>
    </div>

    <!-- Bank Statement Import Modal -->
    <div id="bank-statement-import-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 99999; justify-content: center; align-items: center;">
        <div style="width: 900px; max-width: 95%; max-height: 90vh; border-radius: 16px; overflow: hidden; background: white; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); display: flex; flex-direction: column;">
            <div style="padding: 20px 24px; background: linear-gradient(135deg, #059669 0%, #047857 100%); color: white;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 24px;">üì§</span>
                        <div>
                            <h3 style="margin: 0; font-size: 18px; font-weight: 600;">Import Bank Statement</h3>
                            <p style="margin: 2px 0 0; font-size: 13px; opacity: 0.9;">Upload CSV to match with trust transactions</p>
                        </div>
                    </div>
                    <button onclick="closeBankStatementImportModal()" style="width: 32px; height: 32px; border-radius: 8px; background: rgba(255,255,255,0.2); color: white; border: none; cursor: pointer; font-size: 18px;">&times;</button>
                </div>
            </div>

            <!-- Step 1: File Upload -->
            <div id="import-step-upload" style="padding: 24px;">
                <!-- File Type Selection Tabs -->
                <div style="display: flex; gap: 8px; margin-bottom: 20px;">
                    <button id="import-tab-csv" onclick="switchImportTab('csv')" style="flex: 1; padding: 12px 16px; background: #059669; color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></svg>
                        CSV (Transactions)
                    </button>
                    <button id="import-tab-pdf" onclick="switchImportTab('pdf')" style="flex: 1; padding: 12px 16px; background: #f1f5f9; color: #475569; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
                        PDF (Balance Only)
                    </button>
                </div>

                <!-- CSV Upload Panel -->
                <div id="import-panel-csv">
                    <div style="text-align: center; padding: 40px 20px; border: 2px dashed #e2e8f0; border-radius: 12px; background: #f8fafc; margin-bottom: 20px;">
                        <input type="file" id="bank-statement-file" accept=".csv" onchange="handleBankStatementFile(this)" style="display: none;">
                        <div style="font-size: 48px; margin-bottom: 16px;">üìÑ</div>
                        <div style="font-size: 16px; font-weight: 600; color: #374151; margin-bottom: 8px;">Upload Bank Statement CSV</div>
                        <div style="font-size: 13px; color: #64748b; margin-bottom: 16px;">Import transactions from Chase bank</div>
                        <button onclick="document.getElementById('bank-statement-file').click()" style="padding: 12px 24px; background: #059669; color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;">
                            Select CSV File
                        </button>
                    </div>
                    <div style="background: #fffbeb; border: 1px solid #fcd34d; border-radius: 8px; padding: 16px;">
                        <div style="display: flex; align-items: flex-start; gap: 12px;">
                            <span style="font-size: 18px;">üí°</span>
                            <div style="font-size: 13px; color: #92400e;">
                                <strong>How to download CSV from Chase:</strong><br>
                                1. Log into Chase.com ‚Üí Select your account<br>
                                2. Click "Download account activity" ‚Üí Select CSV format<br>
                                3. Choose date range and download
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PDF Upload Panel -->
                <div id="import-panel-pdf" style="display: none;">
                    <div style="text-align: center; padding: 40px 20px; border: 2px dashed #e2e8f0; border-radius: 12px; background: #f8fafc; margin-bottom: 20px;">
                        <input type="file" id="bank-statement-pdf" accept=".pdf" onchange="handleBankStatementPdf(this)" style="display: none;">
                        <div style="font-size: 48px; margin-bottom: 16px;">üìë</div>
                        <div style="font-size: 16px; font-weight: 600; color: #374151; margin-bottom: 8px;">Upload Chase PDF Statement</div>
                        <div style="font-size: 13px; color: #64748b; margin-bottom: 16px;">Auto-extract ending balance for reconciliation</div>
                        <button onclick="document.getElementById('bank-statement-pdf').click()" id="pdf-upload-btn" style="padding: 12px 24px; background: #6366f1; color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;">
                            Select PDF File
                        </button>
                    </div>
                    <div id="pdf-result" style="display: none; background: #ecfdf5; border: 1px solid #10b981; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                            <span style="font-size: 24px;">‚úÖ</span>
                            <div>
                                <div style="font-weight: 600; color: #166534;">PDF Parsed Successfully</div>
                                <div style="font-size: 13px; color: #166534;">Statement data extracted</div>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                            <div style="background: white; border-radius: 8px; padding: 12px;">
                                <div style="font-size: 12px; color: #64748b;">Statement Period</div>
                                <div style="font-weight: 600; color: #1e293b;" id="pdf-period">-</div>
                            </div>
                            <div style="background: white; border-radius: 8px; padding: 12px;">
                                <div style="font-size: 12px; color: #64748b;">Ending Balance</div>
                                <div style="font-weight: 600; color: #059669; font-size: 18px;" id="pdf-ending-balance">-</div>
                            </div>
                        </div>
                        <button onclick="applyPdfToReconcile()" style="width: 100%; margin-top: 16px; padding: 12px 24px; background: #059669; color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;">
                            Apply to Reconciliation
                        </button>
                    </div>
                    <div id="pdf-error" style="display: none; background: #fef2f2; border: 1px solid #ef4444; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                        <div style="display: flex; align-items: flex-start; gap: 12px;">
                            <span style="font-size: 18px;">‚ö†Ô∏è</span>
                            <div style="font-size: 13px; color: #991b1b;">
                                <strong id="pdf-error-title">PDF Error</strong><br>
                                <span id="pdf-error-message"></span>
                            </div>
                        </div>
                    </div>
                    <!-- Manual Entry Option -->
                    <div id="manual-entry-section" style="background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px; margin-bottom: 16px; transition: all 0.3s ease;">
                        <div style="font-size: 14px; font-weight: 600; color: #374151; margin-bottom: 12px;">
                            Or Enter Manually
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
                            <div>
                                <label style="font-size: 12px; color: #64748b; display: block; margin-bottom: 4px;">Statement End Date</label>
                                <input type="date" id="manual-statement-date" style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 14px;">
                            </div>
                            <div>
                                <label style="font-size: 12px; color: #64748b; display: block; margin-bottom: 4px;">Bank Ending Balance</label>
                                <input type="text" id="manual-ending-balance" placeholder="e.g., 3892860.56" style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 14px;">
                            </div>
                        </div>
                        <button onclick="applyManualBankBalance()" style="width: 100%; padding: 12px 24px; background: #6366f1; color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;">
                            Apply Manual Entry
                        </button>
                    </div>

                    <div style="background: #eff6ff; border: 1px solid #3b82f6; border-radius: 8px; padding: 16px;">
                        <div style="display: flex; align-items: flex-start; gap: 12px;">
                            <span style="font-size: 18px;">üí°</span>
                            <div style="font-size: 13px; color: #1e40af;">
                                <strong>PDF extracts ending balance only</strong><br>
                                For transactions, use CSV format instead.<br><br>
                                <strong>If "Secured PDF" error:</strong><br>
                                1. Open the PDF in your browser<br>
                                2. Press Ctrl+P (Print) ‚Üí "Save as PDF"<br>
                                3. Upload the newly saved PDF
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Preview & Match -->
            <div id="import-step-preview" style="display: none; flex: 1; overflow: hidden; display: flex; flex-direction: column;">
                <div style="padding: 16px 24px; border-bottom: 1px solid #e2e8f0; background: #f8fafc;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <span style="font-size: 14px; color: #64748b;">Imported: </span>
                            <span id="import-file-name" style="font-weight: 600; color: #374151;">-</span>
                            <span style="margin-left: 16px; font-size: 14px; color: #64748b;">Transactions: </span>
                            <span id="import-tx-count" style="font-weight: 600; color: #374151;">0</span>
                        </div>
                        <button onclick="resetBankStatementImport()" style="padding: 6px 12px; background: white; color: #64748b; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 13px; cursor: pointer;">
                            Upload Different File
                        </button>
                    </div>
                </div>

                <!-- Match Summary -->
                <div style="padding: 16px 24px; border-bottom: 1px solid #e2e8f0; display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px;">
                    <div style="background: #dcfce7; border-radius: 8px; padding: 12px 16px; text-align: center;">
                        <div style="font-size: 24px; font-weight: 700; color: #166534;" id="match-count-matched">0</div>
                        <div style="font-size: 12px; color: #166534;">Matched</div>
                    </div>
                    <div style="background: #fef3c7; border-radius: 8px; padding: 12px 16px; text-align: center;">
                        <div style="font-size: 24px; font-weight: 700; color: #92400e;" id="match-count-pending">0</div>
                        <div style="font-size: 12px; color: #92400e;">Unmatched (Book)</div>
                    </div>
                    <div style="background: #fee2e2; border-radius: 8px; padding: 12px 16px; text-align: center;">
                        <div style="font-size: 24px; font-weight: 700; color: #991b1b;" id="match-count-missing">0</div>
                        <div style="font-size: 12px; color: #991b1b;">Not in Book</div>
                    </div>
                    <div style="background: #e0e7ff; border-radius: 8px; padding: 12px 16px; text-align: center;">
                        <div style="font-size: 24px; font-weight: 700; color: #3730a3;" id="match-count-already">0</div>
                        <div style="font-size: 12px; color: #3730a3;">Already Cleared</div>
                    </div>
                </div>

                <!-- Match Results List -->
                <div style="flex: 1; overflow-y: auto; padding: 0;" id="import-match-results">
                    <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                        <thead style="background: #f1f5f9; position: sticky; top: 0;">
                            <tr>
                                <th style="padding: 12px 16px; text-align: left; font-weight: 600; color: #475569; border-bottom: 1px solid #e2e8f0;">
                                    <input type="checkbox" id="import-select-all" onchange="toggleSelectAllImportMatches(this)" style="margin-right: 8px;">
                                    Bank Transaction
                                </th>
                                <th style="padding: 12px 16px; text-align: center; font-weight: 600; color: #475569; border-bottom: 1px solid #e2e8f0;">Status</th>
                                <th style="padding: 12px 16px; text-align: left; font-weight: 600; color: #475569; border-bottom: 1px solid #e2e8f0;">Matched To</th>
                                <th style="padding: 12px 16px; text-align: right; font-weight: 600; color: #475569; border-bottom: 1px solid #e2e8f0;">Amount</th>
                            </tr>
                        </thead>
                        <tbody id="import-match-tbody">
                            <!-- Match results will be populated here -->
                        </tbody>
                    </table>
                </div>

                <!-- Action Footer -->
                <div style="padding: 16px 24px; border-top: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; background: white;">
                    <div style="font-size: 13px; color: #64748b;">
                        <span id="import-selected-count">0</span> transactions selected for clearing
                    </div>
                    <div style="display: flex; gap: 12px;">
                        <button onclick="closeBankStatementImportModal()" style="padding: 10px 20px; background: white; color: #64748b; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; cursor: pointer;">Cancel</button>
                        <button onclick="confirmBankStatementMatches()" id="confirm-import-btn" style="padding: 10px 20px; background: #059669; color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;">
                            Confirm & Clear Selected
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>


